// github.com/shawn0326/zen-3d
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).zen3d={})}(this,(function(t){"use strict";for(var e=[],n=0;n<256;n++)e[n]=(n<16?"0":"")+n.toString(16);function i(){var t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&n]+e[n>>8&255]+"-"+e[n>>16&15|64]+e[n>>24&255]+"-"+e[63&i|128]+e[i>>8&255]+"-"+e[i>>16&255]+e[i>>24&255]+e[255&r]+e[r>>8&255]+e[r>>16&255]+e[r>>24&255]).toUpperCase()}function r(t){return 0==(t&t-1)&&0!==t}function a(t){return Math.pow(2,Math.round(Math.log(t)/Math.LN2))}function s(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function o(t){var e={};for(var n in t){var i=t[n];Array.isArray(i)?e[n]=i.slice():e[n]=i}return e}var h={MESH:"mesh",SKINNED_MESH:"skinned_mesh",LIGHT:"light",CAMERA:"camera",SCENE:"scene",GROUP:"group"},c={AMBIENT:"ambient",DIRECT:"direct",POINT:"point",SPOT:"spot"},u={BASIC:"basic",LAMBERT:"lambert",PHONG:"phong",PBR:"pbr",PBR2:"pbr2",MATCAP:"matcap",POINT:"point",LINE:"line",SHADER:"shader",DEPTH:"depth",DISTANCE:"distance"},l={NORMAL:"normal",EXP2:"exp2"},d={NONE:"none",NORMAL:"normal",ADD:"add",CUSTOM:"custom"},p={ADD:32774,SUBTRACT:32778,REVERSE_SUBTRACT:32779},f={ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775},_={NONE:"none",FRONT:"front",BACK:"back",FRONT_AND_BACK:"front_and_back"},v={FRONT:"front",BACK:"back",DOUBLE:"double"},m={SMOOTH_SHADING:"smooth_shading",FLAT_SHADING:"flat_shading"},g={TEXTURE_2D:3553,TEXTURE_CUBE_MAP:34067,TEXTURE_3D:32879},M={DEPTH_COMPONENT:6402,DEPTH_STENCIL:34041,ALPHA:6406,RED:6403,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,R8:33321,RGBA8:32856,RGBA16F:34842,RGBA32F:34836,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT24:33190,DEPTH_COMPONENT32F:36012,DEPTH24_STENCIL8:35056,DEPTH32F_STENCIL8:36013},E={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,HALF_FLOAT:36193,UNSIGNED_INT_24_8:34042,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FLOAT_32_UNSIGNED_INT_24_8_REV:36269},S={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987},x={REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648},y={LEQUAL:515,GEQUAL:518,LESS:513,GREATER:516,EQUAL:514,NOTEQUAL:517,ALWAYS:519,NEVER:512},T={KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056},w={FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_2D_SHADOW:35682,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW:36293,SAMPLER_3D:35679,BYTE:65535,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126},b={FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FLOAT:5126,BYTE:65535,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},A={HARD:"hard",POISSON_SOFT:"poisson_soft",PCF3_SOFT:"pcf3_soft",PCF5_SOFT:"pcf5_soft",PCSS16_SOFT:"pcss16_soft",PCSS32_SOFT:"pcss32_soft",PCSS64_SOFT:"pcss64_soft"},N={LINEAR:"linear",SRGB:"sRGB",RGBE:"RGBE",RGBM7:"RGBM7",RGBM16:"RGBM16",RGBD:"RGBD",GAMMA:"Gamma"},C={MULTIPLY:"ENVMAP_BLENDING_MULTIPLY",MIX:"ENVMAP_BLENDING_MIX",ADD:"ENVMAP_BLENDING_ADD"},R={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},P={NONE:0,RGB:1,RGBA:2},L={COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:577040,COLOR_ATTACHMENT11:577041,COLOR_ATTACHMENT12:577042,COLOR_ATTACHMENT13:577043,COLOR_ATTACHMENT14:577044,COLOR_ATTACHMENT15:577045,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306},O={STREAM_DRAW:35040,STREAM_READ:35041,STREAM_COPY:35042,STATIC_DRAW:35044,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_DRAW:35048,DYNAMIC_READ:35049,DYNAMIC_COPY:35050};function F(){this.eventMap={}}Object.assign(F.prototype,{addEventListener:function(t,e,n){var i=this.eventMap[t];i||(i=this.eventMap[t]=[]),i.push({listener:e,thisObject:n||this})},removeEventListener:function(t,e,n){var i=this.eventMap[t];if(i)for(var r=0,a=i.length;r<a;r++){var s=i[r];if(s.listener==e&&s.thisObject==(n||this)){i.splice(r,1);break}}},dispatchEvent:function(t){t.target=this,this.notifyListener(t)},notifyListener:function(t){var e=this.eventMap[t.type];if(e)for(var n=0,i=e.length;n<i;n++){var r=e[n];r.listener.call(r.thisObject,t)}}});var U=new D;function D(t,e,n){this.x=t||0,this.y=e||0,this.z=n||0}Object.assign(D.prototype,{lerpVectors:function(t,e,n){return this.subVectors(e,t).multiplyScalar(n).add(t)},set:function(t,e,n){return this.x=t||0,this.y=e||0,this.z=n||0,this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},getLength:function(){return Math.sqrt(this.getLengthSquared())},getLengthSquared:function(){return this.x*this.x+this.y*this.y+this.z*this.z},normalize:function(t){t=t||1;var e=this.getLength();if(0!=e){var n=t/e;return this.x*=n,this.y*=n,this.z*=n,this}},subtract:function(t,e){return e||(e=new D),e.set(this.x-t.x,this.y-t.y,this.z-t.z),e},multiply:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},crossVectors:function(t,e){var n=t.x,i=t.y,r=t.z,a=e.x,s=e.y,o=e.z;return this.x=i*o-r*s,this.y=r*a-n*o,this.z=n*s-i*a,this},cross:function(t){var e=this.x,n=this.y,i=this.z;return this.x=n*t.z-i*t.y,this.y=i*t.x-e*t.z,this.z=e*t.y-n*t.x,this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},applyQuaternion:function(t){var e=this.x,n=this.y,i=this.z,r=t._x,a=t._y,s=t._z,o=t._w,h=o*e+a*i-s*n,c=o*n+s*e-r*i,u=o*i+r*n-a*e,l=-r*e-a*n-s*i;return this.x=h*o+l*-r+c*-s-u*-a,this.y=c*o+l*-a+u*-r-h*-s,this.z=u*o+l*-s+h*-a-c*-r,this},applyMatrix4:function(t){var e=this.x,n=this.y,i=this.z,r=t.elements,a=1/(r[3]*e+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*e+r[4]*n+r[8]*i+r[12])*a,this.y=(r[1]*e+r[5]*n+r[9]*i+r[13])*a,this.z=(r[2]*e+r[6]*n+r[10]*i+r[14])*a,this},applyMatrix3:function(t){var e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6]*i,this.y=r[1]*e+r[4]*n+r[7]*i,this.z=r[2]*e+r[5]*n+r[8]*i,this},transformDirection:function(t){var e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[4]*n+r[8]*i,this.y=r[1]*e+r[5]*n+r[9]*i,this.z=r[2]*e+r[6]*n+r[10]*i,this.normalize()},setFromMatrixPosition:function(t){return this.setFromMatrixColumn(t,3)},setFromMatrixColumn:function(t,e){return this.fromArray(t.elements,4*e)},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},add:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},sub:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},distanceToSquared:function(t){var e=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return e*e+n*n+i*i},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},setFromSpherical:function(t){var e=Math.sin(t.phi)*t.radius;return this.x=e*Math.sin(t.theta),this.y=Math.cos(t.phi)*t.radius,this.z=e*Math.cos(t.theta),this},project:function(t){return this.applyMatrix4(t.viewMatrix).applyMatrix4(t.projectionMatrix)},unproject:function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.worldMatrix)},reflect:function(t){return this.sub(U.copy(t).multiplyScalar(2*this.dot(t)))},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},clone:function(){return new D(this.x,this.y,this.z)}});var I=new D,B=new D,z=new D,G=new D,H=new D;function k(t,e){this.origin=void 0!==t?t:new D,this.direction=void 0!==e?e:new D}function V(t,e,n,i){this.ray=new k(t,e),this.near=n||0,this.far=i||1/0}function j(t,e){return t.distance-e.distance}function W(t,e,n,i){if(t.raycast(e,n),!0===i)for(var r=t.children,a=0,s=r.length;a<s;a++)W(r[a],e,n,!0)}Object.assign(k.prototype,{set:function(t,e){this.origin.copy(t),this.direction.copy(e)},at:function(t,e){return(e||new D).copy(this.direction).multiplyScalar(t).add(this.origin)},intersectsSphere:function(t,e){I.subVectors(t.center,this.origin);var n=I.dot(this.direction),i=I.dot(I)-n*n,r=t.radius*t.radius;if(i>r)return null;var a=Math.sqrt(r-i),s=n-a,o=n+a;return s<0&&o<0?null:s<0?this.at(o,e):this.at(s,e)},intersectsBox:function(t,e){var n,i,r,a,s,o,h=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,l=this.origin;return h>=0?(n=(t.min.x-l.x)*h,i=(t.max.x-l.x)*h):(n=(t.max.x-l.x)*h,i=(t.min.x-l.x)*h),c>=0?(r=(t.min.y-l.y)*c,a=(t.max.y-l.y)*c):(r=(t.max.y-l.y)*c,a=(t.min.y-l.y)*c),n>a||r>i?null:((r>n||n!=n)&&(n=r),(a<i||i!=i)&&(i=a),u>=0?(s=(t.min.z-l.z)*u,o=(t.max.z-l.z)*u):(s=(t.max.z-l.z)*u,o=(t.min.z-l.z)*u),n>o||s>i?null:((s>n||n!=n)&&(n=s),(o<i||i!=i)&&(i=o),i<0?null:this.at(n>=0?n:i,e)))},intersectTriangle:function(t,e,n,i,r){z.subVectors(e,t),G.subVectors(n,t),H.crossVectors(z,G);var a,s=this.direction.dot(H);if(s>0){if(i)return null;a=1}else{if(!(s<0))return null;a=-1,s=-s}B.subVectors(this.origin,t);var o=a*this.direction.dot(G.crossVectors(B,G));if(o<0)return null;var h=a*this.direction.dot(z.cross(B));if(h<0)return null;if(o+h>s)return null;var c=-a*B.dot(H);return c<0?null:this.at(c/s,r)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},applyMatrix4:function(t){return this.direction.add(this.origin).applyMatrix4(t),this.origin.applyMatrix4(t),this.direction.sub(this.origin),this.direction.normalize(),this}}),Object.assign(V.prototype,{set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e,n){"orthographic"==(n=n||"perspective")?(this.ray.origin.set(t.x,t.y,e.projectionMatrix.elements[14]).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.worldMatrix)):(this.ray.origin.setFromMatrixPosition(e.worldMatrix),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize())},intersectObject:function(t,e){var n=[];return W(t,this,n,e),n.sort(j),n},intersectObjects:function(t,e){var n=[];if(!1===Array.isArray(t))return console.warn("Raycaster.intersectObjects: objects is not an Array."),n;for(var i=0,r=t.length;i<r;i++)W(t[i],this,n,e);return n.sort(j),n}});var X=new D,Y=new Q,q=new D,Z=new D,K=new D;function Q(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}Object.assign(Q.prototype,{identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},set:function(t,e,n,i,r,a,s,o,h,c,u,l,d,p,f,_){var v=this.elements;return v[0]=t,v[4]=e,v[8]=n,v[12]=i,v[1]=r,v[5]=a,v[9]=s,v[13]=o,v[2]=h,v[6]=c,v[10]=u,v[14]=l,v[3]=d,v[7]=p,v[11]=f,v[15]=_,this},copy:function(t){return this.elements.set(t.elements),this},makeTranslation:function(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this},multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var n=t.elements,i=e.elements,r=this.elements,a=n[0],s=n[4],o=n[8],h=n[12],c=n[1],u=n[5],l=n[9],d=n[13],p=n[2],f=n[6],_=n[10],v=n[14],m=n[3],g=n[7],M=n[11],E=n[15],S=i[0],x=i[4],y=i[8],T=i[12],w=i[1],b=i[5],A=i[9],N=i[13],C=i[2],R=i[6],P=i[10],L=i[14],O=i[3],F=i[7],U=i[11],D=i[15];return r[0]=a*S+s*w+o*C+h*O,r[4]=a*x+s*b+o*R+h*F,r[8]=a*y+s*A+o*P+h*U,r[12]=a*T+s*N+o*L+h*D,r[1]=c*S+u*w+l*C+d*O,r[5]=c*x+u*b+l*R+d*F,r[9]=c*y+u*A+l*P+d*U,r[13]=c*T+u*N+l*L+d*D,r[2]=p*S+f*w+_*C+v*O,r[6]=p*x+f*b+_*R+v*F,r[10]=p*y+f*A+_*P+v*U,r[14]=p*T+f*N+_*L+v*D,r[3]=m*S+g*w+M*C+E*O,r[7]=m*x+g*b+M*R+E*F,r[11]=m*y+g*A+M*P+E*U,r[15]=m*T+g*N+M*L+E*D,this},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},inverse:function(){return this.getInverse(this)},getInverse:function(t){var e=this.elements,n=t.elements,i=n[0],r=n[1],a=n[2],s=n[3],o=n[4],h=n[5],c=n[6],u=n[7],l=n[8],d=n[9],p=n[10],f=n[11],_=n[12],v=n[13],m=n[14],g=n[15],M=d*m*u-v*p*u+v*c*f-h*m*f-d*c*g+h*p*g,E=_*p*u-l*m*u-_*c*f+o*m*f+l*c*g-o*p*g,S=l*v*u-_*d*u+_*h*f-o*v*f-l*h*g+o*d*g,x=_*d*c-l*v*c-_*h*p+o*v*p+l*h*m-o*d*m,y=i*M+r*E+a*S+s*x;if(0===y)return console.warn("can't invert matrix, determinant is 0"),this.identity();var T=1/y;return e[0]=M*T,e[1]=(v*p*s-d*m*s-v*a*f+r*m*f+d*a*g-r*p*g)*T,e[2]=(h*m*s-v*c*s+v*a*u-r*m*u-h*a*g+r*c*g)*T,e[3]=(d*c*s-h*p*s-d*a*u+r*p*u+h*a*f-r*c*f)*T,e[4]=E*T,e[5]=(l*m*s-_*p*s+_*a*f-i*m*f-l*a*g+i*p*g)*T,e[6]=(_*c*s-o*m*s-_*a*u+i*m*u+o*a*g-i*c*g)*T,e[7]=(o*p*s-l*c*s+l*a*u-i*p*u-o*a*f+i*c*f)*T,e[8]=S*T,e[9]=(_*d*s-l*v*s-_*r*f+i*v*f+l*r*g-i*d*g)*T,e[10]=(o*v*s-_*h*s+_*r*u-i*v*u-o*r*g+i*h*g)*T,e[11]=(l*h*s-o*d*s-l*r*u+i*d*u+o*r*f-i*h*f)*T,e[12]=x*T,e[13]=(l*v*a-_*d*a+_*r*p-i*v*p-l*r*m+i*d*m)*T,e[14]=(_*h*a-o*v*a-_*r*c+i*v*c+o*r*m-i*h*m)*T,e[15]=(o*d*a-l*h*a+l*r*c-i*d*c-o*r*p+i*h*p)*T,this},transform:function(t,e,n){var i=n.toMatrix4(Y).elements,r=this.elements;return r[0]=i[0]*e.x,r[1]=i[1]*e.x,r[2]=i[2]*e.x,r[3]=0,r[4]=i[4]*e.y,r[5]=i[5]*e.y,r[6]=i[6]*e.y,r[7]=0,r[8]=i[8]*e.z,r[9]=i[9]*e.z,r[10]=i[10]*e.z,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this},makeRotationFromQuaternion:function(t){var e=this.elements,n=t.x,i=t.y,r=t.z,a=t.w,s=n+n,o=i+i,h=r+r,c=n*s,u=n*o,l=n*h,d=i*o,p=i*h,f=r*h,_=a*s,v=a*o,m=a*h;return e[0]=1-(d+f),e[4]=u-m,e[8]=l+v,e[1]=u+m,e[5]=1-(c+f),e[9]=p-_,e[2]=l-v,e[6]=p+_,e[10]=1-(c+d),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},extractRotation:function(t){var e=this.elements,n=t.elements,i=1/X.setFromMatrixColumn(t,0).getLength(),r=1/X.setFromMatrixColumn(t,1).getLength(),a=1/X.setFromMatrixColumn(t,2).getLength();return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=0,e[4]=n[4]*r,e[5]=n[5]*r,e[6]=n[6]*r,e[7]=0,e[8]=n[8]*a,e[9]=n[9]*a,e[10]=n[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},lookAtRH:function(t,e,n){var i=this.elements;return K.subVectors(t,e),0===K.getLengthSquared()&&(K.z=1),K.normalize(),q.crossVectors(n,K),0===q.getLengthSquared()&&(1===Math.abs(n.z)?K.x+=1e-4:K.z+=1e-4,K.normalize(),q.crossVectors(n,K)),q.normalize(),Z.crossVectors(K,q),i[0]=q.x,i[4]=Z.x,i[8]=K.x,i[1]=q.y,i[5]=Z.y,i[9]=K.y,i[2]=q.z,i[6]=Z.z,i[10]=K.z,this},decompose:function(t,e,n){var i=this.elements,r=X.set(i[0],i[1],i[2]).getLength(),a=X.set(i[4],i[5],i[6]).getLength(),s=X.set(i[8],i[9],i[10]).getLength();this.determinant()<0&&(r=-r),t.x=i[12],t.y=i[13],t.z=i[14],Y.copy(this);var o=1/r,h=1/a,c=1/s;return Y.elements[0]*=o,Y.elements[1]*=o,Y.elements[2]*=o,Y.elements[4]*=h,Y.elements[5]*=h,Y.elements[6]*=h,Y.elements[8]*=c,Y.elements[9]*=c,Y.elements[10]*=c,e.setFromRotationMatrix(Y),n.x=r,n.y=a,n.z=s,this},determinant:function(){var t=this.elements,e=t[0],n=t[4],i=t[8],r=t[12],a=t[1],s=t[5],o=t[9],h=t[13],c=t[2],u=t[6],l=t[10],d=t[14];return t[3]*(+r*o*u-i*h*u-r*s*l+n*h*l+i*s*d-n*o*d)+t[7]*(+e*o*d-e*h*l+r*a*l-i*a*d+i*h*c-r*o*c)+t[11]*(+e*h*u-e*s*d-r*a*u+n*a*d+r*s*c-n*h*c)+t[15]*(-i*s*c-e*o*u+e*s*l+i*a*u-n*a*l+n*o*c)},fromArray:function(t,e){void 0===e&&(e=0);for(var n=0;n<16;n++)this.elements[n]=t[n+e];return this},getMaxScaleOnAxis:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,i))},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}});var $=new Q;function J(t,e,n,i){this._x=t||0,this._y=e||0,this._z=n||0,this._order=i||J.DefaultOrder}function tt(t,e){this.x=t||0,this.y=e||0}function et(t,e,n,i){this.x=t||0,this.y=e||0,this.z=n||0,this.w=void 0!==i?i:1}function nt(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1])}function it(t,e,n,i){this._x=t||0,this._y=e||0,this._z=n||0,this._w=void 0!==i?i:1}function rt(t,e){this.min=void 0!==t?t:new tt(1/0,1/0),this.max=void 0!==e?e:new tt(-1/0,-1/0)}J.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],J.DefaultOrder="XYZ",Object.defineProperties(J.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this.onChangeCallback()}}}),Object.assign(J.prototype,{copyFrom:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this.onChangeCallback(),this},set:function(t,e,n,i){return this._x=t||0,this._y=e||0,this._z=n||0,this._order=i||this._order,this.onChangeCallback(),this},setFromRotationMatrix:function(t,e,n){var i=function(t,e,n){return Math.max(e,Math.min(n,t))},r=t.elements,a=r[0],s=r[4],o=r[8],h=r[1],c=r[5],u=r[9],l=r[2],d=r[6],p=r[10];return"XYZ"===(e=e||this._order)?(this._y=Math.asin(i(o,-1,1)),Math.abs(o)<.99999?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-s,a)):(this._x=Math.atan2(d,c),this._z=0)):"YXZ"===e?(this._x=Math.asin(-i(u,-1,1)),Math.abs(u)<.99999?(this._y=Math.atan2(o,p),this._z=Math.atan2(h,c)):(this._y=Math.atan2(-l,a),this._z=0)):"ZXY"===e?(this._x=Math.asin(i(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-l,p),this._z=Math.atan2(-s,c)):(this._y=0,this._z=Math.atan2(h,a))):"ZYX"===e?(this._y=Math.asin(-i(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(d,p),this._z=Math.atan2(h,a)):(this._x=0,this._z=Math.atan2(-s,c))):"YZX"===e?(this._z=Math.asin(i(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-l,a)):(this._x=0,this._y=Math.atan2(o,p))):"XZY"===e?(this._z=Math.asin(-i(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(d,c),this._y=Math.atan2(o,a)):(this._x=Math.atan2(-u,p),this._y=0)):console.warn("given unsupported order: "+e),this._order=e,!1!==n&&this.onChangeCallback(),this},setFromQuaternion:function(t,e,n){return t.toMatrix4($),this.setFromRotationMatrix($,e,n)},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}}),Object.assign(tt.prototype,{set:function(t,e){return this.x=t||0,this.y=e||0,this},lerpVectors:function(t,e,n){return this.subVectors(e,t).multiplyScalar(n).add(t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},getLength:function(){return Math.sqrt(this.getLengthSquared())},getLengthSquared:function(){return this.x*this.x+this.y*this.y},normalize:function(t){t=t||1;var e=this.getLength();if(0!=e){var n=t/e;return this.x*=n,this.y*=n,this}},subtract:function(t,e){return e||(e=new tt),e.set(this.x-t.x,this.y-t.y),e},sub:function(t){return this.x-=t.x,this.y-=t.y,this},copy:function(t){return this.x=t.x,this.y=t.y,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},distanceToSquared:function(t){var e=this.x-t.x,n=this.y-t.y;return e*e+n*n},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},add:function(t){return this.x+=t.x,this.y+=t.y,this},angle:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t},clone:function(){return new tt(this.x,this.y)}}),Object.assign(et.prototype,{lerpVectors:function(t,e,n){return this.subVectors(e,t).multiplyScalar(n).add(t)},set:function(t,e,n,i){return this.x=t||0,this.y=e||0,this.z=n||0,this.w=void 0!==i?i:1,this},normalize:function(){return this.multiplyScalar(1/(this.getLength()||1))},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},getLengthSquared:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},applyMatrix4:function(t){var e=this.x,n=this.y,i=this.z,r=this.w,a=t.elements;return this.x=a[0]*e+a[4]*n+a[8]*i+a[12]*r,this.y=a[1]*e+a[5]*n+a[9]*i+a[13]*r,this.z=a[2]*e+a[6]*n+a[10]*i+a[14]*r,this.w=a[3]*e+a[7]*n+a[11]*i+a[15]*r,this},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},add:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}}),Object.assign(nt.prototype,{identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},inverse:function(){return this.getInverse(this)},getInverse:function(t){var e=t.elements,n=this.elements,i=e[0],r=e[1],a=e[2],s=e[3],o=e[4],h=e[5],c=e[6],u=e[7],l=e[8],d=l*o-h*u,p=h*c-l*s,f=u*s-o*c,_=i*d+r*p+a*f;if(0===_){return console.warn("zen3d.Matrix3: .getInverse() can't invert matrix, determinant is 0"),this.identity()}var v=1/_;return n[0]=d*v,n[1]=(a*u-l*r)*v,n[2]=(h*r-a*o)*v,n[3]=p*v,n[4]=(l*i-a*c)*v,n[5]=(a*s-h*i)*v,n[6]=f*v,n[7]=(r*c-u*i)*v,n[8]=(o*i-r*s)*v,this},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},set:function(t,e,n,i,r,a,s,o,h){var c=this.elements;return c[0]=t,c[3]=e,c[6]=n,c[1]=i,c[4]=r,c[7]=a,c[2]=s,c[5]=o,c[8]=h,this},copy:function(t){return this.elements.set(t.elements),this},multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var n=t.elements,i=e.elements,r=this.elements,a=n[0],s=n[3],o=n[6],h=n[1],c=n[4],u=n[7],l=n[2],d=n[5],p=n[8],f=i[0],_=i[3],v=i[6],m=i[1],g=i[4],M=i[7],E=i[2],S=i[5],x=i[8];return r[0]=a*f+s*m+o*E,r[3]=a*_+s*g+o*S,r[6]=a*v+s*M+o*x,r[1]=h*f+c*m+u*E,r[4]=h*_+c*g+u*S,r[7]=h*v+c*M+u*x,r[2]=l*f+d*m+p*E,r[5]=l*_+d*g+p*S,r[8]=l*v+d*M+p*x,this},transform:function(t,e,n,i,r,a,s){var o=this.elements,h=1,c=0;if(r%360){var u=r;h=Math.cos(u),c=Math.sin(u)}return o[0]=h*n,o[3]=-c*i,o[6]=t,o[1]=c*n,o[4]=h*i,o[7]=e,o[2]=0,o[5]=0,o[8]=1,(a||s)&&(o[6]-=a*o[0]+s*o[3],o[7]-=a*o[1]+s*o[4]),this},setUvTransform:function(t,e,n,i,r,a,s){var o=Math.cos(r),h=Math.sin(r);this.set(n*o,n*h,-n*(o*a+h*s)+a+t,-i*h,i*o,-i*(-h*a+o*s)+s+e,0,0,1)},setFromMatrix4:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}}),Object.defineProperties(it.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this.onChangeCallback()}}}),Object.assign(it.prototype,{normalize:function(t){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},lerpQuaternions:function(t,e,n){var i=t._w,r=t._x,a=t._y,s=t._z,o=e._w,h=e._x,c=e._y,u=e._z;i*o+r*h+a*c+s*u<0&&(o=-o,h=-h,c=-c,u=-u),this._w=i+n*(o-i),this._x=r+n*(h-r),this._y=a+n*(c-a),this._z=s+n*(u-s);var l=1/Math.sqrt(this._w*this._w+this._x*this._x+this._y*this._y+this._z*this._z);return this._w*=l,this._x*=l,this._y*=l,this._z*=l,this.onChangeCallback(),this},slerpQuaternions:function(t,e,n){var i=t._w,r=t._x,a=t._y,s=t._z,o=e._w,h=e._x,c=e._y,u=e._z,l=i*o+r*h+a*c+s*u;if(l<0&&(l=-l,o=-o,h=-h,c=-c,u=-u),l<.95){var d=Math.acos(l),p=1/Math.sin(d),f=Math.sin(d*(1-n))*p,_=Math.sin(d*n)*p;this._w=i*f+o*_,this._x=r*f+h*_,this._y=a*f+c*_,this._z=s*f+u*_}else{this._w=i+n*(o-i),this._x=r+n*(h-r),this._y=a+n*(c-a),this._z=s+n*(u-s);var v=1/Math.sqrt(this._w*this._w+this._x*this._x+this._y*this._y+this._z*this._z);this._w*=v,this._x*=v,this._y*=v,this._z*=v}return this.onChangeCallback(),this},set:function(t,e,n,i){return this._x=t||0,this._y=e||0,this._z=n||0,this._w=void 0!==i?i:1,this.onChangeCallback(),this},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=void 0!==t.w?t.w:1,this.onChangeCallback(),this},setFromEuler:function(t,e){var n=Math.cos(t._x/2),i=Math.cos(t._y/2),r=Math.cos(t._z/2),a=Math.sin(t._x/2),s=Math.sin(t._y/2),o=Math.sin(t._z/2),h=t._order;return"XYZ"===h?(this._x=a*i*r+n*s*o,this._y=n*s*r-a*i*o,this._z=n*i*o+a*s*r,this._w=n*i*r-a*s*o):"YXZ"===h?(this._x=a*i*r+n*s*o,this._y=n*s*r-a*i*o,this._z=n*i*o-a*s*r,this._w=n*i*r+a*s*o):"ZXY"===h?(this._x=a*i*r-n*s*o,this._y=n*s*r+a*i*o,this._z=n*i*o+a*s*r,this._w=n*i*r-a*s*o):"ZYX"===h?(this._x=a*i*r-n*s*o,this._y=n*s*r+a*i*o,this._z=n*i*o-a*s*r,this._w=n*i*r+a*s*o):"YZX"===h?(this._x=a*i*r+n*s*o,this._y=n*s*r+a*i*o,this._z=n*i*o-a*s*r,this._w=n*i*r-a*s*o):"XZY"===h&&(this._x=a*i*r-n*s*o,this._y=n*s*r-a*i*o,this._z=n*i*o+a*s*r,this._w=n*i*r+a*s*o),!1!==e&&this.onChangeCallback(),this},setFromRotationMatrix:function(t){var e,n=t.elements,i=n[0],r=n[4],a=n[8],s=n[1],o=n[5],h=n[9],c=n[2],u=n[6],l=n[10],d=i+o+l;return d>0?(e=.5/Math.sqrt(d+1),this._w=.25/e,this._x=(u-h)*e,this._y=(a-c)*e,this._z=(s-r)*e):i>o&&i>l?(e=2*Math.sqrt(1+i-o-l),this._w=(u-h)/e,this._x=.25*e,this._y=(r+s)/e,this._z=(a+c)/e):o>l?(e=2*Math.sqrt(1+o-i-l),this._w=(a-c)/e,this._x=(r+s)/e,this._y=.25*e,this._z=(h+u)/e):(e=2*Math.sqrt(1+l-i-o),this._w=(s-r)/e,this._x=(a+c)/e,this._y=(h+u)/e,this._z=.25*e),this.onChangeCallback(),this},setFromUnitVectors:function(t,e){var n=t.dot(e)+1;return n<1e-6?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()},multiply:function(t){return this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){var n=t._x,i=t._y,r=t._z,a=t._w,s=e._x,o=e._y,h=e._z,c=e._w;return this._x=n*c+a*s+i*h-r*o,this._y=i*c+a*o+r*s-n*h,this._z=r*c+a*h+n*o-i*s,this._w=a*c-n*s-i*o-r*h,this.onChangeCallback(),this},toMatrix4:function(t){t||(t=new Q);var e=t.elements,n=2*this._x*this._y,i=2*this._x*this._z,r=2*this._x*this._w,a=2*this._y*this._z,s=2*this._y*this._w,o=2*this._z*this._w,h=this._x*this._x,c=this._y*this._y,u=this._z*this._z,l=this._w*this._w;return e[0]=h-c-u+l,e[4]=n-o,e[8]=i+s,e[12]=0,e[1]=n+o,e[5]=-h+c-u+l,e[9]=a-r,e[13]=0,e[2]=i-s,e[6]=a+r,e[10]=-h-c+u+l,e[14]=0,e[3]=0,e[7]=0,e[11]=0,e[15]=1,t},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},setFromAxisAngle:function(t,e){var n=e/2,i=Math.sin(n);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(n),this.onChangeCallback(),this},fromArray:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}}),Object.assign(it,{slerpFlat:function(t,e,n,i,r,a,s){var o=n[i+0],h=n[i+1],c=n[i+2],u=n[i+3],l=r[a+0],d=r[a+1],p=r[a+2],f=r[a+3];if(u!==f||o!==l||h!==d||c!==p){var _=1-s,v=o*l+h*d+c*p+u*f,m=v>=0?1:-1,g=1-v*v;if(g>Number.EPSILON){var M=Math.sqrt(g),E=Math.atan2(M,v*m);_=Math.sin(_*E)/M,s=Math.sin(s*E)/M}var S=s*m;if(o=o*_+l*S,h=h*_+d*S,c=c*_+p*S,u=u*_+f*S,_===1-s){var x=1/Math.sqrt(o*o+h*h+c*c+u*u);o*=x,h*=x,c*=x,u*=x}}t[e]=o,t[e+1]=h,t[e+2]=c,t[e+3]=u}}),Object.assign(rt.prototype,{set:function(t,e,n,i){this.min.set(t,e),this.max.set(n,i)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this}});var at=[new D,new D,new D,new D,new D,new D,new D,new D];function st(t,e){this.min=void 0!==t?t:new D(1/0,1/0,1/0),this.max=void 0!==e?e:new D(-1/0,-1/0,-1/0)}Object.assign(st.prototype,{set:function(t,e){this.min.copy(t),this.max.copy(e)},setFromPoints:function(t){this.makeEmpty();for(var e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},expandByBox3:function(t){return this.min.min(t.min),this.max.max(t.max),this},setFromArray:function(t,e){for(var n=1/0,i=1/0,r=1/0,a=-1/0,s=-1/0,o=-1/0,h=void 0!==e?e:3,c=0,u=t.length;c<u;c+=h){var l=t[c],d=t[c+1],p=t[c+2];l<n&&(n=l),d<i&&(i=d),p<r&&(r=p),l>a&&(a=l),d>s&&(s=d),p>o&&(o=p)}return this.min.set(n,i,r),this.max.set(a,s,o),this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)},getCenter:function(t){var e=t||new D;return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},applyMatrix4:function(t){return this.isEmpty()||(at[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),at[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),at[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),at[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),at[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),at[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),at[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),at[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(at)),this},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this}});var ot=new st,ht=new D;function ct(t,e){this.center=void 0!==t?t:new D,this.radius=void 0!==e?e:0}Object.assign(ct.prototype,{set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromArray:function(t,e){var n=void 0!==e?e:3,i=this.center;ot.setFromArray(t,n).getCenter(i);for(var r=0,a=0,s=t.length;a<s;a+=n)ht.fromArray(t,a),r=Math.max(r,i.distanceToSquared(ht));return this.radius=Math.sqrt(r),this},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},getBoundingBox:function(t){var e=t||new st;return e.set(this.center,this.center),e.expandByScalar(this.radius),e},clone:function(){return(new ct).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this}});var ut=new D,lt=new nt;function dt(t,e){this.normal=void 0!==t?t:new D(1,0,0),this.constant=void 0!==e?e:0}Object.assign(dt.prototype,{set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,n,i){return this.normal.set(t,e,n),this.constant=i,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},normalize:function(){var t=1/this.normal.getLength();return this.normal.multiplyScalar(t),this.constant*=t,this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},coplanarPoint:function(t){return(t||new D).copy(this.normal).multiplyScalar(-this.constant)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},applyMatrix4:function(t,e){var n=e||lt.setFromMatrix4(t).inverse().transpose(),i=this.coplanarPoint(ut).applyMatrix4(t),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}});var pt=new D;function ft(t,e,n,i,r,a){this.planes=[void 0!==t?t:new dt,void 0!==e?e:new dt,void 0!==n?n:new dt,void 0!==i?i:new dt,void 0!==r?r:new dt,void 0!==a?a:new dt]}function _t(t,e,n){return this.r=0,this.g=0,this.b=0,void 0===e&&void 0===n?this.setHex(t):this.setRGB(t,e,n)}function vt(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}Object.assign(ft.prototype,{set:function(t,e,n,i,r,a){var s=this.planes;return s[0].copy(t),s[1].copy(e),s[2].copy(n),s[3].copy(i),s[4].copy(r),s[5].copy(a),this},setFromMatrix:function(t){var e=this.planes,n=t.elements,i=n[0],r=n[1],a=n[2],s=n[3],o=n[4],h=n[5],c=n[6],u=n[7],l=n[8],d=n[9],p=n[10],f=n[11],_=n[12],v=n[13],m=n[14],g=n[15];return e[0].setComponents(s-i,u-o,f-l,g-_).normalize(),e[1].setComponents(s+i,u+o,f+l,g+_).normalize(),e[2].setComponents(s+r,u+h,f+d,g+v).normalize(),e[3].setComponents(s-r,u-h,f-d,g-v).normalize(),e[4].setComponents(s-a,u-c,f-p,g-m).normalize(),e[5].setComponents(s+a,u+c,f+p,g+m).normalize(),this},intersectsSphere:function(t){for(var e=this.planes,n=t.center,i=-t.radius,r=0;r<6;r++){if(e[r].distanceToPoint(n)<i)return!1}return!0},intersectsBox:function(t){for(var e=this.planes,n=0;n<6;n++){var i=e[n];if(pt.x=i.normal.x>0?t.max.x:t.min.x,pt.y=i.normal.y>0?t.max.y:t.min.y,pt.z=i.normal.z>0?t.max.z:t.min.z,i.distanceToPoint(pt)<0)return!1}return!0},clone:function(){return(new this.constructor).copy(this)},copy:function(t){for(var e=this.planes,n=0;n<6;n++)e[n].copy(t.planes[n]);return this}}),Object.assign(_t.prototype,{lerpColors:function(t,e,n){this.r=n*(e.r-t.r)+t.r,this.g=n*(e.g-t.g)+t.g,this.b=n*(e.b-t.b)+t.b},lerp:function(t,e){this.lerpColors(this,t,e)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,e,n){return this.r=t,this.g=e,this.b=n,this},setHSL:function(t,e,n){var i;if(t=(t%(i=1)+i)%i,e=Math.max(0,Math.min(1,e)),n=Math.max(0,Math.min(1,n)),0===e)this.r=this.g=this.b=n;else{var r=n<=.5?n*(1+e):n+e-n*e,a=2*n-r;this.r=vt(a,r,t+1/3),this.g=vt(a,r,t),this.b=vt(a,r,t-1/3)}return this},fromArray:function(t,e){return void 0===e&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}});var mt=new D,gt=new D,Mt=new D,Et=new D;function St(t,e,n){this.a=void 0!==t?t:new D,this.b=void 0!==e?e:new D,this.c=void 0!==n?n:new D}function xt(t,e,n){this.radius=void 0!==t?t:1,this.phi=void 0!==e?e:0,this.theta=void 0!==n?n:0}function yt(){F.call(this),this.uuid=i(),this.textureType="",this.mipmaps=[],this.border=0,this.format=M.RGBA,this.internalformat=null,this.type=E.UNSIGNED_BYTE,this.magFilter=S.LINEAR,this.minFilter=S.LINEAR_MIPMAP_LINEAR,this.wrapS=x.CLAMP_TO_EDGE,this.wrapT=x.CLAMP_TO_EDGE,this.anisotropy=1,this.compare=void 0,this.generateMipmaps=!0,this.encoding=N.LINEAR,this.flipY=!0,this.version=0}function Tt(t,e,n){var i=this,r=!1,a=0,s=0,o=void 0;this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){s++,!1===r&&void 0!==i.onStart&&i.onStart(t,a,s),r=!0},this.itemEnd=function(t){a++,void 0!==i.onProgress&&i.onProgress(t,a,s),a===s&&(r=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(t){void 0!==i.onError&&i.onError(t)},this.resolveURL=function(t){return o?o(t):t},this.setURLModifier=function(t){return o=t,this}}Object.assign(St.prototype,{set:function(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}}),St.normal=function(t,e,n,i){var r=i||new D;r.subVectors(n,e),mt.subVectors(t,e),r.cross(mt);var a=r.getLengthSquared();return a>0?r.multiplyScalar(1/Math.sqrt(a)):r.set(0,0,0)},St.barycoordFromPoint=function(t,e,n,i,r){mt.subVectors(i,e),gt.subVectors(n,e),Mt.subVectors(t,e);var a=mt.dot(mt),s=mt.dot(gt),o=mt.dot(Mt),h=gt.dot(gt),c=gt.dot(Mt),u=a*h-s*s,l=r||new D;if(0===u)return l.set(-2,-1,-1);var d=1/u,p=(h*o-s*c)*d,f=(a*c-s*o)*d;return l.set(1-p-f,f,p)},St.containsPoint=function(t,e,n,i){return St.barycoordFromPoint(t,e,n,i,Et),Et.x>=0&&Et.y>=0&&Et.x+Et.y<=1},Object.assign(xt.prototype,{set:function(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this},copy:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},clone:function(){return(new this.constructor).copy(this)},makeSafe:function(){var t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this},setFromVector3:function(t){return this.radius=t.getLength(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t.x,t.z),this.phi=Math.acos(Math.min(1,Math.max(-1,t.y/this.radius)))),this}}),yt.prototype=Object.assign(Object.create(F.prototype),{constructor:yt,isTexture:!0,clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.textureType=t.textureType,this.border=t.border,this.format=t.format,this.internalformat=t.internalformat,this.type=t.type,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.anisotropy=t.anisotropy,this.generateMipmaps=t.generateMipmaps,this.encoding=t.encoding,this.flipY=t.flipY,this.version=t.version,this},dispose:function(){this.dispatchEvent({type:"dispose"}),this.version=0}});var wt=new Tt;function bt(t){this.crossOrigin=void 0,this.path=void 0,this.manager=void 0!==t?t:wt}function At(t){this.path=void 0,this.responseType=void 0,this.withCredentials=void 0,this.mimeType=void 0,this.requestHeader=void 0,this.manager=void 0!==t?t:wt}function Nt(t){this.manager=void 0!==t?t:wt}function Ct(t){this.manager=void 0!==t?t:wt,this.type=E.UNSIGNED_BYTE}function Rt(){yt.call(this),this.textureType=g.TEXTURE_2D,this.image=null,this.offset=new tt,this.repeat=new tt(1,1),this.center=new tt,this.rotation=0,this.matrix=new nt,this.matrixAutoUpdate=!0,this.useUVTransform=!0}function Pt(){yt.call(this),this.textureType=g.TEXTURE_CUBE_MAP,this.images=[],this.flipY=!1}function Lt(){yt.call(this),this.textureType=g.TEXTURE_3D,this.image={data:new Uint8Array([255,255,255,255,255,255,255,255]),width:2,height:2,depth:2},this.format=M.RED,this.internalformat=M.R8,this.type=E.UNSIGNED_BYTE,this.flipY=!1}Object.assign(bt.prototype,{load:function(t,e,n,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var r=this,a=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){a.removeEventListener("load",s,!1),a.removeEventListener("error",o,!1),e&&e(this),r.manager.itemEnd(t)}function o(e){a.removeEventListener("load",s,!1),a.removeEventListener("error",o,!1),i&&i(e),r.manager.itemError(t),r.manager.itemEnd(t)}return a.addEventListener("load",s,!1),a.addEventListener("error",o,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(t),a.src=t,a},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Object.assign(At.prototype,{load:function(t,e,n,i){void 0===t&&(t=""),null!=this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var r,a=this,s=t.match(/^data:(.*?)(;base64)?,(.*)$/);if(s){var o=s[1],h=!!s[2],c=s[3];c=decodeURIComponent(c),h&&(c=atob(c));try{var u,l=(this.responseType||"").toLowerCase();switch(l){case"arraybuffer":case"blob":u=new ArrayBuffer(c.length);for(var d=new Uint8Array(u),p=0;p<c.length;p++)d[p]=c.charCodeAt(p);"blob"===l&&(u=new Blob([u],{type:o}));break;case"document":var f=new DOMParser;u=f.parseFromString(c,o);break;case"json":u=JSON.parse(c);break;default:u=c}setTimeout((function(){e&&e(u),a.manager.itemEnd(t)}),0)}catch(e){setTimeout((function(){i&&i(e),a.manager.itemError(t),a.manager.itemEnd(t)}),0)}}else{for(var _ in(r=new XMLHttpRequest).open("GET",t,!0),r.addEventListener("load",(function(n){var r=this.response;200===this.status?(e&&e(r),a.manager.itemEnd(t)):0===this.status?(console.warn("zen3d.FileLoader: HTTP Status 0 received."),e&&e(r),a.manager.itemEnd(t)):(i&&i(n),a.manager.itemError(t),a.manager.itemEnd(t))}),!1),void 0!==n&&r.addEventListener("progress",(function(t){n(t)}),!1),void 0!==i&&r.addEventListener("error",(function(e){i(e),a.manager.itemError(t),a.manager.itemEnd(t)}),!1),void 0!==this.responseType&&(r.responseType=this.responseType),void 0!==this.withCredentials&&(r.withCredentials=this.withCredentials),r.overrideMimeType&&r.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)r.setRequestHeader(_,this.requestHeader[_]);r.send(null)}return a.manager.itemStart(t),r},setPath:function(t){return this.path=t,this},setResponseType:function(t){return this.responseType=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setMimeType:function(t){return this.mimeType=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}}),Object.assign(Nt.prototype,{load:function(t,e,n,i){var r=this,a=new At(this.manager);a.setResponseType("arraybuffer"),a.load(t,(function(t){void 0!==e&&e(r.parse(t))}),n,i)},parse:function(t){t.length<19&&console.error("TGALoader.parse: Not enough data to contain header.");var e=new Uint8Array(t),n=0,i={id_length:e[n++],colormap_type:e[n++],image_type:e[n++],colormap_index:e[n++]|e[n++]<<8,colormap_length:e[n++]|e[n++]<<8,colormap_size:e[n++],origin:[e[n++]|e[n++]<<8,e[n++]|e[n++]<<8],width:e[n++]|e[n++]<<8,height:e[n++]|e[n++]<<8,pixel_size:e[n++],flags:e[n++]};!function(t){switch(t.image_type){case 1:case 9:(t.colormap_length>256||24!==t.colormap_size||1!==t.colormap_type)&&console.error("TGALoader.parse.tgaCheckHeader: Invalid type colormap data for indexed type");break;case 2:case 3:case 10:case 11:t.colormap_type&&console.error("TGALoader.parse.tgaCheckHeader: Invalid type colormap data for colormap type");break;case 0:console.error("TGALoader.parse.tgaCheckHeader: No data");default:console.error('TGALoader.parse.tgaCheckHeader: Invalid type " '+t.image_type+'"')}(t.width<=0||t.height<=0)&&console.error("TGALoader.parse.tgaCheckHeader: Invalid image size"),8!==t.pixel_size&&16!==t.pixel_size&&24!==t.pixel_size&&32!==t.pixel_size&&console.error('TGALoader.parse.tgaCheckHeader: Invalid pixel size "'+t.pixel_size+'"')}(i),i.id_length+n>t.length&&console.error("TGALoader.parse: No data"),n+=i.id_length;var r=!1,a=!1,s=!1;switch(i.image_type){case 9:r=!0,a=!0;break;case 1:a=!0;break;case 10:r=!0;break;case 2:break;case 11:r=!0,s=!0;break;case 3:s=!0}var o=document.createElement("canvas");o.width=i.width,o.height=i.height;var h=o.getContext("2d"),c=h.createImageData(i.width,i.height),u=function(t,e,n,i,r){var a,s,o,h;if(s=n.pixel_size>>3,o=n.width*n.height*s,e&&(h=r.subarray(i,i+=n.colormap_length*(n.colormap_size>>3))),t){var c,u,l;a=new Uint8Array(o);for(var d=0,p=new Uint8Array(s);d<o;)if(u=1+(127&(c=r[i++])),128&c){for(l=0;l<s;++l)p[l]=r[i++];for(l=0;l<u;++l)a.set(p,d+l*s);d+=s*u}else{for(u*=s,l=0;l<u;++l)a[d+l]=r[i++];d+=u}}else a=r.subarray(i,i+=e?n.width*n.height:o);return{pixel_data:a,palettes:h}}(r,a,i,n,e);return function(t,e,n,r,a){var o,h,c,u,l,d;switch((48&i.flags)>>4){default:case 2:o=0,c=1,l=e,h=0,u=1,d=n;break;case 0:o=0,c=1,l=e,h=n-1,u=-1,d=-1;break;case 3:o=e-1,c=-1,l=-1,h=0,u=1,d=n;break;case 1:o=e-1,c=-1,l=-1,h=n-1,u=-1,d=-1}if(s)switch(i.pixel_size){case 8:!function(t,e,n,r,a,s,o,h){var c,u,l,d=0,p=i.width;for(l=e;l!==r;l+=n)for(u=a;u!==o;u+=s,d++)c=h[d],t[4*(u+p*l)+0]=c,t[4*(u+p*l)+1]=c,t[4*(u+p*l)+2]=c,t[4*(u+p*l)+3]=255}(t,h,u,d,o,c,l,r);break;case 16:!function(t,e,n,r,a,s,o,h){var c,u,l=0,d=i.width;for(u=e;u!==r;u+=n)for(c=a;c!==o;c+=s,l+=2)t[4*(c+d*u)+0]=h[l+0],t[4*(c+d*u)+1]=h[l+0],t[4*(c+d*u)+2]=h[l+0],t[4*(c+d*u)+3]=h[l+1]}(t,h,u,d,o,c,l,r);break;default:console.error("TGALoader.parse.getTgaRGBA: not support this format")}else switch(i.pixel_size){case 8:!function(t,e,n,r,a,s,o,h,c){var u,l,d,p=c,f=0,_=i.width;for(d=e;d!==r;d+=n)for(l=a;l!==o;l+=s,f++)u=h[f],t[4*(l+_*d)+3]=255,t[4*(l+_*d)+2]=p[3*u+0],t[4*(l+_*d)+1]=p[3*u+1],t[4*(l+_*d)+0]=p[3*u+2]}(t,h,u,d,o,c,l,r,a);break;case 16:!function(t,e,n,r,a,s,o,h){var c,u,l,d=0,p=i.width;for(l=e;l!==r;l+=n)for(u=a;u!==o;u+=s,d+=2)c=h[d+0]+(h[d+1]<<8),t[4*(u+p*l)+0]=(31744&c)>>7,t[4*(u+p*l)+1]=(992&c)>>2,t[4*(u+p*l)+2]=(31&c)>>3,t[4*(u+p*l)+3]=32768&c?0:255}(t,h,u,d,o,c,l,r);break;case 24:!function(t,e,n,r,a,s,o,h){var c,u,l=0,d=i.width;for(u=e;u!==r;u+=n)for(c=a;c!==o;c+=s,l+=3)t[4*(c+d*u)+3]=255,t[4*(c+d*u)+2]=h[l+0],t[4*(c+d*u)+1]=h[l+1],t[4*(c+d*u)+0]=h[l+2]}(t,h,u,d,o,c,l,r);break;case 32:!function(t,e,n,r,a,s,o,h){var c,u,l=0,d=i.width;for(u=e;u!==r;u+=n)for(c=a;c!==o;c+=s,l+=4)t[4*(c+d*u)+2]=h[l+0],t[4*(c+d*u)+1]=h[l+1],t[4*(c+d*u)+0]=h[l+2],t[4*(c+d*u)+3]=h[l+3]}(t,h,u,d,o,c,l,r);break;default:console.error("TGALoader.parse.getTgaRGBA: not support this format")}}(c.data,i.width,i.height,u.pixel_data,u.palettes),h.putImageData(c,0,0),o}}),Object.assign(Ct.prototype,{load:function(t,e,n,i){var r=this,a=new At(this.manager);a.setResponseType("arraybuffer"),a.load(t,(function(t){void 0!==e&&e(r.parse(t))}),n,i)},parse:function(t){var e=function(t,e){switch(t){case 1:console.error("zen3d.RGBELoader Read Error: "+(e||""));break;case 2:console.error("zen3d.RGBELoader Write Error: "+(e||""));break;case 3:console.error("zen3d.RGBELoader Bad File Format: "+(e||""));break;default:case 4:console.error("zen3d.RGBELoader: Error: "+(e||""))}return-1},n=function(t,e,n){e=e||1024;for(var i=t.pos,r=-1,a=0,s="",o=String.fromCharCode.apply(null,new Uint16Array(t.subarray(i,i+128)));0>(r=o.indexOf("\n"))&&a<e&&i<t.byteLength;)s+=o,a+=o.length,i+=128,o+=String.fromCharCode.apply(null,new Uint16Array(t.subarray(i,i+128)));return-1<r&&(!1!==n&&(t.pos+=a+r+1),s+o.slice(0,r))},i=new Uint8Array(t);i.pos=0;var r,a,s,o,h,c,u=function(t){var i,r,a=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*FORMAT=(\S+)\s*$/,h=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,c={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(t.pos>=t.byteLength||!(i=n(t)))return e(1,"no header found");if(!(r=i.match(/^#\?(\S+)$/)))return e(3,"bad initial token");for(c.valid|=1,c.programtype=r[1],c.string+=i+"\n";!1!==(i=n(t));)if(c.string+=i+"\n","#"!==i.charAt(0)){if((r=i.match(a))&&(c.gamma=parseFloat(r[1])),(r=i.match(s))&&(c.exposure=parseFloat(r[1])),(r=i.match(o))&&(c.valid|=2,c.format=r[1]),(r=i.match(h))&&(c.valid|=4,c.height=parseInt(r[1],10),c.width=parseInt(r[2],10)),2&c.valid&&4&c.valid)break}else c.comments+=i+"\n";return 2&c.valid?4&c.valid?c:e(3,"missing image size specifier"):e(3,"missing format specifier")}(i);if(-1!==u){var l=u.width,d=u.height,p=function(t,n,i){var r,a,s,o,h,c,u,l,d,p,f,_,v,m=n,g=i;if(m<8||m>32767||2!==t[0]||2!==t[1]||128&t[2])return new Uint8Array(t);if(m!==(t[2]<<8|t[3]))return e(3,"wrong scanline width");if(!(r=new Uint8Array(4*n*i)).length)return e(4,"unable to allocate buffer space");for(a=0,s=0,l=4*m,v=new Uint8Array(4),c=new Uint8Array(l);g>0&&s<t.byteLength;){if(s+4>t.byteLength)return e(1);if(v[0]=t[s++],v[1]=t[s++],v[2]=t[s++],v[3]=t[s++],2!=v[0]||2!=v[1]||(v[2]<<8|v[3])!=m)return e(3,"bad rgbe scanline format");for(u=0;u<l&&s<t.byteLength;){if((_=(o=t[s++])>128)&&(o-=128),0===o||u+o>l)return e(3,"bad scanline data");if(_)for(h=t[s++],d=0;d<o;d++)c[u++]=h;else c.set(t.subarray(s,s+o),u),u+=o,s+=o}for(p=m,d=0;d<p;d++)f=0,r[a]=c[d+f],f+=m,r[a+1]=c[d+f],f+=m,r[a+2]=c[d+f],f+=m,r[a+3]=c[d+f],a+=4;g--}return r}(i.subarray(i.pos),l,d);if(-1!==p){if(this.type===E.UNSIGNED_BYTE)var f=p,_=M.RGBA,v=E.UNSIGNED_BYTE;else if(this.type===E.FLOAT){for(var m=p.length/4*3,g=new Float32Array(m),S=0;S<m;S++)s=g,o=3*S,h=void 0,c=void 0,h=(r=p)[(a=4*S)+3],c=Math.pow(2,h-128)/255,s[o+0]=r[a+0]*c,s[o+1]=r[a+1]*c,s[o+2]=r[a+2]*c;f=g,_=M.RGB,v=E.FLOAT}else console.error("zen3d.RGBELoader: unsupported type: ",this.type);return{width:l,height:d,data:f,header:u.string,gamma:u.gamma,exposure:u.exposure,format:_,type:v}}}return null}}),Rt.prototype=Object.assign(Object.create(yt.prototype),{constructor:Rt,copy:function(t){return yt.prototype.copy.call(this,t),this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this},updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}}),Rt.fromImage=function(t){var e=new Rt;return e.image=t,e.version++,e},Rt.fromSrc=function(t){var e=new Rt,n=t.search(/\.(jpg|jpeg)$/)>0||0===t.search(/^data\:image\/jpeg/),i=t.search(/\.(tga)$/)>0||0===t.search(/^data\:image\/tga/);t.search(/\.(hdr)$/)>0?(new Ct).load(t,(function(t){e.image={data:t.data,width:t.width,height:t.height},e.encoding=zen3d.TEXEL_ENCODING_TYPE.RGBE,e.type=t.type,e.format=t.format,e.version++,e.dispatchEvent({type:"onload"})})):(i?new Nt:new bt).load(t,(function(t){e.format=n?M.RGB:M.RGBA,e.image=t,e.version++,e.dispatchEvent({type:"onload"})}));return e},Pt.prototype=Object.assign(Object.create(yt.prototype),{constructor:Pt,copy:function(t){return yt.prototype.copy.call(this,t),this.images=t.images.slice(0),this}}),Pt.fromImage=function(t){for(var e=new Pt,n=e.images,i=0;i<6;i++)n[i]=t[i];return e.version++,e},Pt.fromSrc=function(t){var e,n=new Pt,i=n.images,r=t[0],a=r.search(/\.(jpg|jpeg)$/)>0||0===r.search(/^data\:image\/jpeg/),s=r.search(/\.(tga)$/)>0||0===r.search(/^data\:image\/tga/),o=r.search(/\.(hdr)$/)>0;e=o?new Ct:s?new Nt:new bt;var h=0;return function r(s){s&&(o?i.push({data:s.data,width:s.width,height:s.height}):i.push(s),h++),h>=6?function(t){t?(n.encoding=N.RGBE,n.type=t.type,n.format=t.format):n.format=a?M.RGB:M.RGBA;n.version++,n.dispatchEvent({type:"onload"})}(o?s:void 0):e.load(t[h],r)}(),n},Lt.prototype=Object.assign(Object.create(yt.prototype),{constructor:Lt});var Ot=0,Ft=new Q;function Ut(){Object.defineProperty(this,"id",{value:Ot++}),this.uuid=i(),this.name="",this.type="",this.position=new D,this.scale=new D(1,1,1),this.euler=new J,this.quaternion=new it;var t=this.euler,e=this.quaternion;t.onChange((function(){e.setFromEuler(t,!1)})),e.onChange((function(){t.setFromQuaternion(e,void 0,!1)})),this.matrix=new Q,this.worldMatrix=new Q,this.children=new Array,this.parent=null,this.castShadow=!1,this.receiveShadow=!1,this.shadowType=A.PCF3_SOFT,this.frustumCulled=!0,this.visible=!0,this.renderOrder=0,this.userData={},this.matrixAutoUpdate=!0,this.matrixNeedsUpdate=!0,this.worldMatrixNeedsUpdate=!0}function Dt(){Ut.call(this),this.type="bone",this.offsetMatrix=new Q}Object.assign(Ut.prototype,{onBeforeRender:function(){},onAfterRender:function(){},add:function(t){t!==this?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.worldMatrixNeedsUpdate=!0):console.error("Object3D.add: object can't be added as a child of itself.",t)},remove:function(t){var e=this.children.indexOf(t);-1!==e&&(t.parent=null,this.children.splice(e,1),t.worldMatrixNeedsUpdate=!0)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(var n=0,i=this.children.length;n<i;n++){var r=this.children[n].getObjectByProperty(t,e);if(void 0!==r)return r}},updateMatrix:function(t){if((this.matrixAutoUpdate||this.matrixNeedsUpdate)&&(this.matrix.transform(this.position,this.scale,this.quaternion),this.matrixNeedsUpdate=!1,this.worldMatrixNeedsUpdate=!0),this.worldMatrixNeedsUpdate||t){if(this.worldMatrix.copy(this.matrix),this.parent){var e=this.parent.worldMatrix;this.worldMatrix.premultiply(e)}this.worldMatrixNeedsUpdate=!1,t=!0}for(var n=this.children,i=0,r=n.length;i<r;i++)n[i].updateMatrix(t)},getWorldDirection:function(t){t=t||new D;var e=this.worldMatrix.elements;return t.set(e[8],e[9],e[10]).normalize()},lookAt:function(t,e){Ft.lookAtRH(t,this.position,e),this.quaternion.setFromRotationMatrix(Ft)},raycast:function(t,e){},traverse:function(t){t(this);for(var e=this.children,n=0,i=e.length;n<i;n++)e[n].traverse(t)},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e){if(void 0===e&&(e=!0),this.name=t.name,this.type=t.type,this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.worldMatrix.copy(t.worldMatrix),this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(var n=0;n<t.children.length;n++){var i=t.children[n];this.add(i.clone())}return this}}),Dt.prototype=Object.create(Ut.prototype),Dt.prototype.constructor=Dt;var It=new Q;function Bt(t){t=t||[],this.bones=t.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.boneTexture=void 0}function zt(t,e,n,i,r){if(i>=.5)for(var a=0;a!==r;++a)t[e+a]=t[n+a]}function Gt(t,e,n,i){it.slerpFlat(t,e,t,e,t,n,i)}function Ht(t,e,n,i,r){for(var a=1-i,s=0;s!==r;++s){var o=e+s;t[o]=t[o]*a+t[n+s]*i}}function kt(t,e,n,i){this.target=null,this.property="",this.parseBinding(t,e),this.valueSize=i;var r,a=Float64Array;switch(n){case"quaternion":r=Gt;break;case"string":case"bool":a=Array,r=zt;break;default:r=Ht}this.buffer=new a(3*i),this._mixBufferFunction=r,this.cumulativeWeight=0,this.referenceCount=0,this.useCount=0}function Vt(){this._clips={},this._bindings={},this._activeClips={}}function jt(t,e,n,i,r){this.target=t,this.propertyPath=e,this.name=this.target.uuid+"."+e,this.times=n,this.values=i,this.valueSize=i.length/n.length,this.interpolant=void 0===r||r}function Wt(t,e,n,i,r){jt.call(this,t,e,n,i,r)}function Xt(t,e,n,i,r){jt.call(this,t,e,n,i,r)}function Yt(t){this.name=t||"",this.tracks=[],this.loop=!0,this.startFrame=0,this.endFrame=0,this.frame=0}function qt(t,e,n,i,r){jt.call(this,t,e,n,i,r)}function Zt(t,e,n,i,r){jt.call(this,t,e,n,i,r)}function Kt(t,e,n,i,r){jt.call(this,t,e,n,i,r)}function Qt(t,e,n,i,r){jt.call(this,t,e,n,i,r)}function $t(t,e,n){this.array=t,this.size=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===n,this.usage=O.STATIC_DRAW,this.updateRange={offset:0,count:-1},this.version=0}function Jt(t,e){return(Jt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}Object.assign(Bt.prototype,{pose:function(){for(var t=0;t<this.bones.length;t++){(e=this.bones[t]).worldMatrix.getInverse(e.offsetMatrix)}for(t=0;t<this.bones.length;t++){var e;(e=this.bones[t]).parent&&"bone"==e.parent.type?(e.matrix.getInverse(e.parent.worldMatrix),e.matrix.multiply(e.worldMatrix)):e.matrix.copy(e.worldMatrix),e.matrix.decompose(e.position,e.quaternion,e.scale)}},updateBones:function(){for(var t=0;t<this.bones.length;t++){var e=this.bones[t];It.multiplyMatrices(e.worldMatrix,e.offsetMatrix),It.toArray(this.boneMatrices,16*t)}void 0!==this.boneTexture&&this.boneTexture.version++},getBoneByName:function(t){for(var e=0,n=this.bones.length;e<n;e++){var i=this.bones[e];if(i.name===t)return i}}}),Object.assign(kt.prototype,{parseBinding:function(t,e){if((e=e.split(".")).length>1){for(var n=t[e[0]],i=1;i<e.length-1;i++)n=n[e[i]];this.property=e[e.length-1],this.target=n}else this.property=e[0],this.target=t},saveOriginalState:function(){var t=this.buffer,e=this.valueSize,n=2*e;this.valueSize>1?this.target[this.property].toArray?this.target[this.property].toArray(t,n):function(t,e,n,i){for(var r=0;r<i;r++)t[n+r]=e[r]}(t,this.target[this.property],n,this.valueSize):this.target[this.property]=t[n];for(var i=e,r=n;i!==r;++i)t[i]=t[n+i%e];this.cumulativeWeight=0},restoreOriginalState:function(){for(var t=this.buffer,e=this.valueSize,n=2*e,i=e,r=n;i!==r;++i)t[i]=t[n+i%e];this.apply()},accumulate:function(t){var e=this.buffer,n=this.valueSize,i=n,r=this.cumulativeWeight;if(0===r){for(var a=0;a!==n;++a)e[i+a]=e[a];r=t}else{var s=t/(r+=t);this._mixBufferFunction(e,i,0,s,n)}this.cumulativeWeight=r},apply:function(){var t=this.buffer,e=this.valueSize,n=this.cumulativeWeight;if(this.cumulativeWeight=0,n<1){var i=2*e;this._mixBufferFunction(t,e,i,1-n,e)}this.valueSize>1?this.target[this.property].fromArray?this.target[this.property].fromArray(t,e):function(t,e,n,i){for(var r=0;r<i;r++)t[r]=e[n+r]}(this.target[this.property],t,e,this.valueSize):this.target[this.property]=t[e]}}),Object.assign(Vt.prototype,{add:function(t){if(void 0===this._clips[t.name]){for(var e=t.tracks,n=0;n<e.length;n++){var i,r=e[n],a=r.name;this._bindings[a]?i=this._bindings[a]:(i=new kt(r.target,r.propertyPath,r.valueTypeName,r.valueSize),this._bindings[a]=i),i.referenceCount++}this._clips[t.name]=t}else console.warn("AnimationMixer.add: already has clip: "+t.name)},remove:function(t){if(this._clips[t.name]){for(var e=t.tracks,n=0;n<e.length;n++){var i=e[n].name,r=this._bindings[i];r&&r.referenceCount--,r.referenceCount<=0&&delete this._bindings[i]}delete this._clips[t.name]}else console.warn("AnimationMixer.remove: has no clip: "+t.name)},play:function(t,e){if(void 0===this._activeClips[t]){this._activeClips[t]=void 0===e?1:e;var n=this._clips[t];if(n){n.frame=0;for(var i=n.tracks,r=0;r<i.length;r++){var a=i[r].name,s=this._bindings[a];s&&0==s.useCount++&&s.saveOriginalState()}}else console.warn("AnimationMixer.stop: clip "+t+" is not found.")}else console.warn("AnimationMixer.play: clip "+t+" is playing.")},stop:function(t){if(void 0!==this._activeClips[t]){delete this._activeClips[t];var e=this._clips[t];if(e)for(var n=e.tracks,i=0;i<n.length;i++){var r=n[i].name,a=this._bindings[r];a&&a.useCount>0&&0==--a.useCount&&a.restoreOriginalState()}else console.warn("AnimationMixer.stop: clip "+t+" is not found.")}else console.warn("AnimationMixer.stop: clip "+t+" is not playing.")},update:function(t){for(var e in this._activeClips){var n=this._clips[e],i=this._activeClips[e];n.update(t,this._bindings,i)}for(var r in this._bindings)this._bindings[r].useCount>0&&this._bindings[r].apply()},setClipWeight:function(t,e){void 0!==this._activeClips[t]?this._activeClips[t]=e:console.warn("AnimationMixer.stop: clip "+t+" is not playing.")},getAllClipNames:function(){var t=[];for(var e in this._clips)t.push(e);return t}}),Object.assign(jt.prototype,{_getLastTimeIndex:function(t){var e,n=0,i=this.times.length;for(e=0;e<i;e++)t>=this.times[e]&&(n=e);return n},getValue:function(t,e){for(var n,i,r=this._getLastTimeIndex(t),a=this.times,s=this.values,o=this.valueSize,h=a[r],c=a[r+1],u=0;u<o;u++)if(n=s[r*o+u],i=s[(r+1)*o+u],this.interpolant)if(void 0!==n&&void 0!==i){var l=(t-h)/(c-h);e[u]=n*(1-l)+i*l}else e[u]=n;else e[u]=n}}),Wt.prototype=Object.assign(Object.create(jt.prototype),{constructor:Wt,valueTypeName:"bool",getValue:function(t,e){var n=this._getLastTimeIndex(t),i=this.times[n];e[0]=this.values[i]}}),Xt.prototype=Object.assign(Object.create(jt.prototype),{constructor:Xt,valueTypeName:"color"}),Object.assign(Yt.prototype,{update:function(t,e,n){this.frame+=t,this.frame>this.endFrame&&(this.loop?this.frame=this.startFrame:this.frame=this.endFrame);for(var i=0,r=this.tracks.length;i<r;i++){var a=this.tracks[i],s=e[a.name];a.getValue(this.frame,s.buffer),s.accumulate(n)}}}),qt.prototype=Object.assign(Object.create(jt.prototype),{constructor:qt,valueTypeName:"number"}),Zt.prototype=Object.assign(Object.create(jt.prototype),{constructor:Zt,valueTypeName:"quaternion",getValue:function(t,e){var n=this._getLastTimeIndex(t),i=this.times,r=this.values,a=i[n],s=i[n+1],o=0;if(this.interpolant)if(void 0!==s){var h=(t-a)/(s-a);it.slerpFlat(e,0,r,4*n,r,4*(n+1),h)}else for(o=0;o<4;o++)e[o]=r[4*n+o];else for(o=0;o<4;o++)e[o]=r[4*n+o]}}),Kt.prototype=Object.assign(Object.create(jt.prototype),{constructor:Kt,valueTypeName:"string",getValue:function(t,e){var n=this._getLastTimeIndex(t),i=this.times[n];e[0]=this.values[i]}}),Qt.prototype=Object.assign(Object.create(jt.prototype),{constructor:Qt,valueTypeName:"vector"}),Object.assign($t.prototype,{setArray:function(t){return this.count=void 0!==t?t.length/this.size:0,this.array=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.size=t.size,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this},clone:function(){return new this.constructor(this.array,this.size).copy(this)}});var te=1;function ee(){F.call(this),Object.defineProperty(this,"id",{value:te++}),this.uuid=i(),this.attributes={},this.morphAttributes={},this.index=null,this.boundingBox=new st,this.boundingSphere=new ct,this.groups=[],this.version=0}ee.prototype=Object.assign(Object.create(F.prototype),{constructor:ee,addAttribute:function(t,e){this.attributes[t]=e},getAttribute:function(t){return this.attributes[t]},removeAttribute:function(t){delete this.attributes[t]},setIndex:function(t){Array.isArray(t)?this.index=new $t(new Uint16Array(t),1):this.index=t},addGroup:function(t,e,n){this.groups.push({start:t,count:e,materialIndex:void 0!==n?n:0})},clearGroups:function(){this.groups=[]},computeBoundingBox:function(){var t=this.attributes.a_Position||this.attributes.position;if(t.isInterleavedBufferAttribute){var e=t.data;this.boundingBox.setFromArray(e.array,e.stride)}else this.boundingBox.setFromArray(t.array,t.size)},computeBoundingSphere:function(){var t=this.attributes.a_Position||this.attributes.position;if(t.isInterleavedBufferAttribute){var e=t.data;this.boundingSphere.setFromArray(e.array,e.stride)}else this.boundingSphere.setFromArray(t.array,t.size)},dispose:function(){this.dispatchEvent({type:"dispose"})},copy:function(t){var e,n,i;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;var r=t.index;null!==r&&this.setIndex(r.clone());var a=t.attributes;for(e in a){var s=a[e];this.addAttribute(e,s.clone())}var o=t.morphAttributes;for(e in o){var h=[],c=o[e];for(n=0,i=c.length;n<i;n++)h.push(c[n].clone());this.morphAttributes[e]=h}var u=t.groups;for(n=0,i=u.length;n<i;n++){var l=u[n];this.addGroup(l.start,l.count,l.materialIndex)}var d=t.boundingBox;null!==d&&(this.boundingBox=(new st).copy(d));var p=t.boundingSphere;return null!==p&&(this.boundingSphere=(new ct).copy(p)),this},clone:function(){return(new ee).copy(this)}});var ne=function(t){var e,n;function i(e,n,i,r,a,s){var o;return(o=t.call(this)||this).buildGeometry(e,n,i,r,a,s),o}return n=t,(e=i).prototype=Object.create(n.prototype),e.prototype.constructor=e,Jt(e,n),i.prototype.buildGeometry=function(t,e,n,i,r,a){var s=this;t=t||1,e=e||1,n=n||1,i=Math.floor(i)||1,r=Math.floor(r)||1,a=Math.floor(a)||1;var o=[],h=[],c=[],u=[],l=0,d=0;function p(t,e,n,i,r,a,p,f,_,v,m){var g,M,E=a/_,S=p/v,x=a/2,y=p/2,T=f/2,w=_+1,b=v+1,A=0,N=0,C=new D;for(M=0;M<b;M++){var R=M*S-y;for(g=0;g<w;g++){var P=g*E-x;C[t]=P*i,C[e]=R*r,C[n]=T,h.push(C.x,C.y,C.z),C[t]=0,C[e]=0,C[n]=f>0?1:-1,c.push(C.x,C.y,C.z),u.push(g/_),u.push(1-M/v),A+=1}}for(M=0;M<v;M++)for(g=0;g<_;g++){var L=l+g+w*M,O=l+g+w*(M+1),F=l+(g+1)+w*(M+1),U=l+(g+1)+w*M;o.push(L,O,U),o.push(O,F,U),N+=6}s.addGroup(d,N,m),d+=N,l+=A}p("z","y","x",-1,-1,n,e,t,a,r,0),p("z","y","x",1,-1,n,e,-t,a,r,1),p("x","z","y",1,1,t,n,e,i,a,2),p("x","z","y",1,-1,t,n,-e,i,a,3),p("x","y","z",1,-1,t,e,n,i,r,4),p("x","y","z",-1,-1,t,e,-n,i,r,5),this.setIndex(o),this.addAttribute("a_Position",new $t(new Float32Array(h),3)),this.addAttribute("a_Normal",new $t(new Float32Array(c),3)),this.addAttribute("a_Uv",new $t(new Float32Array(u),2)),this.computeBoundingBox(),this.computeBoundingSphere()},i}(ee);function ie(t,e,n,i,r,a,s,o){ee.call(this),this.buildGeometry(t,e,n,i,r,a,s,o)}function re(t,e,n,i){$t.call(this,t,e,n),this.meshPerAttribute=i||1}function ae(){ee.call(this),this.instanceCount=1/0}function se(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=O.STATIC_DRAW,this.updateRange={offset:0,count:-1},this.version=0}function oe(t,e,n){se.call(this,t,e),this.meshPerAttribute=n||1}function he(t,e,n,i){this.data=t,this.size=e,this.offset=n,this.normalized=!0===i}function ce(t,e,n,i){ee.call(this),this.buildGeometry(t,e,n,i)}function ue(t,e,n,i,r,a,s){ee.call(this),this.buildGeometry(t,e,n,i,r,a,s)}function le(t,e,n,i,r,a){ee.call(this),this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:i,p:r,q:a},t=t||1,e=e||.4,n=Math.floor(n)||64,i=Math.floor(i)||8,r=r||2,a=a||3;var s,o,h=[],c=[],u=[],l=[],d=new D,p=new D,f=new D,_=new D,v=new D,m=new D,g=new D;for(s=0;s<=n;++s){var M=s/n*r*Math.PI*2;for(A(M,r,a,t,f),A(M+.01,r,a,t,_),m.subVectors(_,f),g.addVectors(_,f),v.crossVectors(m,g),g.crossVectors(v,m),v.normalize(),g.normalize(),o=0;o<=i;++o){var E=o/i*Math.PI*2,S=-e*Math.cos(E),x=e*Math.sin(E);d.x=f.x+(S*g.x+x*v.x),d.y=f.y+(S*g.y+x*v.y),d.z=f.z+(S*g.z+x*v.z),c.push(d.x,d.y,d.z),p.subVectors(d,f).normalize(),u.push(p.x,p.y,p.z),l.push(s/n),l.push(o/i)}}for(o=1;o<=n;o++)for(s=1;s<=i;s++){var y=(i+1)*(o-1)+(s-1),T=(i+1)*o+(s-1),w=(i+1)*o+s,b=(i+1)*(o-1)+s;h.push(y,T,b),h.push(T,w,b)}function A(t,e,n,i,r){var a=Math.cos(t),s=Math.sin(t),o=n/e*t,h=Math.cos(o);r.x=i*(2+h)*.5*a,r.y=i*(2+h)*s*.5,r.z=i*Math.sin(o)*.5}this.setIndex(h),this.addAttribute("a_Position",new $t(new Float32Array(c),3)),this.addAttribute("a_Normal",new $t(new Float32Array(u),3)),this.addAttribute("a_Uv",new $t(new Float32Array(l),2)),this.computeBoundingBox(),this.computeBoundingSphere()}ie.prototype=Object.assign(Object.create(ee.prototype),{constructor:ie,buildGeometry:function(t,e,n,i,r,a,s,o){var h=this;t=void 0!==t?t:1,e=void 0!==e?e:1,n=n||1,i=Math.floor(i)||8,r=Math.floor(r)||1,a=void 0!==a&&a,s=void 0!==s?s:0,o=void 0!==o?o:2*Math.PI;var c=[],u=[],l=[],d=[],p=0,f=[],_=n/2,v=0;function m(n){var r,a,f,m=new tt,g=new D,M=0,E=!0===n?t:e,S=!0===n?1:-1;for(a=p,r=1;r<=i;r++)u.push(0,_*S,0),l.push(0,S,0),d.push(.5,.5),p++;for(f=p,r=0;r<=i;r++){var x=r/i*o+s,y=Math.cos(x),T=Math.sin(x);g.x=E*T,g.y=_*S,g.z=E*y,u.push(g.x,g.y,g.z),l.push(0,S,0),m.x=.5*y+.5,m.y=.5*T*S+.5,d.push(m.x,m.y),p++}for(r=0;r<i;r++){var w=a+r,b=f+r;!0===n?c.push(b,b+1,w):c.push(b+1,b,w),M+=3}h.addGroup(v,M,!0===n?1:2),v+=M}!function(){var a,m,g=new D,M=new D,E=0,S=(e-t)/n;for(m=0;m<=r;m++){var x=[],y=m/r,T=y*(e-t)+t;for(a=0;a<=i;a++){var w=a/i,b=w*o+s,A=Math.sin(b),N=Math.cos(b);M.x=T*A,M.y=-y*n+_,M.z=T*N,u.push(M.x,M.y,M.z),g.set(A,S,N).normalize(),l.push(g.x,g.y,g.z),d.push(w,1-y),x.push(p++)}f.push(x)}for(a=0;a<i;a++)for(m=0;m<r;m++){var C=f[m][a],R=f[m+1][a],P=f[m+1][a+1],L=f[m][a+1];c.push(C,R,L),c.push(R,P,L),E+=6}h.addGroup(v,E,0),v+=E}(),!1===a&&(t>0&&m(!0),e>0&&m(!1)),this.setIndex(c),this.addAttribute("a_Position",new $t(new Float32Array(u),3)),this.addAttribute("a_Normal",new $t(new Float32Array(l),3)),this.addAttribute("a_Uv",new $t(new Float32Array(d),2)),this.computeBoundingBox(),this.computeBoundingSphere()}}),re.prototype=Object.assign(Object.create($t.prototype),{constructor:re,isInstancedBufferAttribute:!0,copy:function(t){return $t.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}}),ae.prototype=Object.assign(Object.create(ee.prototype),{constructor:ae,isInstancedGeometry:!0}),Object.assign(se.prototype,{setArray:function(t){this.count=void 0!==t?t.length/this.stride:0,this.array=t}}),oe.prototype=Object.assign(Object.create(se.prototype),{constructor:oe,isInstancedInterleavedBuffer:!0}),he.prototype.isInterleavedBufferAttribute=!0,Object.defineProperties(he.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),ce.prototype=Object.assign(Object.create(ee.prototype),{constructor:ce,buildGeometry:function(t,e,n,i){var r,a,s=(t=t||1)/2,o=(e=e||1)/2,h=Math.floor(n)||1,c=Math.floor(i)||1,u=h+1,l=c+1,d=t/h,p=e/c,f=[],_=[],v=[],m=[];for(a=0;a<l;a++){var g=a*p-o;for(r=0;r<u;r++){var M=r*d-s;_.push(M,0,g),v.push(0,1,0),m.push(r/h),m.push(1-a/c)}}for(a=0;a<c;a++)for(r=0;r<h;r++){var E=r+u*a,S=r+u*(a+1),x=r+1+u*(a+1),y=r+1+u*a;f.push(E,S,y),f.push(S,x,y)}this.setIndex(f),this.addAttribute("a_Position",new $t(new Float32Array(_),3)),this.addAttribute("a_Normal",new $t(new Float32Array(v),3)),this.addAttribute("a_Uv",new $t(new Float32Array(m),2)),this.computeBoundingBox(),this.computeBoundingSphere()}}),ue.prototype=Object.assign(Object.create(ee.prototype),{constructor:ue,buildGeometry:function(t,e,n,i,r,a,s){t=t||1,e=Math.max(3,Math.floor(e)||8),n=Math.max(2,Math.floor(n)||6),i=void 0!==i?i:0,r=void 0!==r?r:2*Math.PI;var o,h,c=(a=void 0!==a?a:0)+(s=void 0!==s?s:Math.PI),u=0,l=[],d=new D,p=new D,f=[],_=[],v=[],m=[];for(h=0;h<=n;h++){var g=[],M=h/n;for(o=0;o<=e;o++){var E=o/e;d.x=-t*Math.cos(i+E*r)*Math.sin(a+M*s),d.y=t*Math.cos(a+M*s),d.z=t*Math.sin(i+E*r)*Math.sin(a+M*s),_.push(d.x,d.y,d.z),p.set(d.x,d.y,d.z).normalize(),v.push(p.x,p.y,p.z),m.push(E,1-M),g.push(u++)}l.push(g)}for(h=0;h<n;h++)for(o=0;o<e;o++){var S=l[h][o+1],x=l[h][o],y=l[h+1][o],T=l[h+1][o+1];(0!==h||a>0)&&f.push(S,x,T),(h!==n-1||c<Math.PI)&&f.push(x,y,T)}this.setIndex(f),this.addAttribute("a_Position",new $t(new Float32Array(_),3)),this.addAttribute("a_Normal",new $t(new Float32Array(v),3)),this.addAttribute("a_Uv",new $t(new Float32Array(m),2)),this.computeBoundingBox(),this.computeBoundingSphere()}}),le.prototype=Object.create(ee.prototype),le.prototype.constructor=le;var de=0;function pe(){F.call(this),Object.defineProperty(this,"id",{value:de++}),this.type="",this.uuid=i(),this.precision=null,this.opacity=1,this.transparent=!1,this.blending=d.NORMAL,this.blendSrc=f.SRC_ALPHA,this.blendDst=f.ONE_MINUS_SRC_ALPHA,this.blendEquation=p.ADD,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.premultipliedAlpha=!1,this.vertexColors=P.NONE,this.vertexTangents=!1,this.diffuse=new _t(16777215),this.diffuseMap=null,this.diffuseMapCoord=0,this.normalMap=null,this.alphaMap=null,this.alphaMapCoord=0,this.aoMap=null,this.aoMapIntensity=1,this.aoMapCoord=0,this.bumpMap=null,this.bumpScale=1,this.envMap=null,this.envMapIntensity=1,this.envMapCombine=C.MULTIPLY,this.emissive=new _t(0),this.emissiveMap=null,this.emissiveMapCoord=0,this.emissiveIntensity=1,this.depthFunc=y.LEQUAL,this.depthTest=!0,this.depthWrite=!0,this.colorWrite=!0,this.stencilTest=!1,this.stencilWriteMask=255,this.stencilFunc=y.ALWAYS,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=T.KEEP,this.stencilZFail=T.KEEP,this.stencilZPass=T.KEEP,this.stencilFuncBack=null,this.stencilRefBack=null,this.stencilFuncMaskBack=null,this.stencilFailBack=null,this.stencilZFailBack=null,this.stencilZPassBack=null,this.alphaTest=0,this.side=v.FRONT,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.shading=m.SMOOTH_SHADING,this.dithering=!1,this.acceptLight=!1,this.drawMode=R.TRIANGLES,this.needsUpdate=!0}function fe(){pe.call(this),this.type=u.BASIC}function _e(){pe.call(this),this.type=u.LAMBERT,this.acceptLight=!0}function ve(){pe.call(this),this.type=u.PHONG,this.shininess=30,this.specular=new _t(1118481),this.specularMap=null,this.acceptLight=!0}function me(){pe.call(this),this.type=u.PBR,this.roughness=.5,this.metalness=.5,this.roughnessMap=null,this.metalnessMap=null,this.acceptLight=!0}function ge(){pe.call(this),this.type=u.PBR2,this.specular=new _t(1118481),this.glossiness=.5,this.specularMap=null,this.glossinessMap=null,this.acceptLight=!0}function Me(){pe.call(this),this.type=u.MATCAP,this.matcap=null}function Ee(){pe.call(this),this.type=u.POINT,this.size=1,this.sizeAttenuation=!0,this.drawMode=R.POINTS}function Se(){pe.call(this),this.type=u.LINE,this.lineWidth=1,this.drawMode=R.LINES}function xe(t){pe.call(this),this.type=u.SHADER,this.vertexShader="",this.fragmentShader="",this.defines={},this.uniforms={},t&&(this.vertexShader=t.vertexShader,this.fragmentShader=t.fragmentShader,Object.assign(this.defines,t.defines),this.uniforms=o(t.uniforms))}function ye(){pe.call(this),this.type=u.DEPTH,this.packToRGBA=!1}function Te(){pe.call(this),this.type=u.DISTANCE}function we(t){var e=["","WEBKIT_","MOZ_"],n={};function i(i){if(n[i]||null===n[i])return n[i];var r=null;for(var a in e)if(r=t.getExtension(e[a]+i))break;return n[i]=r,r}var r=parseFloat(/^WebGL\ ([0-9])/.exec(t.getParameter(t.VERSION))[1]),a=i("EXT_texture_filter_anisotropic");return{version:r,maxPrecision:function(t,e){if("highp"===e){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}(t,"highp"),maxTextures:t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),maxVertexTextures:t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:t.getParameter(t.MAX_TEXTURE_SIZE),maxCubemapSize:t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),maxVertexUniformVectors:t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),lineWidthRange:t.getParameter(t.ALIASED_LINE_WIDTH_RANGE),anisotropyExt:a,maxAnisotropy:null!==a?t.getParameter(a.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1,maxSamples:r>1?t.getParameter(t.MAX_SAMPLES):1,getExtension:i}}function be(t,e,n,i){var r=new Uint8Array(4),a=t.createTexture();t.bindTexture(e,a),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.NEAREST);for(var s=0;s<i;s++)t.texImage2D(n+s,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,r);return a}function Ae(t){var e=!1,n=new et,i=null,r=new et(0,0,0,0);return{setMask:function(n){i===n||e||(t.colorMask(n,n,n,n),i=n)},setLocked:function(t){e=t},setClear:function(e,i,a,s,o){!0===o&&(e*=s,i*=s,a*=s),n.set(e,i,a,s),!1===r.equals(n)&&(t.clearColor(e,i,a,s),r.copy(n))},getClear:function(){return r},reset:function(){e=!1,i=null,r.set(-1,0,0,0)}}}function Ne(t,e){var n=!1,i=null,r=null,a=null;return{setTest:function(n){n?e.enable(t.DEPTH_TEST):e.disable(t.DEPTH_TEST)},setMask:function(e){i===e||n||(t.depthMask(e),i=e)},setFunc:function(e){r!==e&&(t.depthFunc(e),r=e)},setLocked:function(t){n=t},setClear:function(e){a!==e&&(t.clearDepth(e),a=e)},reset:function(){n=!1,i=null,r=null,a=null}}}function Ce(t,e){var n=!1,i=null,r=null,a=null,s=null,o=null,h=null,c=null,u=null,l=null,d=null,p=null,f=null,_=null,v=null;return{setTest:function(n){n?e.enable(t.STENCIL_TEST):e.disable(t.STENCIL_TEST)},setMask:function(e){i===e||n||(t.stencilMask(e),i=e)},setFunc:function(e,n,i,o,h,c){r===e&&a===n&&s===i&&u===o&&l===h&&d===c||(null===o||null===h||null===c?t.stencilFunc(e,n,i):(t.stencilFuncSeparate(t.FRONT,e,n,i),t.stencilFuncSeparate(t.BACK,o,h,c)),r=e,a=n,s=i,u=o,l=h,d=c)},setOp:function(e,n,i,r,a,s){o===e&&h===n&&c===i&&p===r&&f===a&&_===s||(null===r||null===a||null===s?t.stencilOp(e,n,i):(t.stencilOpSeparate(t.FRONT,e,n,i),t.stencilOpSeparate(t.BACK,r,a,s)),o=e,h=n,c=i,p=r,f=a,_=s)},setLocked:function(t){n=t},setClear:function(e){v!==e&&(t.clearStencil(e),v=e)},reset:function(){n=!1,i=null,r=null,a=null,s=null,o=null,h=null,c=null,v=null}}}function Re(t,e){this.gl=t,this.capabilities=e,this.colorBuffer=new Ae(t),this.depthBuffer=new Ne(t,this),this.stencilBuffer=new Ce(t,this),this.states={},this.currentBlending=null,this.currentBlendEquation=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendEquationAlpha=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipliedAlpha=null,this.currentCullFace=null,this.currentViewport=new et,this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBuffers={},this.emptyTextures={},this.emptyTextures[t.TEXTURE_2D]=be(t,t.TEXTURE_2D,t.TEXTURE_2D,1),this.emptyTextures[t.TEXTURE_CUBE_MAP]=be(t,t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),this.currentFlipSided=!1,this.currentLineWidth=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentProgram=null,this.currentRenderTarget=null,this.colorBuffer.setClear(0,0,0,1),this.depthBuffer.setClear(1),this.stencilBuffer.setClear(0),this.depthBuffer.setTest(!0),this.depthBuffer.setFunc(y.LEQUAL),this.setCullFace(_.BACK),this.setFlipSided(!1)}function Pe(){this.properties=new WeakMap}function Le(t){return t.wrapS!==x.CLAMP_TO_EDGE||t.wrapT!==x.CLAMP_TO_EDGE||t.minFilter!==S.NEAREST&&t.minFilter!==S.LINEAR}function Oe(t){return t===S.NEAREST||t===S.NEAREST_MIPMAP_LINEAR||t===S.NEAREST_MIPMAP_NEAREST?S.NEAREST:S.LINEAR}function Fe(t){return r(t.width)&&r(t.height)}function Ue(t){if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement){var e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return e.width=a(t.width),e.height=a(t.height),e.getContext("2d").drawImage(t,0,0,e.width,e.height),console.warn("image is not power of two ("+t.width+"x"+t.height+"). Resized to "+e.width+"x"+e.height,t),e}return t}function De(t,e){if(t.width>e||t.height>e){var n=e/Math.max(t.width,t.height),i=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return i.width=Math.floor(t.width*n),i.height=Math.floor(t.height*n),i.getContext("2d").drawImage(t,0,0,t.width,t.height,0,0,i.width,i.height),console.warn("image is too big ("+t.width+"x"+t.height+"). Resized to "+i.width+"x"+i.height,t),i}return t}function Ie(t,e,n,i){this.gl=t,this.state=e,this.properties=n,this.capabilities=i}function Be(t,e,n,i,r){i.isInterleavedBufferAttribute&&(i=i.data);var a=e.get(i);void 0===a.buffer?function(t,e,n,i){var r=n.array,a=n.usage,s=t.createBuffer();t.bindBuffer(i,s),t.bufferData(i,r,a);var o=t.FLOAT;r instanceof Float32Array?o=t.FLOAT:r instanceof Float64Array?console.warn("Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?o=t.UNSIGNED_SHORT:r instanceof Int16Array?o=t.SHORT:r instanceof Uint32Array?o=t.UNSIGNED_INT:r instanceof Int32Array?o=t.INT:r instanceof Int8Array?o=t.BYTE:r instanceof Uint8Array&&(o=t.UNSIGNED_BYTE),e.buffer=s,e.type=o,e.bytesPerElement=r.BYTES_PER_ELEMENT,e.version=n.version}(t,a,i,r):a.version<i.version&&(!function(t,e,n,i,r){var a=i.array,s=i.updateRange;t.bindBuffer(r,n),i.usage===O.STATIC_DRAW?t.bufferData(r,a,t.STATIC_DRAW):-1===s.count?t.bufferSubData(r,0,a):0===s.count?console.error("updateBuffer: dynamic BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(e.version>=2?t.bufferSubData(r,s.offset*a.BYTES_PER_ELEMENT,a,s.offset,s.count):t.bufferSubData(r,s.offset*a.BYTES_PER_ELEMENT,a.subarray(s.offset,s.offset+s.count)),s.count=-1)}(t,n,a.buffer,i,r),a.version=i.version)}function ze(t,e,n){n.isInterleavedBufferAttribute&&(n=n.data);var i=e.get(n);i.buffer&&t.deleteBuffer(i.buffer),e.delete(n)}function Ge(t,e,n,i,r){this.gl=t,this.state=e,this.vertexArrayBindings=n,this.properties=i,this.capabilities=r}pe.prototype=Object.assign(Object.create(F.prototype),{constructor:pe,copy:function(t){return this.type=t.type,this.precision=t.precision,t.defines&&(this.defines=Object.assign({},t.defines)),this.opacity=t.opacity,this.transparent=t.transparent,this.premultipliedAlpha=t.premultipliedAlpha,this.vertexColors=t.vertexColors,this.diffuse.copy(t.diffuse),this.diffuseMap=t.diffuseMap,this.diffuseMapCoord=t.diffuseMapCoord,this.alphaMap=t.alphaMap,this.alphaMapCoord=t.alphaMapCoord,this.normalMap=t.normalMap,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.aoMapCoord=t.aoMapCoord,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.envMapCombine=t.envMapCombine,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveMapCoord=t.emissiveMapCoord,this.emissiveIntensity=t.emissiveIntensity,this.blending=t.blending,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.colorWrite=t.colorWrite,this.alphaTest=t.alphaTest,this.side=t.side,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.shading=t.shading,this.acceptLight=t.acceptLight,this.drawMode=t.drawMode,this},clone:function(){return(new this.constructor).copy(this)},dispose:function(){this.dispatchEvent({type:"dispose"})}}),fe.prototype=Object.create(pe.prototype),fe.prototype.constructor=fe,_e.prototype=Object.create(pe.prototype),_e.prototype.constructor=_e,ve.prototype=Object.assign(Object.create(pe.prototype),{constructor:ve,copy:function(t){return pe.prototype.copy.call(this,t),this.shininess=t.shininess,this.specular.copy(t.specular),this.specularMap=t.specularMap,this}}),me.prototype=Object.assign(Object.create(pe.prototype),{constructor:me,copy:function(t){return pe.prototype.copy.call(this,t),this.roughness=t.roughness,this.metalness=t.metalness,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this}}),ge.prototype=Object.assign(Object.create(pe.prototype),{constructor:ge,copy:function(t){return pe.prototype.copy.call(this,t),this.specular=t.specular,this.glossiness=t.glossiness,this.specularMap=t.specularMap,this.glossinessMap=t.glossinessMap,this}}),Me.prototype=Object.assign(Object.create(pe.prototype),{constructor:Me,copy:function(t){return pe.prototype.copy.call(this,t),this.matcap=t.matcap,this}}),Ee.prototype=Object.assign(Object.create(pe.prototype),{constructor:Ee,copy:function(t){return pe.prototype.copy.call(this,t),this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this}}),Se.prototype=Object.assign(Object.create(pe.prototype),{constructor:Se,copy:function(t){return pe.prototype.copy.call(this,t),this.lineWidth=t.lineWidth,this}}),xe.prototype=Object.assign(Object.create(pe.prototype),{constructor:xe,copy:function(t){return pe.prototype.copy.call(this,t),this.vertexShader=t.vertexShader,this.fragmentShader=t.fragmentShader,this.uniforms=o(t.uniforms),this}}),ye.prototype=Object.create(pe.prototype),ye.prototype.constructor=ye,Te.prototype=Object.create(pe.prototype),Te.prototype.constructor=Te,Object.assign(Re.prototype,{setBlend:function(t,e,n,i,r,a,s,o){var h=this.gl;t!==d.NONE?this.enable(h.BLEND):this.disable(h.BLEND),t!==d.CUSTOM?(t===this.currentBlending&&o===this.currentPremultipliedAlpha||(t===d.NORMAL&&(o?(h.blendEquationSeparate(h.FUNC_ADD,h.FUNC_ADD),h.blendFuncSeparate(h.ONE,h.ONE_MINUS_SRC_ALPHA,h.ONE,h.ONE_MINUS_SRC_ALPHA)):(h.blendEquationSeparate(h.FUNC_ADD,h.FUNC_ADD),h.blendFuncSeparate(h.SRC_ALPHA,h.ONE_MINUS_SRC_ALPHA,h.ONE,h.ONE_MINUS_SRC_ALPHA))),t===d.ADD&&(o?(h.blendEquationSeparate(h.FUNC_ADD,h.FUNC_ADD),h.blendFuncSeparate(h.ONE,h.ONE,h.ONE,h.ONE)):(h.blendEquation(h.FUNC_ADD),h.blendFunc(h.SRC_ALPHA,h.ONE)))),this.currentBlendEquation=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendEquationAlpha=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null):(r=r||e,a=a||n,s=s||i,e===this.currentBlendEquation&&r===this.currentBlendEquationAlpha||(h.blendEquationSeparate(e,r),this.currentBlendEquation=e,this.currentBlendEquationAlpha=r),n===this.currentBlendSrc&&i===this.currentBlendDst&&a===this.currentBlendSrcAlpha&&s===this.currentBlendDstAlpha||(h.blendFuncSeparate(n,i,a,s),this.currentBlendSrc=n,this.currentBlendDst=i,this.currentBlendSrcAlpha=a,this.currentBlendDstAlpha=s)),this.currentBlending=t,this.currentPremultipliedAlpha=o},setFlipSided:function(t){var e=this.gl;this.currentFlipSided!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),this.currentFlipSided=t)},setCullFace:function(t){var e=this.gl;t!==_.NONE?(this.enable(e.CULL_FACE),t!==this.currentCullFace&&(t===_.BACK?e.cullFace(e.BACK):t===_.FRONT?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):this.disable(e.CULL_FACE),this.currentCullFace=t},viewport:function(t,e,n,i){var r=this.currentViewport;r.x===t&&r.y===e&&r.z===n&&r.w===i||(this.gl.viewport(t,e,n,i),r.set(t,e,n,i))},activeTexture:function(t){var e=this.gl;void 0===t&&(t=e.TEXTURE0+this.capabilities.maxTextures-1),this.currentTextureSlot!==t&&(e.activeTexture(t),this.currentTextureSlot=t)},bindTexture:function(t,e){var n=this.gl;null===this.currentTextureSlot&&this.activeTexture();var i=this.currentBoundTextures[this.currentTextureSlot];void 0===i&&(i={type:void 0,texture:void 0},this.currentBoundTextures[this.currentTextureSlot]=i),i.type===t&&i.texture===e||(n.bindTexture(t,e||this.emptyTextures[t]),i.type=t,i.texture=e)},bindBuffer:function(t,e){var n=this.gl;this.currentBoundBuffers[t]!==e&&(n.bindBuffer(t,e),this.currentBoundBuffers[t]=e)},enable:function(t){!0!==this.states[t]&&(this.gl.enable(t),this.states[t]=!0)},disable:function(t){!1!==this.states[t]&&(this.gl.disable(t),this.states[t]=!1)},setLineWidth:function(t){if(t!==this.currentLineWidth){var e=this.capabilities.lineWidthRange;e[0]<=t&&t<=e[1]?this.gl.lineWidth(t):console.warn("GL_ALIASED_LINE_WIDTH_RANGE is ["+e[0]+","+e[1]+"], but set to "+t+"."),this.currentLineWidth=t}},setPolygonOffset:function(t,e,n){var i=this.gl;t?(this.enable(i.POLYGON_OFFSET_FILL),this.currentPolygonOffsetFactor===e&&this.currentPolygonOffsetUnits===n||(i.polygonOffset(e,n),this.currentPolygonOffsetFactor=e,this.currentPolygonOffsetUnits=n)):this.disable(i.POLYGON_OFFSET_FILL)},setProgram:function(t){this.currentProgram!==t&&(this.gl.useProgram(t.program),this.currentProgram=t)}}),Object.assign(Pe.prototype,{get:function(t){var e=this.properties.get(t);return void 0===e&&(e={},this.properties.set(t,e)),e},delete:function(t){this.properties.delete(t)},clear:function(){this.properties=new WeakMap}}),Object.assign(Ie.prototype,{setTexture2D:function(t,e){var n=this.gl,i=this.state,r=this.capabilities;void 0!==e&&(e=n.TEXTURE0+e);var a=this.properties.get(t);if(t.image&&(!t.image.rtt||void 0===e)&&a.__version!==t.version){void 0===a.__webglTexture&&(t.addEventListener("dispose",this.onTextureDispose,this),a.__webglTexture=n.createTexture()),i.activeTexture(e),i.bindTexture(n.TEXTURE_2D,a.__webglTexture);var s=t.image,o=s instanceof HTMLImageElement||s instanceof HTMLCanvasElement;o&&(s=De(s,r.maxTextureSize),Le(t)&&!1===Fe(s)&&r.version<2&&(s=Ue(s)));var h=!Fe(s)&&r.version<2;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t.flipY),this.setTextureParameters(t,h);var c,u=t.mipmaps,l=t.format,d=t.internalformat||t.format,p=t.type;if(r.version<2?(l!==d&&console.warn("texture format "+l+" not same as internalformat "+d+" in webgl 1.0."),p===E.HALF_FLOAT&&(r.getExtension("OES_texture_half_float")||console.warn("extension OES_texture_half_float is not support in webgl 1.0.")),p===E.FLOAT&&(r.getExtension("OES_texture_float")||console.warn("extension OES_texture_float is not support in webgl 1.0.")),l!==M.DEPTH_COMPONENT&&l!==M.DEPTH_STENCIL||r.getExtension("WEBGL_depth_texture")||console.warn("extension WEBGL_depth_texture is not support in webgl 1.0.")):p===E.HALF_FLOAT&&(p=5131),o)if(u.length>0&&!h){for(var f=0,_=u.length;f<_;f++)c=u[f],n.texImage2D(n.TEXTURE_2D,f,d,l,p,c);t.generateMipmaps=!1,a.__maxMipLevel=u.length-1}else n.texImage2D(n.TEXTURE_2D,0,d,l,p,s),a.__maxMipLevel=0;else if(u.length>0&&!h){for(f=0,_=u.length;f<_;f++)c=u[f],n.texImage2D(n.TEXTURE_2D,f,d,c.width,c.height,t.border,l,p,c.data);t.generateMipmaps=!1,a.__maxMipLevel=u.length-1}else n.texImage2D(n.TEXTURE_2D,0,d,s.width,s.height,t.border,l,p,s.data),a.__maxMipLevel=0;return t.generateMipmaps&&!h&&this.generateMipmap(n.TEXTURE_2D,t,s.width,s.height),a.__version=t.version,a}return i.activeTexture(e),i.bindTexture(n.TEXTURE_2D,a.__webglTexture),a},setTextureCube:function(t,e){var n=this.gl,i=this.state,r=this.capabilities;void 0!==e&&(e=n.TEXTURE0+e);var a=this.properties.get(t);if(6===t.images.length&&(!t.images[0].rtt||void 0===e)&&a.__version!==t.version){void 0===a.__webglTexture&&(t.addEventListener("dispose",this.onTextureDispose,this),a.__webglTexture=n.createTexture()),i.activeTexture(e),i.bindTexture(n.TEXTURE_CUBE_MAP,a.__webglTexture);var s,o=[],h=t.mipmaps,c=t.format,u=t.internalformat||t.format,l=t.type;r.version<2?(c!==u&&console.warn("texture format "+c+" not same as internalformat "+u+" in webgl 1.0."),l===E.HALF_FLOAT&&(r.getExtension("OES_texture_half_float")||console.warn("extension OES_texture_half_float is not support in webgl 1.0.")),l===E.FLOAT&&(r.getExtension("OES_texture_float")||console.warn("extension OES_texture_float is not support in webgl 1.0.")),c!==M.DEPTH_COMPONENT&&c!==M.DEPTH_STENCIL||r.getExtension("WEBGL_depth_texture")||console.warn("extension WEBGL_depth_texture is not support in webgl 1.0.")):l===E.HALF_FLOAT&&(l=5131);for(var d=!1,p=0;p<6;p++){(_=(f=t.images[p])instanceof HTMLImageElement||f instanceof HTMLCanvasElement)&&(f=De(f,r.maxTextureSize),Le(t)&&!1===Fe(f)&&r.version<2&&(f=Ue(f))),!Fe(f)&&r.version<2&&(d=!0),o[p]=f,f.__isElement=_}n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t.flipY),this.setTextureParameters(t,d);for(p=0;p<6;p++){var f,_;if(_=(f=o[p]).__isElement)if(h.length>0&&!d){for(var v=0,m=h.length;v<m;v++)s=h[v][p],n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+p,0,u,c,l,s);a.__maxMipLevel=h.length-1,t.generateMipmaps=!1}else n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+p,0,u,c,l,f),a.__maxMipLevel=0;else if(h.length>0&&!d){for(v=0,m=h.length;v<m;v++)s=h[v][p],n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+p,v,u,s.width,s.height,t.border,c,l,s.data);a.__maxMipLevel=h.length-1,t.generateMipmaps=!1}else n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+p,0,u,f.width,f.height,t.border,c,l,f.data),a.__maxMipLevel=0}return t.generateMipmaps&&!d&&this.generateMipmap(n.TEXTURE_CUBE_MAP,t,f.width,f.height),a.__version=t.version,a}return i.activeTexture(e),i.bindTexture(n.TEXTURE_CUBE_MAP,a.__webglTexture),a},setTexture3D:function(t,e){var n=this.gl,i=this.state;if(!(this.capabilities.version<2)){void 0!==e&&(e=n.TEXTURE0+e);var r=this.properties.get(t);if(t.image&&r.__version!==t.version){void 0===r.__webglTexture&&(t.addEventListener("dispose",this.onTextureDispose,this),r.__webglTexture=n.createTexture()),i.activeTexture(e),i.bindTexture(n.TEXTURE_3D,r.__webglTexture);var a=t.image;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t.flipY),this.setTextureParameters(t,!1);var s=t.format,o=t.internalformat||t.format,h=t.type;return n.texImage3D(n.TEXTURE_3D,0,o,a.width,a.height,a.depth,t.border,s,h,a.data),t.generateMipmaps&&this.generateMipmap(n.TEXTURE_3D,t,a.width,a.height),r.__version=t.version,r}return i.activeTexture(e),i.bindTexture(n.TEXTURE_3D,r.__webglTexture),r}console.warn("Try to use Texture3D but browser not support WebGL2.0")},setTextureParameters:function(t,e){var n=this.gl,i=this.capabilities,r=t.textureType,a=function(t,e){var n=t.wrapS,i=t.wrapT,r=t.magFilter,a=t.minFilter,s=t.anisotropy,o=t.compare;return e&&(n=x.CLAMP_TO_EDGE,i=x.CLAMP_TO_EDGE,t.wrapS===x.CLAMP_TO_EDGE&&t.wrapT===x.CLAMP_TO_EDGE||console.warn("Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to zen3d.TEXTURE_WRAP.CLAMP_TO_EDGE.",t),r=Oe(t.magFilter),a=Oe(t.minFilter),(t.minFilter!==S.NEAREST&&t.minFilter!==S.LINEAR||t.magFilter!==S.NEAREST&&t.magFilter!==S.LINEAR)&&console.warn("Texture is not power of two. Texture.minFilter and Texture.magFilter should be set to zen3d.TEXTURE_FILTER.NEAREST or zen3d.TEXTURE_FILTER.LINEAR.",t)),[n,i,r,a,s,o]}(t,e);n.texParameteri(r,n.TEXTURE_WRAP_S,a[0]),n.texParameteri(r,n.TEXTURE_WRAP_T,a[1]),n.texParameteri(r,n.TEXTURE_MAG_FILTER,a[2]),n.texParameteri(r,n.TEXTURE_MIN_FILTER,a[3]);var s=i.anisotropyExt;s&&n.texParameterf(r,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a[4],i.maxAnisotropy)),i.version>=2&&(void 0!==a[5]?(n.texParameteri(r,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(r,n.TEXTURE_COMPARE_FUNC,a[5])):n.texParameteri(r,n.TEXTURE_COMPARE_MODE,n.NONE))},generateMipmap:function(t,e,n,i){this.gl.generateMipmap(t),this.properties.get(e).__maxMipLevel=Math.log(Math.max(n,i))*Math.LOG2E},onTextureDispose:function(t){var e=this.gl,n=t.target,i=this.properties.get(n);n.removeEventListener("dispose",this.onTextureDispose,this),i.__webglTexture&&e.deleteTexture(i.__webglTexture),this.properties.delete(n)}}),Object.assign(Ge.prototype,{setGeometry:function(t){var e=this.gl,n=this.properties,i=this.capabilities,r=this.properties.get(t);for(var a in r.created||(t.addEventListener("dispose",this.onGeometryDispose,this),r.created=!0,r._vaos={}),null!==t.index&&Be(e,n,i,t.index,e.ELEMENT_ARRAY_BUFFER),t.attributes)Be(e,n,i,t.attributes[a],e.ARRAY_BUFFER);for(var a in t.morphAttributes)for(var s=t.morphAttributes[a],o=0,h=s.length;o<h;o++)Be(e,n,i,s[o],e.ARRAY_BUFFER);return r},onGeometryDispose:function(t){var e=this.gl,n=t.target,i=this.properties.get(n);for(var r in n.removeEventListener("dispose",this.onGeometryDispose,this),null!==n.index&&ze(e,this.properties,n.index),n.attributes)ze(e,this.properties,n.attributes[r]);for(var r in n.morphAttributes)for(var a=n.morphAttributes[r],s=0,o=a.length;s<o;s++)ze(e,this.properties,a[s]);for(var h in i._vaos){var c=i[h];c&&this.vertexArrayBindings.disposeVAO(c.object)}i._vaos={},i.created=!1,this.properties.delete(n)}});var He=new Rt;He.image={data:new Uint8Array([1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1]),width:2,height:2},He.magFilter=S.NEAREST,He.minFilter=S.NEAREST,He.generateMipmaps=!1,He.version++;var ke=new Rt;ke.image={data:null,width:2,height:2},ke.version++,ke.type=E.FLOAT_32_UNSIGNED_INT_24_8_REV,ke.format=M.DEPTH_STENCIL,ke.internalformat=M.DEPTH32F_STENCIL8,ke.magFilter=S.NEAREST,ke.minFilter=S.NEAREST,ke.compare=y.LESS,ke.generateMipmaps=!1,ke.version++;var Ve=new Lt,je=new Pt;function We(){this.seq=[],this.map={}}function Xe(t,e){if(t.length!==e.length)return!1;for(var n=0,i=t.length;n<i;n++)if(t[n]!==e[n])return!1;return!0}function Ye(t,e){for(var n=0,i=e.length;n<i;n++)t[n]=e[n]}var qe=[];function Ze(t,e){var n=qe[e];void 0===n&&(n=new Int32Array(e),qe[e]=n);for(var i=0;i!==e;++i)n[i]=t.allocTexUnit();return n}function Ke(t,e){var n=t.gl,i=t.type,r=t.location,a=t.cache;switch(i){case w.FLOAT:t.setValue=function(t){a[0]!==t&&(n.uniform1f(r,t),a[0]=t)},t.set=e?function(t){Xe(a,t)||(n.uniform1fv(r,t),Ye(a,t))}:t.setValue;break;case w.SAMPLER_2D:case w.SAMPLER_2D_SHADOW:t.setValue=function(t,e){var s=e.allocTexUnit();e.texture.setTexture2D(t||(i===w.SAMPLER_2D_SHADOW?ke:He),s),a[0]!==s&&(n.uniform1i(r,s),a[0]=s)},t.set=e?function(t,e){for(var s=t.length,o=Ze(e,s),h=0;h!==s;++h)e.texture.setTexture2D(t[h]||(i===w.SAMPLER_2D_SHADOW?ke:He),o[h]);Xe(a,o)||(n.uniform1iv(r,o),Ye(a,o))}:t.setValue;break;case w.SAMPLER_CUBE:case w.SAMPLER_CUBE_SHADOW:t.setValue=function(t,e){var i=e.allocTexUnit();e.texture.setTextureCube(t||je,i),a[0]!==i&&(n.uniform1i(r,i),a[0]=i)},t.set=e?function(t,e){for(var i=t.length,s=Ze(e,i),o=0;o!==i;++o)e.texture.setTextureCube(t[o]||je,s[o]);Xe(a,s)||(n.uniform1iv(r,s),Ye(a,s))}:t.setValue;break;case w.SAMPLER_3D:t.setValue=function(t,e){var i=e.allocTexUnit();e.texture.setTexture3D(t||Ve,i),a[0]!==i&&(n.uniform1i(r,i),a[0]=i)},t.set=e?function(t,e){for(var i=t.length,s=Ze(e,i),o=0;o!==i;++o)e.texture.setTexture3D(t[o]||Ve,s[o]);Xe(a,s)||(n.uniform1iv(r,s),Ye(a,s))}:t.setValue;break;case w.BOOL:case w.INT:t.setValue=function(t){a[0]!==t&&(n.uniform1i(r,t),a[0]=t)},t.set=e?function(t){Xe(a,t)||(n.uniform1iv(r,t),Ye(a,t))}:t.setValue;break;case w.FLOAT_VEC2:t.setValue=function(t,e){a[0]===t&&a[1]===e||(n.uniform2f(r,t,e),a[0]=t,a[1]=e)},t.set=function(t){Xe(a,t)||(n.uniform2fv(r,t),Ye(a,t))};break;case w.BOOL_VEC2:case w.INT_VEC2:t.setValue=function(t,e){a[0]===t&&a[1]===e||(n.uniform2i(r,t,e),a[0]=t,a[1]=e)},t.set=function(t){Xe(a,t)||(n.uniform2iv(r,t),Ye(a,t))};break;case w.FLOAT_VEC3:t.setValue=function(t,e,i){a[0]===t&&a[1]===e&&a[2]===i||(n.uniform3f(r,t,e,i),a[0]=t,a[1]=e,a[2]=i)},t.set=function(t){Xe(a,t)||(n.uniform3fv(r,t),Ye(a,t))};break;case w.BOOL_VEC3:case w.INT_VEC3:t.setValue=function(t,e,i){a[0]===t&&a[1]===e&&a[2]===i||(n.uniform3i(r,t,e,i),a[0]=t,a[1]=e,a[2]=i)},t.set=function(t){Xe(a,t)||(n.uniform3iv(r,t),Ye(a,t))};break;case w.FLOAT_VEC4:t.setValue=function(t,e,i,s){a[0]===t&&a[1]===e&&a[2]===i&&a[3]===s||(n.uniform4f(r,t,e,i,s),a[0]=t,a[1]=e,a[2]=i,a[3]=s)},t.set=function(t){Xe(a,t)||(n.uniform4fv(r,t),Ye(a,t))};break;case w.BOOL_VEC4:case w.INT_VEC4:t.setValue=function(t,e,i,s){a[0]===t&&a[1]===e&&a[2]===i&&a[3]===s||(n.uniform4i(r,t,e,i,s),a[0]=t,a[1]=e,a[2]=i,a[3]=s)},t.set=function(t){Xe(a,t)||(n.uniform4iv(r,t),Ye(a,t))};break;case w.FLOAT_MAT2:t.setValue=t.set=function(t){Xe(a,t)||(n.uniformMatrix2fv(r,!1,t),Ye(a,t))};break;case w.FLOAT_MAT3:t.setValue=t.set=function(t){Xe(a,t)||(n.uniformMatrix3fv(r,!1,t),Ye(a,t))};break;case w.FLOAT_MAT4:t.setValue=t.set=function(t){Xe(a,t)||(n.uniformMatrix4fv(r,!1,t),Ye(a,t))}}}function Qe(t,e,n,i){this.gl=t,this.id=e,this.type=n.type,this.location=i,this.setValue=void 0,this.set=void 0,this.cache=[],Ke(this)}function $e(t,e,n,i){this.gl=t,this.id=e,this.type=n.type,this.size=n.size,this.location=i,this.setValue=void 0,this.set=void 0,this.cache=[],Ke(this,!0)}function Je(t){this.id=t,We.call(this)}Je.prototype.set=function(t,e){for(var n=this.seq,i=0,r=n.length;i!==r;++i){var a=n[i];a.set(t[a.id],e)}};var tn=/([\w\d_]+)(\])?(\[|\.)?/g;function en(t,e){t.seq.push(e),t.map[e.id]=e}function nn(t,e,n,i){var r=e.name,a=r.length;for(tn.lastIndex=0;;){var s=tn.exec(r),o=tn.lastIndex,h=s[1],c="]"===s[2],u=s[3];if(c&&(h|=0),void 0===u||"["===u&&o+2===a){en(i,void 0===u?new Qe(t,h,e,n):new $e(t,h,e,n));break}var l=i.map[h];void 0===l&&en(i,l=new Je(h)),i=l}}function rn(t,e){We.call(this);for(var n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),i=0;i<n;++i){var r=t.getActiveUniform(e,i),a=t.getUniformLocation(e,r.name);nn(t,r,a,this)}}function an(t,e,n){this.gl=t,this.name=n.name,this.type=n.type,this.size=n.size,this.location=t.getAttribLocation(e,this.name),this.count=0,this.initCount(t),this.format=t.FLOAT,this.initFormat(t)}function sn(t,e,n){var i=t.createShader(e);return t.shaderSource(i,n),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS)||console.warn("shader not compiled!",t.getShaderInfoLog(i),function(t){for(var e=t.split("\n"),n=0;n<e.length;n++)e[n]=n+1+": "+e[n];return e.join("\n")}(n)),i}rn.prototype.set=function(t,e,n){var i=this.map[t];void 0!==i&&i.set(e,n)},rn.prototype.has=function(t){return!!this.map[t]},Object.assign(an.prototype,{initCount:function(t){switch(this.type){case b.FLOAT:case b.BYTE:case b.UNSIGNED_BYTE:case b.UNSIGNED_SHORT:this.count=1;break;case b.FLOAT_VEC2:this.count=2;break;case b.FLOAT_VEC3:this.count=3;break;case b.FLOAT_VEC4:this.count=4}},initFormat:function(t){switch(this.type){case b.FLOAT:case b.FLOAT_VEC2:case b.FLOAT_VEC3:case b.FLOAT_VEC4:this.format=t.FLOAT;break;case b.UNSIGNED_BYTE:this.format=t.UNSIGNED_BYTE;break;case b.UNSIGNED_SHORT:this.format=t.UNSIGNED_SHORT;break;case b.BYTE:this.format=t.BYTE}}});var on=0;function hn(t,e,n){this.id=on++,this.usedTimes=1,this.code="",this.gl=t,this.vshaderSource=e,this.fshaderSource=n;var i=sn(t,t.VERTEX_SHADER,this.vshaderSource),r=sn(t,t.FRAGMENT_SHADER,this.fshaderSource);this.program=function(t,e,n){var i=t.createProgram();return t.attachShader(i,e),t.attachShader(i,n),t.linkProgram(i),t.getProgramParameter(i,t.LINK_STATUS)||console.warn("program not linked!",t.getProgramInfoLog(i)),i}(t,i,r),this.uniforms=new rn(t,this.program),this.attributes=function(t,e){for(var n={},i=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),r=0;r<i;r++){var a=t.getActiveAttrib(e,r),s=a.name,o=new an(t,e,a);n[s]=o}return n}(t,this.program),t.deleteShader(i),t.deleteShader(r)}hn.prototype.dispose=function(){this.gl.deleteProgram(this.program),this.program=void 0};var cn={alphaTest_frag:"#ifdef ALPHATEST\n\tif ( outColor.a < ALPHATEST ) {\n\t\tdiscard;\n\t} else {\n\t\toutColor.a = u_Opacity;\n\t}\n#endif",ambientlight_pars_frag:"uniform vec3 u_AmbientLightColor;",aoMap_pars_frag:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_frag:"vec4 outColor = vec4(u_Color, u_Opacity);",begin_vert:"vec3 transformed = vec3(a_Position);\nvec3 objectNormal = vec3(a_Normal);\n#ifdef USE_TANGENT\n\t\tvec3 objectTangent = vec3(a_Tangent.xyz);\n#endif",bsdfs:"\nvec4 BRDF_Diffuse_Lambert(vec4 diffuseColor) {\n\t\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec4 F_Schlick( const in vec4 specularColor, const in float dotLH ) {\n\tfloat fresnel = pow( 1.0 - dotLH, 5.0 );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nvec4 BRDF_Specular_BlinnPhong(vec4 specularColor, vec3 N, vec3 L, vec3 V, float shininess) {\n\t\tvec3 H = normalize(L + V);\n\t\tfloat dotNH = saturate(dot(N, H));\n\t\tfloat dotLH = saturate(dot(L, H));\n\t\tvec4 F = F_Schlick(specularColor, dotLH);\n\t\tfloat G = G_BlinnPhong_Implicit( );\n\t\tfloat D = D_BlinnPhong(shininess, dotNH);\n\t\treturn F * G * D;\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nvec4 BRDF_Specular_GGX(vec4 specularColor, vec3 N, vec3 L, vec3 V, float roughness) {\n\tfloat alpha = pow2( roughness );\n\tvec3 H = normalize(L + V);\n\tfloat dotNL = saturate( dot(N, L) );\n\tfloat dotNV = saturate( dot(N, V) );\n\tfloat dotNH = saturate( dot(N, H) );\n\tfloat dotLH = saturate( dot(L, H) );\n\tvec4 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * G * D;\n}\nvec4 BRDF_Specular_GGX_Environment( const in vec3 N, const in vec3 V, const in vec4 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( N, V ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}",bumpMap_pars_frag:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd(vec2 uv) {\n\t\tvec2 dSTdx = dFdx( uv );\n\t\tvec2 dSTdy = dFdy( uv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, uv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, uv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, uv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clippingPlanes_frag:"#if NUM_CLIPPING_PLANES > 0\n\t\tvec4 plane;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tif ( dot( -v_modelPos, plane.xyz ) > plane.w ) discard;\n\t\t}\n#endif",clippingPlanes_pars_frag:"#if NUM_CLIPPING_PLANES > 0\n\t\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",color_frag:"#ifdef USE_VCOLOR_RGB\n\t\toutColor.rgb *= v_Color;\n#endif\n#ifdef USE_VCOLOR_RGBA\n\t\toutColor *= v_Color;\n#endif",color_pars_frag:"#ifdef USE_VCOLOR_RGB\n\t\tvarying vec3 v_Color;\n#endif\n#ifdef USE_VCOLOR_RGBA\n\t\tvarying vec4 v_Color;\n#endif",color_pars_vert:"#ifdef USE_VCOLOR_RGB\n\t\tattribute vec3 a_Color;\n\t\tvarying vec3 v_Color;\n#endif\n#ifdef USE_VCOLOR_RGBA\n\t\tattribute vec4 a_Color;\n\t\tvarying vec4 v_Color;\n#endif",color_vert:"#if defined(USE_VCOLOR_RGB) || defined(USE_VCOLOR_RGBA)\n\t\tv_Color = a_Color;\n#endif",common_frag:"uniform mat4 u_View;\nuniform float u_Opacity;\nuniform vec3 u_Color;\nuniform vec3 u_CameraPosition;",common_vert:"attribute vec3 a_Position;\nattribute vec3 a_Normal;\n#ifdef USE_TANGENT\n\tattribute vec4 a_Tangent;\n#endif\n#include <transpose>\n#include <inverse>\nuniform mat4 u_Projection;\nuniform mat4 u_View;\nuniform mat4 u_Model;\nuniform vec3 u_CameraPosition;\n#ifdef USE_MORPHTARGETS\n\t\tattribute vec3 morphTarget0;\n\t\tattribute vec3 morphTarget1;\n\t\tattribute vec3 morphTarget2;\n\t\tattribute vec3 morphTarget3;\n\t\t#ifdef USE_MORPHNORMALS\n\t\t\tattribute vec3 morphNormal0;\n\t\t\tattribute vec3 morphNormal1;\n\t\t\tattribute vec3 morphNormal2;\n\t\t\tattribute vec3 morphNormal3;\n\t\t#else\n\t\t\tattribute vec3 morphTarget4;\n\t\t\tattribute vec3 morphTarget5;\n\t\t\tattribute vec3 morphTarget6;\n\t\t\tattribute vec3 morphTarget7;\n\t\t#endif\n#endif",diffuseMap_frag:"#ifdef USE_DIFFUSE_MAP\n\t\t#if (USE_DIFFUSE_MAP == 1)\n\t\t\t\tvec4 texelColor = texture2D( diffuseMap, v_Uv );\n\t\t#elif (USE_DIFFUSE_MAP == 2)\n\t\t\t\tvec4 texelColor = texture2D( diffuseMap, v_Uv2 );\n\t\t#else \n\t\t\t\tvec4 texelColor = texture2D( diffuseMap, v_Uv );\n\t\t#endif\n\t\t\n\t\ttexelColor = mapTexelToLinear( texelColor );\n\t\toutColor *= texelColor;\n#endif",diffuseMap_pars_frag:"#ifdef USE_DIFFUSE_MAP\n\t\tuniform sampler2D diffuseMap;\n#endif",directlight_pars_frag:"struct DirectLight\n{\n\t\tvec3 direction;\n\t\tvec4 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n};\nuniform DirectLight u_Directional[NUM_DIR_LIGHTS];",emissiveMap_frag:"#ifdef USE_EMISSIVEMAP\n\t#if (USE_EMISSIVEMAP == 1)\n\t\tvec4 emissiveColor = texture2D(emissiveMap, v_Uv);\n\t#elif (USE_EMISSIVEMAP == 2)\n\t\t\t\tvec4 emissiveColor = texture2D(emissiveMap, v_Uv2);\n\t\t#else \n\t\t\t\tvec4 emissiveColor = texture2D(emissiveMap, v_Uv);\n\t\t#endif\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissiveMap_pars_frag:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_frag:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_frag:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat M\t\t\t= clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM\t\t\t\t\t\t= ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat D\t\t\t= max( maxRange / maxRGB, 1.0 );\n\tD\t\t\t\t\t\t= min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )\t{\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract(Le);\n\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max(vRGB, 0.0), 1.0 );\n}",end_frag:"gl_FragColor = outColor;",envMap_frag:"#ifdef USE_ENV_MAP\n\t\tvec3 envDir;\n\t\t#if defined(USE_NORMAL_MAP) || defined(USE_BUMPMAP)\n\t\t\t\tenvDir = reflect(normalize(v_worldPos - u_CameraPosition), N);\n\t\t#else\n\t\t\t\tenvDir = v_EnvPos;\n\t\t#endif\n\t\tvec4 envColor = textureCube(envMap, envDir);\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutColor = mix(outColor, envColor * outColor, u_EnvMap_Intensity);\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutColor = mix(outColor, envColor, u_EnvMap_Intensity);\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutColor += envColor * u_EnvMap_Intensity;\n\t#endif\n#endif",envMap_pars_frag:"#ifdef USE_ENV_MAP\n\t\t#if defined(USE_NORMAL_MAP) || defined(USE_BUMPMAP)\n\t\t\t\tvarying vec3 v_worldPos;\n\t\t#else\n\t\t\t\tvarying vec3 v_EnvPos;\n\t\t#endif\n\t\tuniform samplerCube envMap;\n\t\tuniform float u_EnvMap_Intensity;\n\t\tuniform int maxMipLevel;\n#endif",envMap_pars_vert:"#ifdef USE_ENV_MAP\n\t\t#if defined(USE_NORMAL_MAP) || defined(USE_BUMPMAP)\n\t\t\t\tvarying vec3 v_worldPos;\n\t\t#else\n\t\t\t\tvarying vec3 v_EnvPos;\n\t\t#endif\n#endif",envMap_vert:"#ifdef USE_ENV_MAP\n\t\t#if defined(USE_NORMAL_MAP) || defined(USE_BUMPMAP)\n\t\t\t\tv_worldPos = (u_Model * vec4(transformed, 1.0)).xyz;\n\t\t#else\n\t\t\t\tv_EnvPos = reflect(normalize((u_Model * vec4(transformed, 1.0)).xyz - u_CameraPosition), (transposeMat4(inverseMat4(u_Model)) * vec4(objectNormal, 1.0)).xyz);\n\t\t#endif\n#endif",fog_frag:"#ifdef USE_FOG\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\t\t#ifdef USE_EXP2_FOG\n\t\t\t\tfloat fogFactor = whiteCompliment( exp2( - u_FogDensity * u_FogDensity * depth * depth * LOG2 ) );\n\t\t#else\n\t\t\t\tfloat fogFactor = smoothstep( u_FogNear, u_FogFar, depth );\n\t\t#endif\n\t\tgl_FragColor.rgb = mix( gl_FragColor.rgb, u_FogColor, fogFactor );\n#endif",fog_pars_frag:"#ifdef USE_FOG\n\t\tuniform vec3 u_FogColor;\n\t\t#ifdef USE_EXP2_FOG\n\t\t\t\tuniform float u_FogDensity;\n\t\t#else\n\t\t\t\tuniform float u_FogNear;\n\t\t\t\tuniform float u_FogFar;\n\t\t#endif\n#endif",inverse:"mat4 inverseMat4(mat4 m) {\n\t\tfloat\n\t\ta00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n\t\ta10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n\t\ta20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n\t\ta30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\t\tb00 = a00 * a11 - a01 * a10,\n\t\tb01 = a00 * a12 - a02 * a10,\n\t\tb02 = a00 * a13 - a03 * a10,\n\t\tb03 = a01 * a12 - a02 * a11,\n\t\tb04 = a01 * a13 - a03 * a11,\n\t\tb05 = a02 * a13 - a03 * a12,\n\t\tb06 = a20 * a31 - a21 * a30,\n\t\tb07 = a20 * a32 - a22 * a30,\n\t\tb08 = a20 * a33 - a23 * a30,\n\t\tb09 = a21 * a32 - a22 * a31,\n\t\tb10 = a21 * a33 - a23 * a31,\n\t\tb11 = a22 * a33 - a23 * a32,\n\t\tdet = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\t\treturn mat4(\n\t\t\t\ta11 * b11 - a12 * b10 + a13 * b09,\n\t\t\t\ta02 * b10 - a01 * b11 - a03 * b09,\n\t\t\t\ta31 * b05 - a32 * b04 + a33 * b03,\n\t\t\t\ta22 * b04 - a21 * b05 - a23 * b03,\n\t\t\t\ta12 * b08 - a10 * b11 - a13 * b07,\n\t\t\t\ta00 * b11 - a02 * b08 + a03 * b07,\n\t\t\t\ta32 * b02 - a30 * b05 - a33 * b01,\n\t\t\t\ta20 * b05 - a22 * b02 + a23 * b01,\n\t\t\t\ta10 * b10 - a11 * b08 + a13 * b06,\n\t\t\t\ta01 * b08 - a00 * b10 - a03 * b06,\n\t\t\t\ta30 * b04 - a31 * b02 + a33 * b00,\n\t\t\t\ta21 * b02 - a20 * b04 - a23 * b00,\n\t\t\t\ta11 * b07 - a10 * b09 - a12 * b06,\n\t\t\t\ta00 * b09 - a01 * b07 + a02 * b06,\n\t\t\t\ta31 * b01 - a30 * b03 - a32 * b00,\n\t\t\t\ta20 * b03 - a21 * b01 + a22 * b00) / det;\n}",light_frag:"#ifdef USE_LIGHT\n\t\tvec4 light;\n\t\tvec3 L;\n\t\tvec4 totalReflect = vec4(0., 0., 0., 0.);\n\t\tvec3 indirectIrradiance = vec3(0., 0., 0.);\t\tvec3 indirectRadiance = vec3(0., 0., 0.);\n\t\t#ifdef USE_PBR\n\t\t\t\t#ifdef USE_PBR2\n\t\t\t\t\t\tvec4 diffuseColor = outColor.xyzw;\n\t\t\t\t\t\tvec4 specularColor = vec4(specularFactor.rgb, 1.);\n\t\t\tfloat roughness = clamp(1.0 - glossinessFactor, 0.04, 1.0);\n\t\t\t\t #else\n\t\t\t\t\t\tvec4 diffuseColor = outColor.xyzw * (1.0 - metalnessFactor);\n\t\t\t\t\t\tvec4 specularColor = mix(vec4(0.04), outColor.xyzw, metalnessFactor);\n\t\t\t\t\t\tfloat roughness = clamp(roughnessFactor, 0.04, 1.0);\n\t\t\t\t #endif\n\t\t#else\n\t\t\t\tvec4 diffuseColor = outColor.xyzw;\n\t\t\t\t#ifdef USE_PHONG\n\t\t\t\t\t\tvec4 specularColor = vec4(u_SpecularColor, 1.);\n\t\t\t\t\t\tfloat shininess = u_Specular;\n\t\t\t\t#endif\n\t\t#endif\n\t\t#ifdef USE_AMBIENT_LIGHT\n\t\t\t\tindirectIrradiance += u_AmbientLightColor;\n\t\t#endif\n\t\t#ifdef USE_PBR\n\t\t\t\t#ifdef USE_ENV_MAP\n\t\t\t\tvec3 envDir;\n\t\t\t\t\t#if defined(USE_NORMAL_MAP) || defined(USE_BUMPMAP)\n\t\t\t\t\t\t\tenvDir = reflect(normalize(v_worldPos - u_CameraPosition), N);\n\t\t\t\t\t#else\n\t\t\t\t\t\t\tenvDir = v_EnvPos;\n\t\t\t\t\t#endif\n\t\t\t\t\t\tindirectIrradiance += getLightProbeIndirectIrradiance(maxMipLevel, envDir);\n\t\t\t\t\t\tindirectRadiance += getLightProbeIndirectRadiance(GGXRoughnessToBlinnExponent(roughness), maxMipLevel, envDir);\n\t\t\t#endif\n\t\t#endif\n\t\t#if (defined(USE_PHONG) || defined(USE_PBR))\n\t\t\t\tvec3 V = normalize( u_CameraPosition - v_modelPos );\n\t\t#endif\n\t\tfloat dotNL;\n\t\tvec4 irradiance;\n\t\tvec4 reflectLight;\n\t\tfloat dist;\n\t\t#if NUM_DIR_LIGHTS > 0\n\t\t\t\t#pragma unroll_loop\n\t\t\t\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\t\t\t\t\tL = -u_Directional[ i ].direction;\n\t\t\t\t\t\tlight = u_Directional[ i ].color;\n\t\t\t\t\t\tL = normalize(L);\n\t\t\t\t\t\tdotNL = saturate( dot(N, L) );\n\t\t\t\t\t\tirradiance = light * dotNL;\n\t\t\t\t\t\t#if NUM_DIR_SHADOWS > 0\n\t\t\t\t\t\t\t\t#ifdef USE_PCSS_SOFT_SHADOW\n\t\t\t\t\t\t\t\t\t\tirradiance *= bool( u_Directional[ i ].shadow ) ? getShadowWithPCSS( directionalDepthMap[ i ], directionalShadowMap[ i ], vDirectionalShadowCoord[ i ], u_Directional[ i ].shadowBias, u_Directional[ i ].shadowRadius, u_Directional[ i ].shadowMapSize ) : 1.0;\n\t\t\t\t\t\t\t\t#else\n\t\t\t\t\t\t\t\t\t\tirradiance *= bool( u_Directional[ i ].shadow ) ? getShadow( directionalShadowMap[ i ], vDirectionalShadowCoord[ i ], u_Directional[ i ].shadowBias, u_Directional[ i ].shadowRadius, u_Directional[ i ].shadowMapSize ) : 1.0;\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\treflectLight = irradiance * BRDF_Diffuse_Lambert(diffuseColor);\n\t\t\t\t\t\t#ifdef USE_PHONG\n\t\t\t\t\t\t\t\treflectLight += irradiance * BRDF_Specular_BlinnPhong(specularColor, N, L, V, shininess) * specularStrength;\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#ifdef USE_PBR\n\t\t\t\t\t\t\t\treflectLight += irradiance * BRDF_Specular_GGX(specularColor, N, L, V, roughness);\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\ttotalReflect += reflectLight;\n\t\t\t\t}\n\t\t#endif\n\t\t#if NUM_POINT_LIGHTS > 0\n\t\t\t\tvec3 worldV;\n\t\t\t\t#pragma unroll_loop\n\t\t\t\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\t\t\t\t\tL = u_Point[ i ].position - v_modelPos;\n\t\t\t\t\t\tdist = pow(clamp(1. - length(L) / u_Point[ i ].distance, 0.0, 1.0), u_Point[ i ].decay);\n\t\t\t\t\t\tlight = u_Point[ i ].color * dist;\n\t\t\t\t\t\tL = normalize(L);\n\t\t\t\t\t\tdotNL = saturate( dot(N, L) );\n\t\t\t\t\t\tirradiance = light * dotNL;\n\t\t\t\t\t\t#if NUM_POINT_SHADOWS > 0\n\t\t\t\t\t\t\t\tworldV = v_modelPos - u_Point[ i ].position;\n\t\t\t\t\t\t\t\tirradiance *= bool( u_Point[ i ].shadow ) ? getPointShadow( pointShadowMap[ i ], worldV, u_Point[ i ].shadowBias, u_Point[ i ].shadowRadius, u_Point[ i ].shadowMapSize, u_Point[ i ].shadowCameraNear, u_Point[ i ].shadowCameraFar ) : 1.0;\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\treflectLight = irradiance * BRDF_Diffuse_Lambert(diffuseColor);\n\t\t\t\t\t\t#ifdef USE_PHONG\n\t\t\t\t\t\t\t\treflectLight += irradiance * BRDF_Specular_BlinnPhong(specularColor, N, L, V, shininess) * specularStrength;\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#ifdef USE_PBR\n\t\t\t\t\t\t\t\treflectLight += irradiance * BRDF_Specular_GGX(specularColor, N, L, V, roughness);\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\ttotalReflect += reflectLight;\n\t\t\t\t}\n\t\t#endif\n\t\t#if NUM_SPOT_LIGHTS > 0\n\t\t\t\tfloat lightDistance;\n\t\t\t\tfloat angleCos;\n\t\t\t\tfloat spotEffect;\n\t\t\t\t#pragma unroll_loop\n\t\t\t\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\t\t\t\t\tL = u_Spot[ i ].position - v_modelPos;\n\t\t\t\t\t\tlightDistance = length(L);\n\t\t\t\t\t\tL = normalize(L);\n\t\t\t\t\t\tangleCos = dot( L, -normalize(u_Spot[ i ].direction) );\n\t\t\t\t\t\tif( all( bvec2(angleCos > u_Spot[ i ].coneCos, lightDistance < u_Spot[ i ].distance) ) ) {\n\t\t\t\t\t\t\t\tspotEffect = smoothstep( u_Spot[ i ].coneCos, u_Spot[ i ].penumbraCos, angleCos );\n\t\t\t\t\t\t\t\tdist = pow(clamp(1. - lightDistance / u_Spot[ i ].distance, 0.0, 1.0), u_Spot[ i ].decay);\n\t\t\t\t\t\t\t\tlight = u_Spot[ i ].color * dist * spotEffect;\n\t\t\t\t\t\t\t\tdotNL = saturate( dot(N, L) );\n\t\t\t\t\t\t\t\tirradiance = light * dotNL;\n\t\t\t\t\t\t\t\t#if NUM_SPOT_SHADOWS > 0\n\t\t\t\t\t\t\t\t\t\t#ifdef USE_PCSS_SOFT_SHADOW\n\t\t\t\t\t\t\t\t\t\t\t\tirradiance *= bool( u_Spot[ i ].shadow ) ? getShadowWithPCSS( spotDepthMap[ i ], spotShadowMap[ i ], vSpotShadowCoord[ i ], u_Spot[ i ].shadowBias, u_Spot[ i ].shadowRadius, u_Spot[ i ].shadowMapSize ) : 1.0;\n\t\t\t\t\t\t\t\t\t\t#else\n\t\t\t\t\t\t\t\t\t\t\t\tirradiance *= bool( u_Spot[ i ].shadow ) ? getShadow( spotShadowMap[ i ], vSpotShadowCoord[ i ], u_Spot[ i ].shadowBias, u_Spot[ i ].shadowRadius, u_Spot[ i ].shadowMapSize ) : 1.0;\n\t\t\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t\treflectLight = irradiance * BRDF_Diffuse_Lambert(diffuseColor);\n\t\t\t\t\t\t\t\t#ifdef USE_PHONG\n\t\t\t\t\t\t\t\t\t\treflectLight += irradiance * BRDF_Specular_BlinnPhong(specularColor, N, L, V, shininess) * specularStrength;\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t\t#ifdef USE_PBR\n\t\t\t\t\t\t\t\t\t\treflectLight += irradiance * BRDF_Specular_GGX(specularColor, N, L, V, roughness);\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t\ttotalReflect += reflectLight;\n\t\t\t\t\t\t}\n\t\t\t\t}\n\t\t#endif\n\t\tvec3 indirectDiffuse = indirectIrradiance * BRDF_Diffuse_Lambert(diffuseColor).rgb;\n\t\tvec3 indirectSpecular = vec3(0., 0., 0.);\n\t\t#if defined( USE_ENV_MAP ) && defined( USE_PBR )\n\t\t\t\tindirectSpecular += indirectRadiance * BRDF_Specular_GGX_Environment(N, V, specularColor, roughness).rgb;\n\t\t#endif\n\t\t#ifdef USE_AOMAP\n\t\t\t\t#if (USE_AOMAP == 1)\n\t\t\t\t\tfloat ambientOcclusion = ( texture2D( aoMap, v_Uv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\t\t\t\t#elif (USE_AOMAP == 2)\n\t\t\t\t\t\tfloat ambientOcclusion = ( texture2D( aoMap, v_Uv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\t\t\t\t#else\n\t\t\t\t\t\tfloat ambientOcclusion = ( texture2D( aoMap, v_Uv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\t\t\t\t#endif\n\t\t\t\n\t\t\tindirectDiffuse *= ambientOcclusion;\n\t\t\t#if defined( USE_ENV_MAP ) && defined( USE_PBR )\n\t\t\t\tfloat dotNV = saturate( dot( N, V ) );\n\t\t\t\tindirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, GGXRoughnessToBlinnExponent(roughness) );\n\t\t\t#endif\n\t\t#endif\n\t\toutColor.xyz = totalReflect.xyz + indirectDiffuse + indirectSpecular;\n#endif",light_pars_frag:"#ifdef USE_AMBIENT_LIGHT\n\t\t#include <ambientlight_pars_frag>\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t\t#include <directlight_pars_frag>\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t\t#include <pointlight_pars_frag>\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t\t#include <spotlight_pars_frag>\n#endif\n#if defined(USE_PBR) && defined(USE_ENV_MAP)\n\t\tvec3 getLightProbeIndirectIrradiance(const in int maxMIPLevel, const in vec3 envDir) {\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, envDir, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, envDir, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\t\tenvMapColor = envMapTexelToLinear( envMapColor );\n\t\t\t\treturn PI * envMapColor.rgb * u_EnvMap_Intensity;\n\t\t}\n\t\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\t\tfloat desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t\t}\n\t\tvec3 getLightProbeIndirectRadiance(const in float blinnShininessExponent, const in int maxMIPLevel, const in vec3 envDir) {\n\t\t\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, envDir, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, envDir, specularMIPLevel );\n\t\t\t#endif\n\t\t\t\tenvMapColor = envMapTexelToLinear( envMapColor );\n\t\t\t\treturn envMapColor.rgb * u_EnvMap_Intensity;\n\t\t}\n\t\tfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\t\t\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n\t\t}\n#endif",alphamap_pars_frag:"#ifdef USE_ALPHA_MAP\n\tuniform sampler2D alphaMap;\n#endif",alphamap_frag:"#ifdef USE_ALPHA_MAP\n\t#ifdef USE_ALPHA_MAP_UV_TRANSFORM\n\t\toutColor.a *= texture2D(alphaMap, vAlphaMapUV).g;\n\t#else\n\t\t#if (USE_ALPHA_MAP == 1)\n\t\t\toutColor.a *= texture2D(alphaMap, v_Uv).g;\n\t\t#elif (USE_ALPHA_MAP == 2)\n\t\t\t\t\t\toutColor.a *= texture2D(alphaMap, v_Uv2).g;\n\t\t#else\n\t\t\t\t\t\toutColor.a *= texture2D(alphaMap, v_Uv).g;\n\t\t\t\t#endif\n\t#endif\n#endif",normalMap_pars_frag:"#if !defined(USE_TANGENT) || defined(FLAT_SHADED)\n\t\t#include <tsn>\n#endif\nuniform sampler2D normalMap;",normal_frag:"#ifdef FLAT_SHADED\n\t\tvec3 fdx = vec3( dFdx( v_modelPos.x ), dFdx( v_modelPos.y ), dFdx( v_modelPos.z ) );\n\t\tvec3 fdy = vec3( dFdy( v_modelPos.x ), dFdy( v_modelPos.y ), dFdy( v_modelPos.z ) );\n\t\tvec3 N = normalize( cross( fdx, fdy ) );\n#else\n\t\tvec3 N = normalize(v_Normal);\n\t\t#ifdef DOUBLE_SIDED\n\t\t\t\tN = N * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\t\n#endif\n#ifdef USE_NORMAL_MAP\n\t\tvec3 mapN = texture2D(normalMap, v_Uv).rgb * 2.0 - 1.0;\n\t\t#if defined(USE_TANGENT) && !defined(FLAT_SHADED)\n\t\t\t\tvec3 tangent = normalize(v_Tangent);\n\t\t\t\tvec3 bitangent = normalize(v_Bitangent);\n\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\t\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\t\t#endif\t\n\t\t\t\tmat3 tspace = mat3(tangent, bitangent, N);\n\t\t#else\n\t\t\t\tmat3 tspace = tsn(N, v_modelPos, vec2(v_Uv.x, 1.0 - v_Uv.y));\n\t\t\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\tN = normalize(tspace * mapN);\n#elif defined(USE_BUMPMAP)\n\t\tN = perturbNormalArb(v_modelPos, N, dHdxy_fwd(v_Uv));\n#endif",normal_pars_frag:"#ifndef FLAT_SHADED\n\t\tvarying vec3 v_Normal;\n\t\t#ifdef USE_TANGENT\n\t\t\t\tvarying vec3 v_Tangent;\n\t\tvarying vec3 v_Bitangent;\n\t\t#endif\n#endif",normal_pars_vert:"#ifndef FLAT_SHADED\n\t\tvarying vec3 v_Normal;\n\t\t#ifdef USE_TANGENT\n\t\t\t\tvarying vec3 v_Tangent;\n\t\tvarying vec3 v_Bitangent;\n\t\t#endif\n#endif",normal_vert:"#ifndef FLAT_SHADED\n\t\tv_Normal = (transposeMat4(inverseMat4(u_Model)) * vec4(objectNormal, 0.0)).xyz;\n\t\t#ifdef FLIP_SIDED\n\t\t\tv_Normal = - v_Normal;\n\t\t#endif\n\t\t#ifdef USE_TANGENT\n\t\t\t\tv_Tangent = (transposeMat4(inverseMat4(u_Model)) * vec4(objectTangent, 0.0)).xyz;\n\t\t\t\t#ifdef FLIP_SIDED\n\t\t\t\t\t\tv_Tangent = - v_Tangent;\n\t\t\t\t#endif\n\t\t\t\tv_Bitangent = normalize(cross(v_Normal, v_Tangent) * a_Tangent.w);\n\t\t#endif\n#endif",packing:"const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,\t256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\t\tvec4 r = vec4( fract( v * PackFactors ), v );\n\t\tr.yzw -= r.xyz * ShiftRight8;\t\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\t\treturn dot( v, UnpackFactors );\n}",pointlight_pars_frag:"struct PointLight\n{\n\t\tvec3 position;\n\t\tvec4 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n};\nuniform PointLight u_Point[NUM_POINT_LIGHTS];",premultipliedAlpha_frag:"#ifdef USE_PREMULTIPLIED_ALPHA\n\t\tgl_FragColor.rgb = gl_FragColor.rgb * gl_FragColor.a;\n#endif",pvm_vert:"gl_Position = u_Projection * u_View * u_Model * vec4(transformed, 1.0);",dithering_frag:"#if defined( DITHERING )\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_frag:"#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",shadow:"#ifdef USE_SHADOW_SAMPLER\n\t\tfloat computeShadow(sampler2DShadow shadowMap, vec3 shadowCoord) {\n\t\t\t\treturn texture2D( shadowMap, shadowCoord );\n\t\t}\n#else\n\t\tfloat computeShadow(sampler2D shadowMap, vec3 shadowCoord) {\n\t\t\t\treturn step( shadowCoord.z, unpackRGBAToDepth( texture2D( shadowMap, shadowCoord.xy ) ) );\n\t\t}\n#endif\nfloat computeShadowWithPoissonSampling( sampler2DShadow shadowMap, vec3 shadowCoord, float texelSize ) {\n\t\tvec3 poissonDisk[4];\n\t\tpoissonDisk[0] = vec3(-0.94201624, -0.39906216, 0);\n\t\tpoissonDisk[1] = vec3(0.94558609, -0.76890725, 0);\n\t\tpoissonDisk[2] = vec3(-0.094184101, -0.92938870, 0);\n\t\tpoissonDisk[3] = vec3(0.34495938, 0.29387760, 0);\n\t\treturn computeShadow( shadowMap, shadowCoord + poissonDisk[0] * texelSize ) * 0.25 +\n\t\t\t\tcomputeShadow( shadowMap, shadowCoord + poissonDisk[1] * texelSize ) * 0.25 +\n\t\t\t\tcomputeShadow( shadowMap, shadowCoord + poissonDisk[2] * texelSize ) * 0.25 +\n\t\t\t\tcomputeShadow( shadowMap, shadowCoord + poissonDisk[3] * texelSize ) * 0.25;\n}\nfloat computeShadowWithPCF1(sampler2DShadow shadowSampler, vec3 shadowCoord) {\n\t\treturn computeShadow(shadowSampler, shadowCoord);\n}\nfloat computeShadowWithPCF3(sampler2DShadow shadowSampler, vec3 shadowCoord, vec2 shadowMapSizeAndInverse) {\n\t\tvec2 uv = shadowCoord.xy * shadowMapSizeAndInverse.x;\t\tuv += 0.5;\t\tvec2 st = fract(uv);\t\tvec2 base_uv = floor(uv) - 0.5;\t\tbase_uv *= shadowMapSizeAndInverse.y;\n\t\tvec2 uvw0 = 3. - 2. * st;\n\t\tvec2 uvw1 = 1. + 2. * st;\n\t\tvec2 u = vec2((2. - st.x) / uvw0.x - 1., st.x / uvw1.x + 1.) * shadowMapSizeAndInverse.y;\n\t\tvec2 v = vec2((2. - st.y) / uvw0.y - 1., st.y / uvw1.y + 1.) * shadowMapSizeAndInverse.y;\n\t\tfloat shadow = 0.;\n\t\tshadow += uvw0.x * uvw0.y * computeShadow(shadowSampler, vec3(base_uv.xy + vec2(u[0], v[0]), shadowCoord.z));\n\t\tshadow += uvw1.x * uvw0.y * computeShadow(shadowSampler, vec3(base_uv.xy + vec2(u[1], v[0]), shadowCoord.z));\n\t\tshadow += uvw0.x * uvw1.y * computeShadow(shadowSampler, vec3(base_uv.xy + vec2(u[0], v[1]), shadowCoord.z));\n\t\tshadow += uvw1.x * uvw1.y * computeShadow(shadowSampler, vec3(base_uv.xy + vec2(u[1], v[1]), shadowCoord.z));\n\t\tshadow = shadow / 16.;\n\t\treturn shadow;\n}\nfloat computeShadowWithPCF5(sampler2DShadow shadowSampler, vec3 shadowCoord, vec2 shadowMapSizeAndInverse) {\n\t\tvec2 uv = shadowCoord.xy * shadowMapSizeAndInverse.x;\t\tuv += 0.5;\t\tvec2 st = fract(uv);\t\tvec2 base_uv = floor(uv) - 0.5;\t\tbase_uv *= shadowMapSizeAndInverse.y;\n\t\tvec2 uvw0 = 4. - 3. * st;\n\t\tvec2 uvw1 = vec2(7.);\n\t\tvec2 uvw2 = 1. + 3. * st;\n\t\tvec3 u = vec3((3. - 2. * st.x) / uvw0.x - 2., (3. + st.x) / uvw1.x, st.x / uvw2.x + 2.) * shadowMapSizeAndInverse.y;\n\t\tvec3 v = vec3((3. - 2. * st.y) / uvw0.y - 2., (3. + st.y) / uvw1.y, st.y / uvw2.y + 2.) * shadowMapSizeAndInverse.y;\n\t\tfloat shadow = 0.;\n\t\tshadow += uvw0.x * uvw0.y * computeShadow(shadowSampler, vec3(base_uv.xy + vec2(u[0], v[0]), shadowCoord.z));\n\t\tshadow += uvw1.x * uvw0.y * computeShadow(shadowSampler, vec3(base_uv.xy + vec2(u[1], v[0]), shadowCoord.z));\n\t\tshadow += uvw2.x * uvw0.y * computeShadow(shadowSampler, vec3(base_uv.xy + vec2(u[2], v[0]), shadowCoord.z));\n\t\tshadow += uvw0.x * uvw1.y * computeShadow(shadowSampler, vec3(base_uv.xy + vec2(u[0], v[1]), shadowCoord.z));\n\t\tshadow += uvw1.x * uvw1.y * computeShadow(shadowSampler, vec3(base_uv.xy + vec2(u[1], v[1]), shadowCoord.z));\n\t\tshadow += uvw2.x * uvw1.y * computeShadow(shadowSampler, vec3(base_uv.xy + vec2(u[2], v[1]), shadowCoord.z));\n\t\tshadow += uvw0.x * uvw2.y * computeShadow(shadowSampler, vec3(base_uv.xy + vec2(u[0], v[2]), shadowCoord.z));\n\t\tshadow += uvw1.x * uvw2.y * computeShadow(shadowSampler, vec3(base_uv.xy + vec2(u[1], v[2]), shadowCoord.z));\n\t\tshadow += uvw2.x * uvw2.y * computeShadow(shadowSampler, vec3(base_uv.xy + vec2(u[2], v[2]), shadowCoord.z));\n\t\tshadow = shadow / 144.;\n\t\treturn shadow;\n}\nfloat getShadow( sampler2DShadow shadowMap, vec4 shadowCoord, float shadowBias, float shadowRadius, vec2 shadowMapSize ) {\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t\t\t#ifdef USE_HARD_SHADOW\n\t\t\t\t\t\treturn computeShadow(shadowMap, shadowCoord.xyz);\n\t\t\t\t#else\n\t\t\t\t\t\t#ifdef USE_PCF3_SOFT_SHADOW\n\t\t\t\t\t\t\t\tvec2 shadowMapSizeAndInverse = vec2(shadowMapSize.x, 1. / shadowMapSize.x);\n\t\t\t\t\t\t\t\treturn computeShadowWithPCF3(shadowMap, shadowCoord.xyz, shadowMapSizeAndInverse);\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\t\t#ifdef USE_PCF5_SOFT_SHADOW\n\t\t\t\t\t\t\t\t\t\tvec2 shadowMapSizeAndInverse = vec2(shadowMapSize.x, 1. / shadowMapSize.x);\n\t\t\t\t\t\t\t\t\t\treturn computeShadowWithPCF5(shadowMap, shadowCoord.xyz, shadowMapSizeAndInverse);\n\t\t\t\t\t\t\t\t#else\n\t\t\t\t\t\t\t\t\t\tfloat texelSize = shadowRadius / shadowMapSize.x;\n\t\t\t\t\t\t\t\t\t\treturn computeShadowWithPoissonSampling(shadowMap, shadowCoord.xyz, texelSize);\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#endif\n\t\t\t\t#endif\n\t\t}\n\t\treturn 1.0;\n}\nfloat textureCubeCompare( samplerCube depths, vec3 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( textureCube( depths, uv ) ) );\n}\nfloat getPointShadow( samplerCube shadowMap, vec3 V, float shadowBias, float shadowRadius, vec2 shadowMapSize, float shadowCameraNear, float shadowCameraFar ) {\n\t\tfloat depth = ( length( V ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdepth += shadowBias;\n\t\t#ifdef USE_HARD_SHADOW\n\t\t\t\treturn textureCubeCompare( shadowMap, normalize(V), depth);\n\t\t#else\n\t\t\t\tfloat texelSize = shadowRadius / shadowMapSize.x;\n\t\t\t\tvec3 poissonDisk[4];\n\t\t\t\tpoissonDisk[0] = vec3(-1.0, 1.0, -1.0);\n\t\t\t\tpoissonDisk[1] = vec3(1.0, -1.0, -1.0);\n\t\t\t\tpoissonDisk[2] = vec3(-1.0, -1.0, -1.0);\n\t\t\t\tpoissonDisk[3] = vec3(1.0, -1.0, 1.0);\n\t\t\t\treturn textureCubeCompare( shadowMap, normalize(V) + poissonDisk[0] * texelSize, depth ) * 0.25 +\n\t\t\t\t\t\ttextureCubeCompare( shadowMap, normalize(V) + poissonDisk[1] * texelSize, depth ) * 0.25 +\n\t\t\t\t\t\ttextureCubeCompare( shadowMap, normalize(V) + poissonDisk[2] * texelSize, depth ) * 0.25 +\n\t\t\t\t\t\ttextureCubeCompare( shadowMap, normalize(V) + poissonDisk[3] * texelSize, depth ) * 0.25;\n\t\t#endif\n}\n#ifdef USE_PCSS_SOFT_SHADOW\n\t\tconst vec3 PoissonSamplers32[64] = vec3[64](\n\t\t\t\tvec3(0.06407013, 0.05409927, 0.),\n\t\t\t\tvec3(0.7366577, 0.5789394, 0.),\n\t\t\t\tvec3(-0.6270542, -0.5320278, 0.),\n\t\t\t\tvec3(-0.4096107, 0.8411095, 0.),\n\t\t\t\tvec3(0.6849564, -0.4990818, 0.),\n\t\t\t\tvec3(-0.874181, -0.04579735, 0.),\n\t\t\t\tvec3(0.9989998, 0.0009880066, 0.),\n\t\t\t\tvec3(-0.004920578, -0.9151649, 0.),\n\t\t\t\tvec3(0.1805763, 0.9747483, 0.),\n\t\t\t\tvec3(-0.2138451, 0.2635818, 0.),\n\t\t\t\tvec3(0.109845, 0.3884785, 0.),\n\t\t\t\tvec3(0.06876755, -0.3581074, 0.),\n\t\t\t\tvec3(0.374073, -0.7661266, 0.),\n\t\t\t\tvec3(0.3079132, -0.1216763, 0.),\n\t\t\t\tvec3(-0.3794335, -0.8271583, 0.),\n\t\t\t\tvec3(-0.203878, -0.07715034, 0.),\n\t\t\t\tvec3(0.5912697, 0.1469799, 0.),\n\t\t\t\tvec3(-0.88069, 0.3031784, 0.),\n\t\t\t\tvec3(0.5040108, 0.8283722, 0.),\n\t\t\t\tvec3(-0.5844124, 0.5494877, 0.),\n\t\t\t\tvec3(0.6017799, -0.1726654, 0.),\n\t\t\t\tvec3(-0.5554981, 0.1559997, 0.),\n\t\t\t\tvec3(-0.3016369, -0.3900928, 0.),\n\t\t\t\tvec3(-0.5550632, -0.1723762, 0.),\n\t\t\t\tvec3(0.925029, 0.2995041, 0.),\n\t\t\t\tvec3(-0.2473137, 0.5538505, 0.),\n\t\t\t\tvec3(0.9183037, -0.2862392, 0.),\n\t\t\t\tvec3(0.2469421, 0.6718712, 0.),\n\t\t\t\tvec3(0.3916397, -0.4328209, 0.),\n\t\t\t\tvec3(-0.03576927, -0.6220032, 0.),\n\t\t\t\tvec3(-0.04661255, 0.7995201, 0.),\n\t\t\t\tvec3(0.4402924, 0.3640312, 0.),\n\t\t\t\tvec3(0., 0., 0.),\n\t\t\t\tvec3(0., 0., 0.),\n\t\t\t\tvec3(0., 0., 0.),\n\t\t\t\tvec3(0., 0., 0.),\n\t\t\t\tvec3(0., 0., 0.),\n\t\t\t\tvec3(0., 0., 0.),\n\t\t\t\tvec3(0., 0., 0.),\n\t\t\t\tvec3(0., 0., 0.),\n\t\t\t\tvec3(0., 0., 0.),\n\t\t\t\tvec3(0., 0., 0.),\n\t\t\t\tvec3(0., 0., 0.),\n\t\t\t\tvec3(0., 0., 0.),\n\t\t\t\tvec3(0., 0., 0.),\n\t\t\t\tvec3(0., 0., 0.),\n\t\t\t\tvec3(0., 0., 0.),\n\t\t\t\tvec3(0., 0., 0.),\n\t\t\t\tvec3(0., 0., 0.),\n\t\t\t\tvec3(0., 0., 0.),\n\t\t\t\tvec3(0., 0., 0.),\n\t\t\t\tvec3(0., 0., 0.),\n\t\t\t\tvec3(0., 0., 0.),\n\t\t\t\tvec3(0., 0., 0.),\n\t\t\t\tvec3(0., 0., 0.),\n\t\t\t\tvec3(0., 0., 0.),\n\t\t\t\tvec3(0., 0., 0.),\n\t\t\t\tvec3(0., 0., 0.),\n\t\t\t\tvec3(0., 0., 0.),\n\t\t\t\tvec3(0., 0., 0.),\n\t\t\t\tvec3(0., 0., 0.),\n\t\t\t\tvec3(0., 0., 0.),\n\t\t\t\tvec3(0., 0., 0.),\n\t\t\t\tvec3(0., 0., 0.)\n\t\t);\n\t\tconst vec3 PoissonSamplers64[64] = vec3[64](\n\t\t\t\tvec3(-0.613392, 0.617481, 0.),\n\t\t\t\tvec3(0.170019, -0.040254, 0.),\n\t\t\t\tvec3(-0.299417, 0.791925, 0.),\n\t\t\t\tvec3(0.645680, 0.493210, 0.),\n\t\t\t\tvec3(-0.651784, 0.717887, 0.),\n\t\t\t\tvec3(0.421003, 0.027070, 0.),\n\t\t\t\tvec3(-0.817194, -0.271096, 0.),\n\t\t\t\tvec3(-0.705374, -0.668203, 0.),\n\t\t\t\tvec3(0.977050, -0.108615, 0.),\n\t\t\t\tvec3(0.063326, 0.142369, 0.),\n\t\t\t\tvec3(0.203528, 0.214331, 0.),\n\t\t\t\tvec3(-0.667531, 0.326090, 0.),\n\t\t\t\tvec3(-0.098422, -0.295755, 0.),\n\t\t\t\tvec3(-0.885922, 0.215369, 0.),\n\t\t\t\tvec3(0.566637, 0.605213, 0.),\n\t\t\t\tvec3(0.039766, -0.396100, 0.),\n\t\t\t\tvec3(0.751946, 0.453352, 0.),\n\t\t\t\tvec3(0.078707, -0.715323, 0.),\n\t\t\t\tvec3(-0.075838, -0.529344, 0.),\n\t\t\t\tvec3(0.724479, -0.580798, 0.),\n\t\t\t\tvec3(0.222999, -0.215125, 0.),\n\t\t\t\tvec3(-0.467574, -0.405438, 0.),\n\t\t\t\tvec3(-0.248268, -0.814753, 0.),\n\t\t\t\tvec3(0.354411, -0.887570, 0.),\n\t\t\t\tvec3(0.175817, 0.382366, 0.),\n\t\t\t\tvec3(0.487472, -0.063082, 0.),\n\t\t\t\tvec3(-0.084078, 0.898312, 0.),\n\t\t\t\tvec3(0.488876, -0.783441, 0.),\n\t\t\t\tvec3(0.470016, 0.217933, 0.),\n\t\t\t\tvec3(-0.696890, -0.549791, 0.),\n\t\t\t\tvec3(-0.149693, 0.605762, 0.),\n\t\t\t\tvec3(0.034211, 0.979980, 0.),\n\t\t\t\tvec3(0.503098, -0.308878, 0.),\n\t\t\t\tvec3(-0.016205, -0.872921, 0.),\n\t\t\t\tvec3(0.385784, -0.393902, 0.),\n\t\t\t\tvec3(-0.146886, -0.859249, 0.),\n\t\t\t\tvec3(0.643361, 0.164098, 0.),\n\t\t\t\tvec3(0.634388, -0.049471, 0.),\n\t\t\t\tvec3(-0.688894, 0.007843, 0.),\n\t\t\t\tvec3(0.464034, -0.188818, 0.),\n\t\t\t\tvec3(-0.440840, 0.137486, 0.),\n\t\t\t\tvec3(0.364483, 0.511704, 0.),\n\t\t\t\tvec3(0.034028, 0.325968, 0.),\n\t\t\t\tvec3(0.099094, -0.308023, 0.),\n\t\t\t\tvec3(0.693960, -0.366253, 0.),\n\t\t\t\tvec3(0.678884, -0.204688, 0.),\n\t\t\t\tvec3(0.001801, 0.780328, 0.),\n\t\t\t\tvec3(0.145177, -0.898984, 0.),\n\t\t\t\tvec3(0.062655, -0.611866, 0.),\n\t\t\t\tvec3(0.315226, -0.604297, 0.),\n\t\t\t\tvec3(-0.780145, 0.486251, 0.),\n\t\t\t\tvec3(-0.371868, 0.882138, 0.),\n\t\t\t\tvec3(0.200476, 0.494430, 0.),\n\t\t\t\tvec3(-0.494552, -0.711051, 0.),\n\t\t\t\tvec3(0.612476, 0.705252, 0.),\n\t\t\t\tvec3(-0.578845, -0.768792, 0.),\n\t\t\t\tvec3(-0.772454, -0.090976, 0.),\n\t\t\t\tvec3(0.504440, 0.372295, 0.),\n\t\t\t\tvec3(0.155736, 0.065157, 0.),\n\t\t\t\tvec3(0.391522, 0.849605, 0.),\n\t\t\t\tvec3(-0.620106, -0.328104, 0.),\n\t\t\t\tvec3(0.789239, -0.419965, 0.),\n\t\t\t\tvec3(-0.545396, 0.538133, 0.),\n\t\t\t\tvec3(-0.178564, -0.596057, 0.)\n\t\t);\n\t\tfloat getRand(vec2 seed) {\n\t\t\t\treturn fract(sin(dot(seed.xy ,vec2(12.9898,78.233))) * 43758.5453);\n\t\t}\n\t\tfloat computeShadowWithPCSS(sampler2D depthSampler, sampler2DShadow shadowSampler, vec3 shadowCoord, float shadowMapSizeInverse, float lightSizeUV, int searchTapCount, int pcfTapCount, vec3[64] poissonSamplers) {\n\t\t\t\tfloat depthMetric = shadowCoord.z;\n\t\t\t\tfloat blockerDepth = 0.0;\n\t\t\t\tfloat sumBlockerDepth = 0.0;\n\t\t\t\tfloat numBlocker = 0.0;\n\t\t\t\tfor (int i = 0; i < searchTapCount; i ++) {\n\t\t\t\t\t\tblockerDepth = unpackRGBAToDepth( texture( depthSampler, shadowCoord.xy + (lightSizeUV * shadowMapSizeInverse * PoissonSamplers32[i].xy) ) );\n\t\t\t\t\t\tif (blockerDepth < depthMetric) {\n\t\t\t\t\t\t\t\tsumBlockerDepth += blockerDepth;\n\t\t\t\t\t\t\t\tnumBlocker++;\n\t\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (numBlocker < 1.0) {\n\t\t\t\t\t\treturn 1.0;\n\t\t\t\t}\n\t\t\t\tfloat avgBlockerDepth = sumBlockerDepth / numBlocker;\n\t\t\t\tfloat AAOffset = shadowMapSizeInverse * 10.;\n\t\t\t\tfloat penumbraRatio = ((depthMetric - avgBlockerDepth) + AAOffset);\n\t\t\t\tfloat filterRadius = penumbraRatio * lightSizeUV * shadowMapSizeInverse;\n\t\t\t\tfloat random = getRand(shadowCoord.xy);\t\t\t\tfloat rotationAngle = random * 3.1415926;\n\t\t\t\tvec2 rotationVector = vec2(cos(rotationAngle), sin(rotationAngle));\n\t\t\t\tfloat shadow = 0.;\n\t\t\t\tfor (int i = 0; i < pcfTapCount; i++) {\n\t\t\t\t\t\tvec3 offset = poissonSamplers[i];\n\t\t\t\t\t\toffset = vec3(offset.x * rotationVector.x - offset.y * rotationVector.y, offset.y * rotationVector.x + offset.x * rotationVector.y, 0.);\n\t\t\t\t\t\tshadow += texture(shadowSampler, shadowCoord + offset * filterRadius);\n\t\t\t\t}\n\t\t\t\tshadow /= float(pcfTapCount);\n\t\t\t\tshadow = mix(shadow, 1., depthMetric - avgBlockerDepth);\n\t\t\t\treturn shadow;\n\t\t}\n\t\tfloat getShadowWithPCSS( sampler2D depthSampler, sampler2DShadow shadowMap, vec4 shadowCoord, float shadowBias, float shadowRadius, vec2 shadowMapSize ) {\n\t\t\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\t\t\tshadowCoord.z += shadowBias;\n\t\t\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\t\t\tbool inFrustum = all( inFrustumVec );\n\t\t\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\t\t\tbool frustumTest = all( frustumTestVec );\n\t\t\t\tif ( frustumTest ) {\n\t\t\t\t\t\t#ifdef USE_PCSS16_SOFT_SHADOW\n\t\t\t\t\t\t\t\treturn computeShadowWithPCSS(depthSampler, shadowMap, shadowCoord.xyz, 1. / shadowMapSize.x, 0.1 * shadowMapSize.x, 16, 16, PoissonSamplers32);\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\t\t#ifdef USE_PCSS32_SOFT_SHADOW\n\t\t\t\t\t\t\t\t\t\treturn computeShadowWithPCSS(depthSampler, shadowMap, shadowCoord.xyz, 1. / shadowMapSize.x, 0.1 * shadowMapSize.x, 16, 32, PoissonSamplers32);\n\t\t\t\t\t\t\t\t#else\n\t\t\t\t\t\t\t\t\t\treturn computeShadowWithPCSS(depthSampler, shadowMap, shadowCoord.xyz, 1. / shadowMapSize.x, 0.1 * shadowMapSize.x, 32, 64, PoissonSamplers64);\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#endif\n\t\t\t\t}\n\t\t\t\treturn 1.0;\n\t\t}\n#endif",shadowMap_frag:"#ifdef USE_SHADOW\n#endif",shadowMap_pars_frag:"#ifdef USE_SHADOW\n\t\t#if NUM_DIR_SHADOWS > 0\n\t\t\t\tuniform sampler2DShadow directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\t\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t\t\t\t#ifdef USE_PCSS_SOFT_SHADOW\n\t\t\t\t\t\tuniform sampler2D directionalDepthMap[ NUM_DIR_LIGHTS ];\n\t\t\t\t#endif\n\t\t#endif\n\t\t#if NUM_POINT_SHADOWS > 0\n\t\t\t\tuniform samplerCube pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\t#endif\n\t\t#if NUM_SPOT_SHADOWS > 0\n\t\t\t\tuniform sampler2DShadow spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\t\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t\t\t\t#ifdef USE_PCSS_SOFT_SHADOW\n\t\t\t\t\t\tuniform sampler2D spotDepthMap[ NUM_SPOT_LIGHTS ];\n\t\t\t\t#endif\n\t\t#endif\n\t\t#include <packing>\n\t\t#include <shadow>\n#endif",shadowMap_pars_vert:"#ifdef USE_SHADOW\n\t\t#if NUM_DIR_SHADOWS > 0\n\t\t\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\t\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t\t#endif\n\t\t#if NUM_POINT_SHADOWS > 0\n\t\t#endif\n\t\t#if NUM_SPOT_SHADOWS > 0\n\t\t\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\t\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t\t#endif\n#endif",shadowMap_vert:"#ifdef USE_SHADOW\n\t\tvec4 worldPosition = u_Model * vec4(transformed, 1.0);\n\t\t#if NUM_DIR_SHADOWS > 0\n\t\t\t\t#pragma unroll_loop\n\t\t\t\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\t\t\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t\t\t\t}\n\t\t#endif\n\t\t#if NUM_POINT_SHADOWS > 0\n\t\t#endif\n\t\t#if NUM_SPOT_SHADOWS > 0\n\t\t\t\t#pragma unroll_loop\n\t\t\t\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\t\t\t\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t\t\t\t}\n\t\t#endif\n#endif",morphnormal_vert:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vert:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vert:"#ifdef USE_MORPHTARGETS\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",skinning_pars_vert:"#ifdef USE_SKINNING\n\t\tattribute vec4 skinIndex;\n\tattribute vec4 skinWeight;\n\t\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t\t#ifdef BONE_TEXTURE\n\t\t\t\tuniform sampler2D boneTexture;\n\t\t\t\tuniform int boneTextureSize;\n\t\t\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\t\t\t\tfloat j = i * 4.0;\n\t\t\t\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\t\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\t\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\t\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\t\t\t\ty = dy * ( y + 0.5 );\n\t\t\t\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\t\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\t\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\t\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\t\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\t\t\t\treturn bone;\n\t\t\t\t}\n\t\t#else\n\t\t\t\tuniform mat4 boneMatrices[MAX_BONES];\n\t\t\t\tmat4 getBoneMatrix(const in float i) {\n\t\t\t\t\t\tmat4 bone = boneMatrices[int(i)];\n\t\t\t\t\t\treturn bone;\n\t\t\t\t}\n\t\t#endif\n#endif",skinning_vert:"#ifdef USE_SKINNING\n\t\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\t\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\t\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\t\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n\t\tvec4 skinVertex = bindMatrix * vec4(transformed, 1.0);\n\t\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned = bindMatrixInverse * skinned;\n\t\ttransformed = skinned.xyz / skinned.w;\n#endif",skinnormal_vert:"#ifdef USE_SKINNING\n\t\tmat4 skinMatrix = mat4( 0.0 );\n\t\tskinMatrix += skinWeight.x * boneMatX;\n\t\tskinMatrix += skinWeight.y * boneMatY;\n\t\tskinMatrix += skinWeight.z * boneMatZ;\n\t\tskinMatrix += skinWeight.w * boneMatW;\n\t\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\t\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularMap_frag:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, v_Uv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularMap_pars_frag:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",spotlight_pars_frag:"struct SpotLight\n{\n\t\tvec3 position;\n\t\tvec4 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tvec3 direction;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n};\nuniform SpotLight u_Spot[NUM_SPOT_LIGHTS];",transpose:"mat4 transposeMat4(mat4 inMatrix) {\n\t\tvec4 i0 = inMatrix[0];\n\t\tvec4 i1 = inMatrix[1];\n\t\tvec4 i2 = inMatrix[2];\n\t\tvec4 i3 = inMatrix[3];\n\t\tmat4 outMatrix = mat4(\n\t\t\t\tvec4(i0.x, i1.x, i2.x, i3.x),\n\t\t\t\tvec4(i0.y, i1.y, i2.y, i3.y),\n\t\t\t\tvec4(i0.z, i1.z, i2.z, i3.z),\n\t\t\t\tvec4(i0.w, i1.w, i2.w, i3.w)\n\t\t);\n\t\treturn outMatrix;\n}",tsn:"mat3 tsn(vec3 N, vec3 V, vec2 uv) {\n\t\tvec3 q0 = vec3(dFdx(V.x), dFdx(V.y), dFdx(V.z));\n\t\tvec3 q1 = vec3(dFdy(V.x), dFdy(V.y), dFdy(V.z));\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( -q0 * st1.s + q1 * st0.s ) * scale );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn tsn;\n}",uv_pars_frag:"#ifdef USE_UV\n\t\tvarying vec2 v_Uv;\n#endif\n#ifdef USE_UV2\n\t\tvarying vec2 v_Uv2;\n#endif\n#ifdef USE_ALPHA_MAP_UV_TRANSFORM\n\t\tvarying vec2 vAlphaMapUV;\n#endif",uv_pars_vert:"#ifdef USE_UV\n\t\tattribute vec2 a_Uv;\n\t\tvarying vec2 v_Uv;\n\t\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_UV2\n\t\tattribute vec2 a_Uv2;\n\t\tvarying vec2 v_Uv2;\n#endif\n#ifdef USE_ALPHA_MAP_UV_TRANSFORM\n\t\tvarying vec2 vAlphaMapUV;\n\t\tuniform mat3 alphaMapUVTransform;\n#endif",uv_vert:"#ifdef USE_UV\n\t\tv_Uv = (uvTransform * vec3(a_Uv, 1.)).xy;\n#endif\n#ifdef USE_UV2\n\t\tv_Uv2 = a_Uv2;\n#endif\n#ifdef USE_ALPHA_MAP_UV_TRANSFORM\n\t\t#if (USE_ALPHA_MAP == 1)\n\t\t\t\tvAlphaMapUV = (alphaMapUVTransform * vec3(a_Uv, 1.)).xy;\n\t\t#elif (USE_ALPHA_MAP == 2)\n\t\t\t\tvAlphaMapUV = (alphaMapUVTransform * vec3(a_Uv2, 1.)).xy;\n\t\t#else\n\t\t\t\tvAlphaMapUV = (alphaMapUVTransform * vec3(a_Uv, 1.)).xy;\n\t\t#endif\n#endif",viewModelPos_pars_frag:"#if (NUM_POINT_LIGHTS > 0) || (NUM_SPOT_LIGHTS > 0) || defined(USE_NORMAL_MAP) || defined(USE_BUMPMAP) || defined(FLAT_SHADED) || defined(USE_PHONG) || defined(USE_PBR) || (NUM_CLIPPING_PLANES > 0) \n\t\tvarying vec3 v_modelPos;\n#endif",viewModelPos_pars_vert:"#if (NUM_POINT_LIGHTS > 0) || (NUM_SPOT_LIGHTS > 0) || defined(USE_NORMAL_MAP) || defined(USE_BUMPMAP) || defined(FLAT_SHADED) || defined(USE_PHONG) || defined(USE_PBR)|| (NUM_CLIPPING_PLANES > 0)\n\t\tvarying vec3 v_modelPos;\n#endif",viewModelPos_vert:"#if (NUM_POINT_LIGHTS > 0) || (NUM_SPOT_LIGHTS > 0) || defined(USE_NORMAL_MAP) || defined(USE_BUMPMAP) || defined(FLAT_SHADED) || defined(USE_PHONG) || defined(USE_PBR) || (NUM_CLIPPING_PLANES > 0)\n\t\tv_modelPos = (u_Model * vec4(transformed, 1.0)).xyz;\n#endif"},un="#define USE_PBR\n#include <common_vert>\n#include <normal_pars_vert>\n#include <uv_pars_vert>\n#include <color_pars_vert>\n#include <viewModelPos_pars_vert>\n#include <envMap_pars_vert>\n#include <shadowMap_pars_vert>\n#include <morphtarget_pars_vert>\n#include <skinning_pars_vert>\nvoid main() {\n\t\t#include <begin_vert>\n\t\t#include <morphtarget_vert>\n\t\t#include <morphnormal_vert>\n\t\t#include <skinning_vert>\n\t\t#include <skinnormal_vert>\n\t\t#include <pvm_vert>\n\t\t#include <normal_vert>\n\t\t#include <uv_vert>\n\t\t#include <color_vert>\n\t\t#include <viewModelPos_vert>\n\t\t#include <envMap_vert>\n\t\t#include <shadowMap_vert>\n}",ln={basic_frag:"#include <common_frag>\n#include <uv_pars_frag>\n#include <color_pars_frag>\n#include <diffuseMap_pars_frag>\n#include <alphamap_pars_frag>\n#include <envMap_pars_frag>\n#include <aoMap_pars_frag>\n#include <fog_pars_frag>\nvoid main() {\n\t\t#include <begin_frag>\n\t\t#include <color_frag>\n\t\t#include <diffuseMap_frag>\n\t\t#include <alphamap_frag>\n\t\t#include <alphaTest_frag>\n\t\t#include <envMap_frag>\n\t\t#include <end_frag>\n\t\t#include <encodings_frag>\n\t\t#include <premultipliedAlpha_frag>\n\t\t#include <fog_frag>\n}",basic_vert:"#include <common_vert>\n#include <uv_pars_vert>\n#include <color_pars_vert>\n#include <envMap_pars_vert>\n#include <morphtarget_pars_vert>\n#include <skinning_pars_vert>\nvoid main() {\n\t\t#include <begin_vert>\n\t\t#include <morphtarget_vert>\n\t\t#include <skinning_vert>\n\t\t#include <pvm_vert>\n\t\t#include <uv_vert>\n\t\t#include <color_vert>\n\t\t#include <envMap_vert>\n}",depth_frag:"#include <common_frag>\n#include <diffuseMap_pars_frag>\n#include <uv_pars_frag>\n#include <packing>\nvoid main() {\n\t\t#if defined(USE_DIFFUSE_MAP) && defined(ALPHATEST)\n\t\t\t\tvec4 texelColor = texture2D( diffuseMap, v_Uv );\n\t\t\t\tfloat alpha = texelColor.a * u_Opacity;\n\t\t\t\tif(alpha < ALPHATEST) discard;\n\t\t#endif\n\t\t\n\t\t#ifdef DEPTH_PACKING_RGBA\n\t\t\t\tgl_FragColor = packDepthToRGBA(gl_FragCoord.z);\n\t\t#else\n\t\t\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), u_Opacity );\n\t\t#endif\n}",depth_vert:"#include <common_vert>\n#include <morphtarget_pars_vert>\n#include <skinning_pars_vert>\n#include <uv_pars_vert>\nvoid main() {\n\t\t#include <uv_vert>\n\t\t#include <begin_vert>\n\t\t#include <morphtarget_vert>\n\t\t#include <skinning_vert>\n\t\t#include <pvm_vert>\n}",distance_frag:"#include <common_frag>\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 v_ModelPos;\n#include <packing>\nvoid main() {\n\t\tfloat dist = length( v_ModelPos - u_CameraPosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\t\tgl_FragColor = packDepthToRGBA(dist);\n}",distance_vert:"#include <common_vert>\nvarying vec3 v_ModelPos;\n#include <morphtarget_pars_vert>\n#include <skinning_pars_vert>\nvoid main() {\n\t\t#include <begin_vert>\n\t\t#include <morphtarget_vert>\n\t\t#include <skinning_vert>\n\t\t#include <pvm_vert>\n\t\tv_ModelPos = (u_Model * vec4(transformed, 1.0)).xyz;\n}",lambert_frag:"#define USE_LAMBERT\n#include <common_frag>\n#include <dithering_pars_frag>\nuniform vec3 emissive;\n#include <uv_pars_frag>\n#include <color_pars_frag>\n#include <diffuseMap_pars_frag>\n#include <normalMap_pars_frag>\n#include <alphamap_pars_frag>\n#include <bumpMap_pars_frag>\n#include <light_pars_frag>\n#include <normal_pars_frag>\n#include <viewModelPos_pars_frag>\n#include <bsdfs>\n#include <envMap_pars_frag>\n#include <aoMap_pars_frag>\n#include <shadowMap_pars_frag>\n#include <fog_pars_frag>\n#include <emissiveMap_pars_frag>\n#include <clippingPlanes_pars_frag>\nvoid main() {\n\t\t#include <clippingPlanes_frag>\n\t\t#include <begin_frag>\n\t\t#include <color_frag>\n\t\t#include <diffuseMap_frag>\n\t\t#include <alphamap_frag>\n\t\t#include <alphaTest_frag>\n\t\t#include <normal_frag>\n\t\t#include <light_frag>\n\t\t#include <envMap_frag>\n\t\t#include <shadowMap_frag>\n\t\tvec3 totalEmissiveRadiance = emissive;\n\t\t#include <emissiveMap_frag>\n\t\toutColor += vec4(totalEmissiveRadiance.rgb, 0.0);\n\t\t#include <end_frag>\n\t\t#include <encodings_frag>\n\t\t#include <premultipliedAlpha_frag>\n\t\t#include <fog_frag>\n\t\t#include <dithering_frag>\n}",lambert_vert:"#define USE_LAMBERT\n#include <common_vert>\n#include <normal_pars_vert>\n#include <uv_pars_vert>\n#include <color_pars_vert>\n#include <viewModelPos_pars_vert>\n#include <envMap_pars_vert>\n#include <shadowMap_pars_vert>\n#include <morphtarget_pars_vert>\n#include <skinning_pars_vert>\nvoid main() {\n\t\t#include <begin_vert>\n\t\t#include <morphtarget_vert>\n\t\t#include <morphnormal_vert>\n\t\t#include <skinning_vert>\n\t\t#include <skinnormal_vert>\n\t\t#include <pvm_vert>\n\t\t#include <normal_vert>\n\t\t#include <uv_vert>\n\t\t#include <color_vert>\n\t\t#include <viewModelPos_vert>\n\t\t#include <envMap_vert>\n\t\t#include <shadowMap_vert>\n}",normaldepth_frag:"#include <common_frag>\n#include <diffuseMap_pars_frag>\n#include <uv_pars_frag>\n#include <packing>\n#include <normal_pars_frag>\nvoid main() {\n\t\t#if defined(USE_DIFFUSE_MAP) && defined(ALPHATEST)\n\t\t\t\tvec4 texelColor = texture2D( diffuseMap, v_Uv );\n\t\t\t\tfloat alpha = texelColor.a * u_Opacity;\n\t\t\t\tif(alpha < ALPHATEST) discard;\n\t\t#endif\n\t\tvec4 packedNormalDepth;\n\t\tpackedNormalDepth.xyz = normalize(v_Normal) * 0.5 + 0.5;\n\t\tpackedNormalDepth.w = gl_FragCoord.z;\n\t\tgl_FragColor = packedNormalDepth;\n}",normaldepth_vert:"#include <common_vert>\n#include <morphtarget_pars_vert>\n#include <skinning_pars_vert>\n#include <normal_pars_vert>\n#include <uv_pars_vert>\nvoid main() {\n\t\t#include <uv_vert>\n\t\t#include <begin_vert>\n\t\t#include <morphtarget_vert>\n\t\t#include <morphnormal_vert>\n\t\t#include <skinning_vert>\n\t\t#include <skinnormal_vert>\n\t\t#include <normal_vert>\n\t\t#include <pvm_vert>\n}",pbr_frag:"#define USE_PBR\n#include <common_frag>\n#include <dithering_pars_frag>\nuniform float u_Metalness;\n#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif\nuniform float u_Roughness;\n#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif\nuniform vec3 emissive;\n#include <uv_pars_frag>\n#include <color_pars_frag>\n#include <diffuseMap_pars_frag>\n#include <alphamap_pars_frag>\n#include <normalMap_pars_frag>\n#include <bumpMap_pars_frag>\n#include <envMap_pars_frag>\n#include <aoMap_pars_frag>\n#include <light_pars_frag>\n#include <normal_pars_frag>\n#include <viewModelPos_pars_frag>\n#include <bsdfs>\n#include <shadowMap_pars_frag>\n#include <fog_pars_frag>\n#include <emissiveMap_pars_frag>\n#include <clippingPlanes_pars_frag>\nvoid main() {\n\t\t#include <clippingPlanes_frag>\n\t\t#include <begin_frag>\n\t\t#include <color_frag>\n\t\t#include <diffuseMap_frag>\n\t\t#include <alphamap_frag>\n\t\t#include <alphaTest_frag>\n\t\t#include <normal_frag>\n\t\tfloat roughnessFactor = u_Roughness;\n\t\t#ifdef USE_ROUGHNESSMAP\n\t\t\tvec4 texelRoughness = texture2D( roughnessMap, v_Uv );\n\t\t\troughnessFactor *= texelRoughness.g;\n\t\t#endif\n\t\tfloat metalnessFactor = u_Metalness;\n\t\t#ifdef USE_METALNESSMAP\n\t\t\tvec4 texelMetalness = texture2D( metalnessMap, v_Uv );\n\t\t\tmetalnessFactor *= texelMetalness.b;\n\t\t#endif\n\t\t#include <light_frag>\n\t\t#include <shadowMap_frag>\n\t\tvec3 totalEmissiveRadiance = emissive;\n\t\t#include <emissiveMap_frag>\n\t\toutColor += vec4(totalEmissiveRadiance.rgb, 0.0);\n\t\t#include <end_frag>\n\t\t#include <encodings_frag>\n\t\t#include <premultipliedAlpha_frag>\n\t\t#include <fog_frag>\n\t\t#include <dithering_frag>\n}",pbr_vert:un,pbr2_frag:"#define USE_PBR\n#define USE_PBR2\n#include <common_frag>\n#include <dithering_pars_frag>\nuniform vec3 u_SpecularColor;\n#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif\nuniform float glossiness;\n#ifdef USE_GLOSSINESSMAP\n\tuniform sampler2D glossinessMap;\n#endif\nuniform vec3 emissive;\n#include <uv_pars_frag>\n#include <color_pars_frag>\n#include <diffuseMap_pars_frag>\n#include <alphamap_pars_frag>\n#include <normalMap_pars_frag>\n#include <bumpMap_pars_frag>\n#include <envMap_pars_frag>\n#include <aoMap_pars_frag>\n#include <light_pars_frag>\n#include <normal_pars_frag>\n#include <viewModelPos_pars_frag>\n#include <bsdfs>\n#include <shadowMap_pars_frag>\n#include <fog_pars_frag>\n#include <emissiveMap_pars_frag>\n#include <clippingPlanes_pars_frag>\nvoid main() {\n\t\t#include <clippingPlanes_frag>\n\t\t#include <begin_frag>\n\t\t#include <color_frag>\n\t\t#include <diffuseMap_frag>\n\t\t#include <alphamap_frag>\n\t\t#include <alphaTest_frag>\n\t\t#include <normal_frag>\n\t\tvec3 specularFactor = u_SpecularColor;\n\t\t#ifdef USE_SPECULARMAP\n\t\t\t\tvec4 texelSpecular = texture2D(specularMap, v_Uv);\n\t\t\t\ttexelSpecular = sRGBToLinear(texelSpecular);\n\t\t\t\tspecularFactor *= texelSpecular.rgb;\n\t\t#endif\n\t\tfloat glossinessFactor = glossiness;\n\t\t#ifdef USE_GLOSSINESSMAP\n\t\t\t\tvec4 texelGlossiness = texture2D(glossinessMap, v_Uv);\n\t\t\t\tglossinessFactor *= texelGlossiness.a;\n\t\t#endif\n\t\t#include <light_frag>\n\t\t#include <shadowMap_frag>\n\t\tvec3 totalEmissiveRadiance = emissive;\n\t\t#include <emissiveMap_frag>\n\t\toutColor += vec4(totalEmissiveRadiance.rgb, 0.0);\n\t\t#include <end_frag>\n\t\t#include <encodings_frag>\n\t\t#include <premultipliedAlpha_frag>\n\t\t#include <fog_frag>\n\t\t#include <dithering_frag>\n}",pbr2_vert:un,matcap_frag:"#define MATCAP\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common_frag>\n#include <dithering_pars_frag>\n#include <uv_pars_frag>\n#include <color_pars_frag>\n#include <diffuseMap_pars_frag>\n#include <alphamap_pars_frag>\n#include <normalMap_pars_frag>\n#include <viewModelPos_pars_frag>\n#include <bumpMap_pars_frag>\n#include <normal_pars_frag>\n#include <fog_pars_frag>\n#include <clippingPlanes_pars_frag>\nvoid main() {\n\t\t#include <clippingPlanes_frag>\n\t\t#include <begin_frag>\n\t\t#include <color_frag>\n\t\t#include <diffuseMap_frag>\n\t\t#include <alphamap_frag>\n\t\t#include <alphaTest_frag>\n\t\t#include <normal_frag>\n\t\tvec3 viewDir = normalize(vViewPosition);\n\tvec3 x = normalize(vec3(viewDir.z, 0.0, -viewDir.x));\n\tvec3 y = cross(viewDir, x);\n\t\tvec3 viewN = (u_View * vec4(N, 0.0)).xyz;\n\tvec2 uv = vec2(dot(x, viewN), dot(y, viewN)) * 0.495 + 0.5;\n\t\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D(matcap, uv);\n\t\tmatcapColor = matcapTexelToLinear(matcapColor);\n\t#else\n\t\tvec4 matcapColor = vec4(1.0);\n\t#endif\n\toutColor.rgb *= matcapColor.rgb;\n\t\t#include <end_frag>\n\t\t#include <encodings_frag>\n\t\t#include <premultipliedAlpha_frag>\n\t\t#include <fog_frag>\n\t\t#include <dithering_frag>\n}",matcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common_vert>\n#include <normal_pars_vert>\n#include <uv_pars_vert>\n#include <color_pars_vert>\n#include <viewModelPos_pars_vert>\n#include <morphtarget_pars_vert>\n#include <skinning_pars_vert>\nvoid main() {\n\t\t#include <begin_vert>\n\t\t#include <morphtarget_vert>\n\t\t#include <morphnormal_vert>\n\t\t#include <skinning_vert>\n\t\t#include <skinnormal_vert>\n\t\t#include <pvm_vert>\n\t\t#include <normal_vert>\n\t\t#include <uv_vert>\n\t\t#include <color_vert>\n\t\t#include <viewModelPos_vert>\n\t\tvec4 mvPosition = u_View * u_Model * vec4(transformed, 1.0);\n\t\tvViewPosition = - mvPosition.xyz;\n}",phong_frag:"#define USE_PHONG\n#include <common_frag>\n#include <dithering_pars_frag>\nuniform float u_Specular;\nuniform vec3 u_SpecularColor;\n#include <specularMap_pars_frag>\nuniform vec3 emissive;\n#include <uv_pars_frag>\n#include <color_pars_frag>\n#include <diffuseMap_pars_frag>\n#include <alphamap_pars_frag>\n#include <normalMap_pars_frag>\n#include <bumpMap_pars_frag>\n#include <light_pars_frag>\n#include <normal_pars_frag>\n#include <viewModelPos_pars_frag>\n#include <bsdfs>\n#include <envMap_pars_frag>\n#include <aoMap_pars_frag>\n#include <shadowMap_pars_frag>\n#include <fog_pars_frag>\n#include <emissiveMap_pars_frag>\n#include <clippingPlanes_pars_frag>\nvoid main() {\n\t\t#include <clippingPlanes_frag>\n\t\t#include <begin_frag>\n\t\t#include <color_frag>\n\t\t#include <diffuseMap_frag>\n\t\t#include <alphamap_frag>\n\t\t#include <alphaTest_frag>\n\t\t#include <normal_frag>\n\t\t#include <specularMap_frag>\n\t\t#include <light_frag>\n\t\t#include <envMap_frag>\n\t\t#include <shadowMap_frag>\n\t\tvec3 totalEmissiveRadiance = emissive;\n\t\t#include <emissiveMap_frag>\n\t\toutColor += vec4(totalEmissiveRadiance.rgb, 0.0);\n\t\t#include <end_frag>\n\t\t#include <encodings_frag>\n\t\t#include <premultipliedAlpha_frag>\n\t\t#include <fog_frag>\n\t\t#include <dithering_frag>\n}",phong_vert:"#define USE_PHONG\n#include <common_vert>\n#include <normal_pars_vert>\n#include <uv_pars_vert>\n#include <color_pars_vert>\n#include <viewModelPos_pars_vert>\n#include <envMap_pars_vert>\n#include <shadowMap_pars_vert>\n#include <morphtarget_pars_vert>\n#include <skinning_pars_vert>\nvoid main() {\n\t\t#include <begin_vert>\n\t\t#include <morphtarget_vert>\n\t\t#include <morphnormal_vert>\n\t\t#include <skinning_vert>\n\t\t#include <skinnormal_vert>\n\t\t#include <pvm_vert>\n\t\t#include <normal_vert>\n\t\t#include <uv_vert>\n\t\t#include <color_vert>\n\t\t#include <viewModelPos_vert>\n\t\t#include <envMap_vert>\n\t\t#include <shadowMap_vert>\n}",point_frag:"#include <common_frag>\n#include <diffuseMap_pars_frag>\n#include <fog_pars_frag>\nvoid main() {\n\t\t#include <begin_frag>\n\t\t#ifdef USE_DIFFUSE_MAP\n\t\t\t\toutColor *= texture2D(diffuseMap, vec2(gl_PointCoord.x, 1.0 - gl_PointCoord.y));\n\t\t#endif\n\t\t#include <end_frag>\n\t\t#include <encodings_frag>\n\t\t#include <premultipliedAlpha_frag>\n\t\t#include <fog_frag>\n}",point_vert:"#include <common_vert>\nuniform float u_PointSize;\nuniform float u_PointScale;\nvoid main() {\n\t\t#include <begin_vert>\n\t\t#include <pvm_vert>\n\t\tvec4 mvPosition = u_View * u_Model * vec4(transformed, 1.0);\n\t\t#ifdef USE_SIZEATTENUATION\n\t\t\t\tgl_PointSize = u_PointSize * ( u_PointScale / - mvPosition.z );\n\t\t#else\n\t\t\t\tgl_PointSize = u_PointSize;\n\t\t#endif\n}"};function dn(t){var e;return t?t.encoding&&(e=t.encoding):e=N.LINEAR,e}function pn(t){switch(t){case N.LINEAR:return["Linear","( value )"];case N.SRGB:return["sRGB","( value )"];case N.RGBE:return["RGBE","( value )"];case N.RGBM7:return["RGBM","( value, 7.0 )"];case N.RGBM16:return["RGBM","( value, 16.0 )"];case N.RGBD:return["RGBD","( value, 256.0 )"];case N.GAMMA:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:console.error("unsupported encoding: "+t)}}function fn(t,e){var n=pn(e);return"vec4 "+t+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}var _n=function t(e){return e.replace(/#include +<([\w\d.]+)>/g,(function(e,n){var i=cn[n];if(void 0===i)throw new Error("Can not resolve #include <"+n+">");return t(i)}))};function vn(t){return""!==t}function mn(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.directLightNum).replace(/NUM_SPOT_LIGHTS/g,e.spotLightNum).replace(/NUM_POINT_LIGHTS/g,e.pointLightNum).replace(/NUM_DIR_SHADOWS/g,e.directShadowNum).replace(/NUM_SPOT_SHADOWS/g,e.spotShadowNum).replace(/NUM_POINT_SHADOWS/g,e.pointShadowNum)}function gn(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes)}function Mn(t){return t.replace(/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,(function(t,e,n,i){for(var r="",a=parseInt(e);a<parseInt(n);a++)r+=i.replace(/\[ i \]/g,"[ "+a+" ]");return r}))}function En(t,e,n){var i=[];this.getProgram=function(r,a,s,o){a=a||s.material;for(var c,d=function(t,e,n,i,r,a){var s=a&&i.acceptLight?a.lights:null,o=a?a.fog:null,c=a?a.clippingPlanes:null,d=a?a.disableShadowSampler:null,p={};p.materialType=i.type,e=e,p.version=e.version,p.precision=i.precision||e.maxPrecision,p.useStandardDerivatives=e.version>=2||!!e.getExtension("OES_standard_derivatives")||!!e.getExtension("GL_OES_standard_derivatives"),p.useShaderTextureLOD=e.version>=2||!!e.getExtension("EXT_shader_texture_lod"),p.useDiffuseMap=i.diffuseMap?i.diffuseMapCoord+1:0,p.useAlphaMap=i.alphaMap?i.alphaMapCoord+1:0,p.useAlphaMapUVTransform=!!i.alphaMap&&i.alphaMap.useUVTransform,p.useNormalMap=!!i.normalMap,p.useBumpMap=!!i.bumpMap,p.useSpecularMap=!!i.specularMap,p.useEnvMap=!!i.envMap,p.envMapCombine=i.envMapCombine,p.useEmissiveMap=i.emissiveMap?i.emissiveMapCoord+1:0,p.useRoughnessMap=!!i.roughnessMap,p.useMetalnessMap=!!i.metalnessMap,p.useGlossinessMap=!!i.glossinessMap,p.useAOMap=i.aoMap?i.aoMapCoord+1:0,p.useMatcap=!!i.matcap,p.useVertexUvs=!!(i.diffuseMap||i.alphaMap||i.normalMap||i.bumpMap||i.specularMap||i.emissiveMap||i.roughnessMap||i.metalnessMap||i.glossinessMap||i.aoMap),p.ambientLightNum=s?s.ambientsNum:0,p.directLightNum=s?s.directsNum:0,p.pointLightNum=s?s.pointsNum:0,p.spotLightNum=s?s.spotsNum:0,p.directShadowNum=r.receiveShadow&&s?s.directShadowNum:0,p.pointShadowNum=r.receiveShadow&&s?s.pointShadowNum:0,p.spotShadowNum=r.receiveShadow&&s?s.spotShadowNum:0,p.useShadow=r.receiveShadow&&!!s&&s.shadowsNum>0,r.shadowType.indexOf("pcss")>-1?e.version<2?(console.warn("WebGL 1.0 not support PCSS soft shadow, fallback to POISSON_SOFT"),p.shadowType=A.POISSON_SOFT):d&&(console.warn("Set scene.disableShadowSampler to true can not use pcss, fallback to POISSON_SOFT"),p.shadowType=A.POISSON_SOFT):p.shadowType=r.shadowType,p.useShadowSampler=e.version>=2&&!d,p.dithering=i.dithering;var f=t.currentRenderTarget;p.gammaFactor=n.gammaFactor,p.outputEncoding=f.texture?dn(f.texture):n.outputEncoding,p.diffuseMapEncoding=dn(i.diffuseMap||i.cubeMap),p.envMapEncoding=dn(i.envMap),p.emissiveMapEncoding=dn(i.emissiveMap),p.matcapEncoding=dn(i.matcap),p.alphaTest=i.alphaTest,p.premultipliedAlpha=i.premultipliedAlpha,p.useVertexColors=i.vertexColors,p.useVertexTangents=!!i.normalMap&&i.vertexTangents,p.numClippingPlanes=c?c.length:0,p.flatShading=i.shading===m.FLAT_SHADING,p.fog=!!o,p.fogExp2=!!o&&o.fogType===l.EXP2,p.sizeAttenuation=i.sizeAttenuation,p.doubleSided=i.side===v.DOUBLE,p.flipSided=i.side===v.BACK,p.packDepthToRGBA=i.packToRGBA,p.morphTargets=!!r.morphTargetInfluences,p.morphNormals=!!r.morphTargetInfluences&&r.geometry.morphAttributes.normal;var _=r.type===h.SKINNED_MESH&&r.skeleton,g=e.maxVertexUniformVectors,M=e.maxVertexTextures>0&&(!!e.getExtension("OES_texture_float")||e.version>=2),E=0;return M?E=1024:16*(E=r.skeleton?r.skeleton.bones.length:0)>g&&(console.warn("Program: too many bones ("+E+"), current cpu only support "+Math.floor(g/16)+" bones!!"),E=Math.floor(g/16)),p.useSkinning=_,p.bonesNum=E,p.useVertexTexture=M,i.type===u.SHADER&&(p.vertexShader=i.vertexShader,p.fragmentShader=i.fragmentShader),p}(e,n,r,a,s,o),p=function(t,e){var n="";for(var i in t)n+=t[i]+"_";if(void 0!==e.defines)for(var r in e.defines)n+=r+"_"+e.defines[r]+"_";return n}(d,a),f=0,_=i.length;f<_;f++){var g=i[f];if(g.code===p){++(c=g).usedTimes;break}}if(void 0===c){var M="";void 0!==a.defines&&(M=function(t){var e=[];for(var n in t){var i=t[n];!1!==i&&e.push("#define "+n+" "+i)}return e.join("\n")}(a.defines)),(c=function(t,e,n){var i,r,a,s=["precision "+e.precision+" float;","precision "+e.precision+" int;","precision "+e.precision+" sampler2D;","#define SHADER_NAME "+e.materialType,n,e.version>=2?"#define WEBGL2":"",e.useRoughnessMap?"#define USE_ROUGHNESSMAP":"",e.useMetalnessMap?"#define USE_METALNESSMAP":"",e.useGlossinessMap?"#define USE_GLOSSINESSMAP":"",e.ambientLightNum>0?"#define USE_AMBIENT_LIGHT "+e.ambientLightNum:"",e.pointLightNum>0||e.directLightNum>0||e.ambientLightNum>0||e.spotLightNum>0?"#define USE_LIGHT":"",e.useNormalMap?"#define USE_NORMAL_MAP":"",e.useBumpMap?"#define USE_BUMPMAP":"",e.useSpecularMap?"#define USE_SPECULARMAP":"",e.useEmissiveMap?"#define USE_EMISSIVEMAP "+e.useEmissiveMap:"",e.useShadow?"#define USE_SHADOW":"",e.flatShading?"#define FLAT_SHADED":"",e.flipSided?"#define FLIP_SIDED":"",e.useDiffuseMap?"#define USE_DIFFUSE_MAP "+e.useDiffuseMap:"",e.useAlphaMap?"#define USE_ALPHA_MAP "+e.useAlphaMap:"",e.useAlphaMapUVTransform?"#define USE_ALPHA_MAP_UV_TRANSFORM":"",e.useEnvMap?"#define USE_ENV_MAP":"",e.sizeAttenuation?"#define USE_SIZEATTENUATION":"",e.useAOMap?"#define USE_AOMAP "+e.useAOMap:"",e.useVertexColors==P.RGB?"#define USE_VCOLOR_RGB":"",e.useVertexColors==P.RGBA?"#define USE_VCOLOR_RGBA":"",e.useVertexTangents?"#define USE_TANGENT":"",e.useVertexUvs?"#define USE_UV":"",e.morphTargets?"#define USE_MORPHTARGETS":"",e.morphNormals&&!1===e.flatShading?"#define USE_MORPHNORMALS":"",e.useSkinning?"#define USE_SKINNING":"",e.bonesNum>0?"#define MAX_BONES "+e.bonesNum:"",e.useVertexTexture?"#define BONE_TEXTURE":""].filter(vn).join("\n"),o=[e.useStandardDerivatives&&e.version<2?"#extension GL_OES_standard_derivatives : enable":"",e.useShaderTextureLOD&&e.version<2?"#extension GL_EXT_shader_texture_lod : enable":"","precision "+e.precision+" float;","precision "+e.precision+" int;","precision "+e.precision+" sampler2D;",e.version>=2?"precision "+e.precision+" sampler2DShadow;":"",e.version>=2?"precision "+e.precision+" samplerCubeShadow;":"","#define SHADER_NAME "+e.materialType,"#define PI 3.14159265359","#define EPSILON 1e-6","float pow2( const in float x ) { return x*x; }","#define LOG2 1.442695","#define RECIPROCAL_PI 0.31830988618","#define saturate(a) clamp( a, 0.0, 1.0 )","#define whiteCompliment(a) ( 1.0 - saturate( a ) )","highp float rand( const in vec2 uv ) {","const highp float a = 12.9898, b = 78.233, c = 43758.5453;","highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );","return fract(sin(sn) * c);","}",n,e.version>=2?"#define WEBGL2":"",e.useShadowSampler?"#define USE_SHADOW_SAMPLER":"#define sampler2DShadow sampler2D",e.useRoughnessMap?"#define USE_ROUGHNESSMAP":"",e.useMetalnessMap?"#define USE_METALNESSMAP":"",e.useGlossinessMap?"#define USE_GLOSSINESSMAP":"",e.ambientLightNum>0?"#define USE_AMBIENT_LIGHT "+e.ambientLightNum:"",e.pointLightNum>0||e.directLightNum>0||e.ambientLightNum>0||e.spotLightNum>0?"#define USE_LIGHT":"",e.useNormalMap?"#define USE_NORMAL_MAP":"",e.useBumpMap?"#define USE_BUMPMAP":"",e.useSpecularMap?"#define USE_SPECULARMAP":"",e.useEmissiveMap?"#define USE_EMISSIVEMAP "+e.useEmissiveMap:"",e.useShadow?"#define USE_SHADOW":"",e.shadowType===A.HARD?"#define USE_HARD_SHADOW":"",e.shadowType===A.POISSON_SOFT?"#define USE_POISSON_SOFT_SHADOW":"",e.shadowType===A.PCF3_SOFT?"#define USE_PCF3_SOFT_SHADOW":"",e.shadowType===A.PCF5_SOFT?"#define USE_PCF5_SOFT_SHADOW":"",e.shadowType===A.PCSS16_SOFT?"#define USE_PCSS16_SOFT_SHADOW":"",e.shadowType===A.PCSS32_SOFT?"#define USE_PCSS32_SOFT_SHADOW":"",e.shadowType===A.PCSS64_SOFT?"#define USE_PCSS64_SOFT_SHADOW":"",e.shadowType===A.PCSS16_SOFT||e.shadowType===A.PCSS32_SOFT||e.shadowType===A.PCSS64_SOFT?"#define USE_PCSS_SOFT_SHADOW":"",e.flatShading?"#define FLAT_SHADED":"",e.doubleSided?"#define DOUBLE_SIDED":"",e.useShaderTextureLOD?"#define TEXTURE_LOD_EXT":"",e.useDiffuseMap?"#define USE_DIFFUSE_MAP "+e.useDiffuseMap:"",e.useAlphaMap?"#define USE_ALPHA_MAP "+e.useAlphaMap:"",e.useAlphaMapUVTransform?"#define USE_ALPHA_MAP_UV_TRANSFORM":"",e.useEnvMap?"#define USE_ENV_MAP":"",e.useAOMap?"#define USE_AOMAP "+e.useAOMap:"",e.useVertexColors==P.RGB?"#define USE_VCOLOR_RGB":"",e.useVertexColors==P.RGBA?"#define USE_VCOLOR_RGBA":"",e.useVertexTangents?"#define USE_TANGENT":"",e.premultipliedAlpha?"#define USE_PREMULTIPLIED_ALPHA":"",e.fog?"#define USE_FOG":"",e.fogExp2?"#define USE_EXP2_FOG":"",e.alphaTest?"#define ALPHATEST "+e.alphaTest:"",e.useEnvMap?"#define "+e.envMapCombine:"","#define GAMMA_FACTOR "+e.gammaFactor,e.useMatcap?"#define USE_MATCAP":"",e.useVertexUvs?"#define USE_UV":"",e.dithering?"#define DITHERING":"",cn.encodings_pars_frag,fn("mapTexelToLinear",e.diffuseMapEncoding),e.useEnvMap?fn("envMapTexelToLinear",e.envMapEncoding):"",e.useEmissiveMap?fn("emissiveMapTexelToLinear",e.emissiveMapEncoding):"",e.useMatcap?fn("matcapTexelToLinear",e.matcapEncoding):"",(i="linearToOutputTexel",r=e.outputEncoding,a=pn(r),"vec4 "+i+"( vec4 value ) { return LinearTo"+a[0]+a[1]+"; }"),e.packDepthToRGBA?"#define DEPTH_PACKING_RGBA":""].filter(vn).join("\n"),h=ln[e.materialType+"_vert"]||e.vertexShader||ln.basic_vert,c=ln[e.materialType+"_frag"]||e.fragmentShader||ln.basic_frag,u=[s,h].join("\n"),l=[o,c].join("\n");if(u=_n(u),l=_n(l),u=mn(u,e),l=mn(l,e),u=gn(u,e),l=gn(l,e),u=Mn(u),l=Mn(l),e.version>1){l=l.replace("#extension GL_EXT_draw_buffers : require","");for(var d=0,p=[];l.indexOf("gl_FragData["+d+"]")>-1;)l=l.replace("gl_FragData["+d+"]","pc_fragData"+d),p.push("layout(location = "+d+") out vec4 pc_fragData"+d+";"),d++;l=l.replace("#define whiteCompliment(a) ( 1.0 - saturate( a ) )","#define whiteCompliment(a) ( 1.0 - saturate( a ) )\n"+p.join("\n")+"\n"),u=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+u,l=["#version 300 es\n","#define varying in",l.indexOf("layout")>-1?"":"out highp vec4 pc_fragColor;","#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+l}return new hn(t,u,l)}(t,d,M)).code=p,i.push(c)}return c},this.releaseProgram=function(e){if(0==--e.usedTimes){var n=i.indexOf(e);i[n]=i[i.length-1],i.pop(),e.dispose(t)}},this.programs=i}function Sn(t,e,n){this.gl=t,this.properties=e,this.capabilities=n}function xn(t,e,n,i,r,a){this.gl=t,this.state=e,this.texture=n,this.renderBuffer=i,this.properties=r,this.capabilities=a}Object.assign(Sn.prototype,{setRenderBuffer:function(t){var e=this.gl,n=this.capabilities,i=this.properties.get(t);return void 0===i.__webglRenderbuffer?(t.addEventListener("dispose",this.onRenderBufferDispose,this),i.__webglRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,i.__webglRenderbuffer),t.multipleSampling>0?(n.version<2&&console.error("render buffer multipleSampling is not support in webgl 1.0."),e.renderbufferStorageMultisample(e.RENDERBUFFER,Math.min(t.multipleSampling,n.maxSamples),t.format,t.width,t.height)):e.renderbufferStorage(e.RENDERBUFFER,t.format,t.width,t.height)):e.bindRenderbuffer(e.RENDERBUFFER,i.__webglRenderbuffer),i},onRenderBufferDispose:function(t){var e=this.gl,n=t.target,i=this.properties.get(n);i.__webglRenderbuffer&&e.deleteRenderbuffer(i.__webglRenderbuffer),this.properties.delete(n)}}),Object.assign(xn.prototype,{setRenderTarget2D:function(t){var e=this.gl,n=this.state,i=this.texture,r=this.renderBuffer,a=this.capabilities,s=this.properties.get(t);if(void 0!==s.__webglFramebuffer)e.bindFramebuffer(e.FRAMEBUFFER,s.__webglFramebuffer);else{t.addEventListener("dispose",this.onRenderTargetDispose,this),s.__webglFramebuffer=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,s.__webglFramebuffer);var o=[];for(var h in t._attachments)if((h=Number(h))!==L.DEPTH_ATTACHMENT&&h!==L.DEPTH_STENCIL_ATTACHMENT||a.version<2&&!a.getExtension("WEBGL_depth_texture")&&console.warn("extension WEBGL_depth_texture is not support in webgl 1.0."),(h<=36073&&h>=36064||h<=577045&&h>=577040)&&o.push(h),t._attachments[h].isTexture){var c=i.setTexture2D(t._attachments[h]);e.framebufferTexture2D(e.FRAMEBUFFER,h,e.TEXTURE_2D,c.__webglTexture,0),n.bindTexture(e.TEXTURE_2D,null)}else{var u=r.setRenderBuffer(t._attachments[h]);e.framebufferRenderbuffer(e.FRAMEBUFFER,h,e.RENDERBUFFER,u.__webglRenderbuffer),e.bindRenderbuffer(e.RENDERBUFFER,null)}o.length>1&&(a.version>=2?e.drawBuffers(o):a.getExtension("WEBGL_draw_buffers")&&a.getExtension("WEBGL_draw_buffers").drawBuffersWEBGL(o));var l=e.checkFramebufferStatus(e.FRAMEBUFFER);l!==e.FRAMEBUFFER_COMPLETE&&(l===e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT?console.warn("framebuffer not complete: FRAMEBUFFER_INCOMPLETE_ATTACHMENT"):l===e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT?console.warn("framebuffer not complete: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT"):l===e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS?console.warn("framebuffer not complete: FRAMEBUFFER_INCOMPLETE_DIMENSIONS"):l===e.FRAMEBUFFER_UNSUPPORTED?console.warn("framebuffer not complete: FRAMEBUFFER_UNSUPPORTED"):l===e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE?console.warn("framebuffer not complete: FRAMEBUFFER_INCOMPLETE_MULTISAMPLE"):console.warn("framebuffer not complete."))}},setRenderTargetCube:function(t){var e=this.gl,n=this.state,i=this.texture,r=this.renderBuffer,a=this.capabilities,s=this.properties.get(t);if(void 0!==s.__webglFramebuffer){for(var o in e.bindFramebuffer(e.FRAMEBUFFER,s.__webglFramebuffer),t._attachments)if(t._attachments[o].isTexture){c=this.properties.get(t._attachments[o]);e.framebufferTexture2D(e.FRAMEBUFFER,o,e.TEXTURE_CUBE_MAP_POSITIVE_X+t.activeCubeFace,c.__webglTexture,0)}s.__currentActiveCubeFace=t.activeCubeFace}else{t.addEventListener("dispose",this.onRenderTargetDispose,this),s.__webglFramebuffer=e.createFramebuffer(),s.__currentActiveCubeFace=t.activeCubeFace,e.bindFramebuffer(e.FRAMEBUFFER,s.__webglFramebuffer);var h=[];for(var o in t._attachments)if((o=Number(o))!==L.DEPTH_ATTACHMENT&&o!==L.DEPTH_STENCIL_ATTACHMENT||a.version<2&&!a.getExtension("WEBGL_depth_texture")&&console.warn("extension WEBGL_depth_texture is not support in webgl 1.0."),(o<=36073&&o>=36064||o<=577045&&o>=577040)&&h.push(o),t._attachments[o].isTexture){var c=i.setTextureCube(t._attachments[o]);e.framebufferTexture2D(e.FRAMEBUFFER,o,e.TEXTURE_CUBE_MAP_POSITIVE_X+t.activeCubeFace,c.__webglTexture,0),n.bindTexture(e.TEXTURE_CUBE_MAP,null)}else{var u=r.setRenderBuffer(t._attachments[o]);e.framebufferRenderbuffer(e.FRAMEBUFFER,o,e.RENDERBUFFER,u.__webglRenderbuffer),e.bindRenderbuffer(e.RENDERBUFFER,null)}h.length>1&&(a.version>=2?e.drawBuffers(h):a.getExtension("WEBGL_draw_buffers")&&a.getExtension("WEBGL_draw_buffers").drawBuffersWEBGL(h));var l=e.checkFramebufferStatus(e.FRAMEBUFFER);l!==e.FRAMEBUFFER_COMPLETE&&(l===e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT?console.warn("framebuffer not complete: FRAMEBUFFER_INCOMPLETE_ATTACHMENT"):l===e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT?console.warn("framebuffer not complete: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT"):l===e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS?console.warn("framebuffer not complete: FRAMEBUFFER_INCOMPLETE_DIMENSIONS"):l===e.FRAMEBUFFER_UNSUPPORTED?console.warn("framebuffer not complete: FRAMEBUFFER_UNSUPPORTED"):l===e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE?console.warn("framebuffer not complete: FRAMEBUFFER_INCOMPLETE_MULTISAMPLE"):console.warn("framebuffer not complete."))}},blitRenderTarget:function(t,e,n,i,r){var a=this.gl,s=this.properties,o=this.capabilities;if(o.version<2)console.warn("blitFramebuffer not support by WebGL"+o.version);else{var h=s.get(t).__webglFramebuffer,c=s.get(e).__webglFramebuffer;a.bindFramebuffer(a.READ_FRAMEBUFFER,h),a.bindFramebuffer(a.DRAW_FRAMEBUFFER,c);var u=0;(void 0===n||n)&&(u|=a.COLOR_BUFFER_BIT),(void 0===i||i)&&(u|=a.DEPTH_BUFFER_BIT),(void 0===r||r)&&(u|=a.STENCIL_BUFFER_BIT),a.blitFramebuffer(0,0,t.width,t.height,0,0,e.width,e.height,u,a.NEAREST)}},updateRenderTargetMipmap:function(t){var e,n=this.gl,i=this.state,a=t.texture;if(a.generateMipmaps&&(r((e=t).width)&&r(e.height))&&a.minFilter!==n.NEAREST&&a.minFilter!==n.LINEAR){var s=a.textureType,o=this.properties.get(a).__webglTexture;i.bindTexture(s,o),n.generateMipmap(s),i.bindTexture(s,null)}},onRenderTargetDispose:function(t){var e=this.gl,n=this.state,i=t.target,r=this.properties.get(i);for(var a in i.removeEventListener("dispose",this.onRenderTargetDispose,this),r.__webglFramebuffer&&e.deleteFramebuffer(r.__webglFramebuffer),i._attachments)i._attachments[a].dispose();this.properties.delete(i),n.currentRenderTarget===i&&(n.currentRenderTarget=null)},setRenderTarget:function(t){var e=this.gl,n=this.state;if(t.view)n.currentRenderTarget===t||(e.bindFramebuffer(e.FRAMEBUFFER,null),n.currentRenderTarget=t);else{var i=void 0!==t.activeCubeFace;if(n.currentRenderTarget!==t)i?this.setRenderTargetCube(t):this.setRenderTarget2D(t),n.currentRenderTarget=t;else if(i){var r=this.properties.get(t);if(r.__currentActiveCubeFace!==t.activeCubeFace){for(var a in t._attachments){var s=this.properties.get(t._attachments[a]);e.framebufferTexture2D(e.FRAMEBUFFER,a,e.TEXTURE_CUBE_MAP_POSITIVE_X+t.activeCubeFace,s.__webglTexture,0)}r.__currentActiveCubeFace=t.activeCubeFace}}}}});var yn,Tn=function(){function t(t,e,n){this._gl=t,this._properties=e,this._capabilities=n,this._isWebGL2=n.version>=2,this._vaoExt=n.getExtension("OES_vertex_array_object"),this._currentGeometryProgram=""}var e=t.prototype;return e.setup=function(t,e,n){var i=this._properties.get(e);if(t.morphTargetInfluences)this._setupVertexAttributes(n,e),this._currentGeometryProgram="";else if(this._isWebGL2||this._vaoExt){var r;r=i._vaos[n.id]?i._vaos[n.id]:i._vaos[n.id]={version:-1,object:this._createVAO()},this._bindVAO(r.object),r.version!==e.version&&(this._setupVertexAttributes(n,e),r.version=e.version)}else{var a=n.id+"_"+e.id+"_"+e.version;a!==this._currentGeometryProgram&&(this._setupVertexAttributes(n,e),this._currentGeometryProgram=a)}},e._createVAO=function(){return this._isWebGL2?this._gl.createVertexArray():this._vaoExt?this._vaoExt.createVertexArrayOES():null},e._bindVAO=function(t){return this._isWebGL2?this._gl.bindVertexArray(t):this._vaoExt?this._vaoExt.bindVertexArrayOES(t):void 0},e.resetBinding=function(){this._isWebGL2?this._gl.bindVertexArray(null):this._vaoExt&&this._vaoExt.bindVertexArrayOES(null)},e.disposeVAO=function(t){this._isWebGL2?this._gl.deleteVertexArray(t):this._vaoExt&&this._vaoExt.deleteVertexArrayOES(t)},e._setupVertexAttributes=function(t,e){var n=this._gl,i=this._isWebGL2,r=t.attributes,a=this._properties,s=this._capabilities,o=a.get(e);for(var h in o._maxInstancedCount=1/0,r){var c=r[h],u=e.getAttribute(h);if(u){var l,d=u.normalized,p=u.size;c.count!==p&&console.warn("WebGLVertexArrayBindings: attribute "+h+" size not match! "+c.count+" : "+p);var f=(l=u.isInterleavedBufferAttribute?a.get(u.data):a.get(u)).buffer,_=l.type;c.format;var v=l.bytesPerElement;if(u.isInterleavedBufferAttribute){var m=u.data,g=m.stride,M=u.offset;n.enableVertexAttribArray(c.location),m&&m.isInstancedInterleavedBuffer&&(i?n.vertexAttribDivisor(c.location,m.meshPerAttribute):s.getExtension("ANGLE_instanced_arrays")?s.getExtension("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(c.location,m.meshPerAttribute):console.warn("vertexAttribDivisor not supported"),o._maxInstancedCount=Math.min(o._maxInstancedCount,m.meshPerAttribute*m.count)),n.bindBuffer(n.ARRAY_BUFFER,f),n.vertexAttribPointer(c.location,c.count,_,d,v*g,v*M)}else n.enableVertexAttribArray(c.location),u.isInstancedBufferAttribute&&(i?n.vertexAttribDivisor(c.location,u.meshPerAttribute):s.getExtension("ANGLE_instanced_arrays")?s.getExtension("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(c.location,u.meshPerAttribute):console.warn("vertexAttribDivisor not supported"),o._maxInstancedCount=Math.min(o._maxInstancedCount,u.meshPerAttribute*u.count)),n.bindBuffer(n.ARRAY_BUFFER,f),n.vertexAttribPointer(c.location,c.count,_,d,0,0)}}if(e.index){var E=a.get(e.index);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,E.buffer)}},t}(),wn=new D,bn=new et,An=new WeakMap,Nn=new Float32Array(8);function Cn(t){return t.material}function Rn(t){return!0}function Pn(){}var Ln=new dt;function On(t,e){(!yn||yn.length<4*t.length)&&(yn=new Float32Array(4*t.length));for(var n=0;n<t.length;n++)Ln.copy(t[n]),yn[4*n+0]=Ln.normal.x,yn[4*n+1]=Ln.normal.y,yn[4*n+2]=Ln.normal.z,yn[4*n+3]=Ln.constant;return yn}function Fn(t){this.gl=t;var e=new Pe;this.properties=e;var n=new we(t);this.capabilities=n;var i=new Re(t,n);this.state=i;var r=new Tn(t,e,n);this.vertexArrayBindings=r;var a=new Ie(t,i,e,n);this.texture=a;var s=new Sn(t,e,n);this.renderTarget=new xn(t,i,a,s,e,n),this.geometry=new Ge(t,i,r,e,n),this.programs=new En(t,i,n),this._usedTextureUnits=0}Object.assign(Fn.prototype,{clear:function(t,e,n){var i=this.gl,r=0;(void 0===t||t)&&(r|=i.COLOR_BUFFER_BIT),(void 0===e||e)&&(r|=i.DEPTH_BUFFER_BIT),(void 0===n||n)&&(r|=i.STENCIL_BUFFER_BIT),i.clear(r)},render:function(t,e,n){var i;i=(n=void 0===n||n)?t.updateRenderList(e):t.getRenderList(e),this.renderPass(i.opaque,e,{scene:t,getMaterial:function(e){return t.overrideMaterial||e.material}}),this.renderPass(i.transparent,e,{scene:t,getMaterial:function(e){return t.overrideMaterial||e.material}})},renderPass:function(t,e,n){n=n||{};for(var i=this.state,r=this.capabilities,a=n.getMaterial||Cn,s=n.beforeRender||Pn,o=n.afterRender||Pn,c=n.ifRender||Rn,u=n.scene||{},l=i.currentRenderTarget,d=0,p=t.length;d<p;d++){var f=t[d];if(c(f)){var _=f.object,v=a.call(this,f),m=f.geometry,g=f.group;_.onBeforeRender(f,v),s.call(this,f,v);var M=this.properties.get(v);if(!1===v.needsUpdate)if(void 0===M.program)v.needsUpdate=!0;else if(M.fog!==u.fog)v.needsUpdate=!0;else if(u.clippingPlanes&&u.clippingPlanes.length!==M.numClippingPlanes)v.needsUpdate=!0;else if(e.outputEncoding!==M.outputEncoding||e.gammaFactor!==M.gammaFactor)v.needsUpdate=!0;else if(r.version>1&&u.disableShadowSampler!==M.disableShadowSampler)v.needsUpdate=!0;else{var E=v.acceptLight&&!!u.lights&&u.lights.totalNum>0;E!==M.acceptLight?v.needsUpdate=!0:E&&(u.lights.hash.compare(M.lightsHash)&&_.receiveShadow===M.receiveShadow&&_.shadowType===M.shadowType||(v.needsUpdate=!0))}if(v.needsUpdate){void 0===M.program&&v.addEventListener("dispose",this.onMaterialDispose,this);var S=M.program;M.program=this.programs.getProgram(e,v,_,u),S&&this.programs.releaseProgram(S),M.fog=u.fog,u.lights?(M.acceptLight=v.acceptLight,M.lightsHash=u.lights.hash.copyTo(M.lightsHash),M.receiveShadow=_.receiveShadow,M.shadowType=_.shadowType):M.acceptLight=!1,M.numClippingPlanes=u.clippingPlanes?u.clippingPlanes.length:0,M.outputEncoding=e.outputEncoding,M.gammaFactor=e.gammaFactor,M.disableShadowSampler=u.disableShadowSampler,v.needsUpdate=!1}var x=M.program;i.setProgram(x),this.geometry.setGeometry(m),_.morphTargetInfluences&&this.updateMorphtargets(_,m,x),this.vertexArrayBindings.setup(_,m,x);var y=x.uniforms;v.acceptLight&&u.lights&&this.uploadLights(y,u.lights,u.disableShadowSampler),_.type===h.SKINNED_MESH&&this.uploadSkeleton(y,_,x.program);for(var T=0,w=y.seq.length;T<w;T++){var b=y.seq[T],A=b.id;if(v.uniforms&&void 0!==v.uniforms[A])b.set(v.uniforms[A],this);else switch(A){case"u_Projection":b.set(e.projectionMatrix.elements);break;case"u_View":b.set(e.viewMatrix.elements);break;case"u_Model":var N=_.worldMatrix.elements;b.set(N);break;case"u_Color":var C=v.diffuse;b.setValue(C.r,C.g,C.b);break;case"u_Opacity":b.set(v.opacity);break;case"diffuseMap":b.set(v.diffuseMap,this);break;case"alphaMap":b.set(v.alphaMap,this);break;case"normalMap":b.set(v.normalMap,this);break;case"bumpMap":b.set(v.bumpMap,this);break;case"bumpScale":b.set(v.bumpScale);break;case"envMap":b.set(v.envMap,this);break;case"cubeMap":b.set(v.cubeMap,this);break;case"u_EnvMap_Intensity":b.set(v.envMapIntensity);break;case"maxMipLevel":b.set(this.properties.get(v.envMap).__maxMipLevel||0);break;case"u_Specular":b.set(v.shininess);break;case"u_SpecularColor":C=v.specular;b.setValue(C.r,C.g,C.b);break;case"specularMap":b.set(v.specularMap,this);break;case"aoMap":b.set(v.aoMap,this);break;case"aoMapIntensity":b.set(v.aoMapIntensity);break;case"u_Roughness":b.set(v.roughness);break;case"roughnessMap":b.set(v.roughnessMap,this);break;case"u_Metalness":b.set(v.metalness);break;case"metalnessMap":b.set(v.metalnessMap,this);break;case"glossiness":b.set(v.glossiness);break;case"glossinessMap":b.set(v.glossinessMap,this);break;case"emissive":C=v.emissive;var R=v.emissiveIntensity;b.setValue(C.r*R,C.g*R,C.b*R);break;case"emissiveMap":b.set(v.emissiveMap,this);break;case"u_CameraPosition":wn.setFromMatrixPosition(e.worldMatrix),b.setValue(wn.x,wn.y,wn.z);break;case"u_FogColor":C=u.fog.color;b.setValue(C.r,C.g,C.b);break;case"u_FogDensity":b.set(u.fog.density);break;case"u_FogNear":b.set(u.fog.near);break;case"u_FogFar":b.set(u.fog.far);break;case"u_PointSize":b.set(v.size);break;case"u_PointScale":var P=.5*l.height;b.set(P);break;case"dashSize":b.set(v.dashSize);break;case"totalSize":b.set(v.dashSize+v.gapSize);break;case"scale":b.set(v.scale);break;case"matcap":b.set(v.matcap,this);break;case"clippingPlanes":var L=On(u.clippingPlanes||[]);b.set(L);break;case"uvTransform":var O;(O=v.diffuseMap||v.specularMap||v.normalMap||v.bumpMap||v.roughnessMap||v.metalnessMap||v.emissiveMap)&&(O.matrixAutoUpdate&&O.updateMatrix(),b.set(O.matrix.elements));break;case"alphaMapUVTransform":v.alphaMap.updateMatrix(),b.set(v.alphaMap.matrix.elements)}}var F=_.worldMatrix.determinant()<0;this.setStates(v,F);var U=bn.set(l.width,l.height,l.width,l.height).multiply(e.rect);U.z-=U.x,U.w-=U.y,U.x=Math.floor(U.x),U.y=Math.floor(U.y),U.z=Math.floor(U.z),U.w=Math.floor(U.w),i.viewport(U.x,U.y,U.z,U.w),this.draw(m,v,g),this.vertexArrayBindings.resetBinding(),this._usedTextureUnits=0,i.depthBuffer.setTest(!0),i.depthBuffer.setMask(!0),i.colorBuffer.setMask(!0),o(this,f),_.onAfterRender(f)}}},setStates:function(t,e){var n=this.state;n.setCullFace(t.side===v.DOUBLE?_.NONE:_.BACK);var i=t.side===v.BACK;e&&(i=!i),n.setFlipSided(i),t.transparent?n.setBlend(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha):n.setBlend(d.NONE),n.depthBuffer.setFunc(t.depthFunc),n.depthBuffer.setTest(t.depthTest),n.depthBuffer.setMask(t.depthWrite),n.colorBuffer.setMask(t.colorWrite);var r=t.stencilTest;n.stencilBuffer.setTest(r),r&&(n.stencilBuffer.setMask(t.stencilWriteMask),n.stencilBuffer.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask,t.stencilFuncBack,t.stencilRefBack,t.stencilFuncMaskBack),n.stencilBuffer.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass,t.stencilFailBack,t.stencilZFailBack,t.stencilZPassBack)),n.setPolygonOffset(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),void 0!==t.lineWidth&&n.setLineWidth(t.lineWidth)},draw:function(t,e,n){var i=this.gl,r=this.properties,a=this.capabilities,s=null!==t.index,o=0,h=s?t.index.count:t.getAttribute("a_Position").count,c=n?n.start:0,u=n?n.count:1/0;if(o=Math.max(o,c),h=Math.min(h,u),s){var l=r.get(t.index),d=l.bytesPerElement,p=l.type;if(p===i.UNSIGNED_INT&&a.version<2&&!a.getExtension("OES_element_index_uint")&&console.warn("draw elements type not support UNSIGNED_INT!"),t.isInstancedGeometry)(f=Math.min(r.get(t)._maxInstancedCount,t.instanceCount))>0&&(a.version>=2?i.drawElementsInstanced(e.drawMode,h,p,o*d,f):a.getExtension("ANGLE_instanced_arrays")?a.getExtension("ANGLE_instanced_arrays").drawElementsInstancedANGLE(e.drawMode,h,p,o*d,f):console.warn("no support instanced draw."));else i.drawElements(e.drawMode,h,p,o*d)}else{var f;if(t.isInstancedGeometry)(f=Math.min(r.get(t)._maxInstancedCount,t.instanceCount))>0&&(a.version>=2?i.drawArraysInstanced(e.drawMode,o,h,f):a.getExtension("ANGLE_instanced_arrays")?a.getExtension("ANGLE_instanced_arrays").drawArraysInstancedANGLE(e.drawMode,o,h,f):console.warn("no support instanced draw."));else i.drawArrays(e.drawMode,o,h)}},uploadSkeleton:function(t,e,n){if(e.skeleton&&e.skeleton.bones.length>0){var i=e.skeleton,r=this.capabilities;if(i.updateBones(),r.maxVertexTextures>0&&(r.getExtension("OES_texture_float")||r.version>=2)){if(void 0===i.boneTexture){var a=Math.sqrt(4*i.bones.length);a=s(Math.ceil(a)),a=Math.max(4,a);var o=new Float32Array(a*a*4);o.set(i.boneMatrices);var h=new Rt;h.image={data:o,width:a,height:a},r.version>=2&&(h.internalformat=M.RGBA32F,h.format=M.RGBA),h.type=E.FLOAT,h.magFilter=S.NEAREST,h.minFilter=S.NEAREST,h.generateMipmaps=!1,h.flipY=!1,i.boneMatrices=o,i.boneTexture=h}t.set("boneTexture",i.boneTexture,this),t.set("boneTextureSize",i.boneTexture.image.width)}else t.set("boneMatrices",i.boneMatrices);t.set("bindMatrix",e.bindMatrix.elements),t.set("bindMatrixInverse",e.bindMatrixInverse.elements)}},uploadLights:function(t,e,n){e.ambientsNum>0&&t.set("u_AmbientLightColor",e.ambient),e.directsNum>0&&(t.set("u_Directional",e.directional),t.has("directionalShadowMap")&&(this.capabilities.version>=2&&!n?t.set("directionalShadowMap",e.directionalShadowDepthMap,this):t.set("directionalShadowMap",e.directionalShadowMap,this),t.set("directionalShadowMatrix",e.directionalShadowMatrix)),t.has("directionalDepthMap")&&t.set("directionalDepthMap",e.directionalShadowMap,this)),e.pointsNum>0&&(t.set("u_Point",e.point),t.has("pointShadowMap")&&t.set("pointShadowMap",e.pointShadowMap,this)),e.spotsNum>0&&(t.set("u_Spot",e.spot),t.has("spotShadowMap")&&(this.capabilities.version>=2&&!n?t.set("spotShadowMap",e.spotShadowDepthMap,this):t.set("spotShadowMap",e.spotShadowMap,this),t.set("spotShadowMatrix",e.spotShadowMatrix)),t.has("spotDepthMap")&&t.set("spotDepthMap",e.spotShadowMap,this))},allocTexUnit:function(){var t=this._usedTextureUnits;return t>=this.capabilities.maxTextures&&console.warn("trying to use "+t+" texture units while this GPU supports only "+this.capabilities.maxTextures),this._usedTextureUnits+=1,t},updateMorphtargets:function(t,e,n){var i=t.morphTargetInfluences;An.has(e)||An.set(e,i.slice(0));for(var r=e.morphAttributes.position,a=e.morphAttributes.normal,s=An.get(e),o=0;o<s.length;o++){0!==(c=s[o])&&(r&&e.removeAttribute("morphTarget"+o),a&&e.removeAttribute("morphNormal"+o))}for(o=0;o<i.length;o++)s[o]=i[o];s.length=i.length;var h=0;for(o=0;o<s.length;o++){var c;(c=s[o])>0&&(r&&e.addAttribute("morphTarget"+h,r[o]),a&&e.addAttribute("morphNormal"+h,a[o]),Nn[h]=c,h++)}for(;h<8;h++)Nn[h]=0;n.uniforms.set("morphTargetInfluences",Nn)},onMaterialDispose:function(t){var e=t.target,n=this.properties.get(e);e.removeEventListener("dispose",this.onMaterialDispose,this);var i=n.program;void 0!==i&&this.programs.releaseProgram(i),this.properties.delete(e)}});var Un=new Q;function Dn(){Ut.call(this),this.type=h.CAMERA,this.viewMatrix=new Q,this.projectionMatrix=new Q,this.projectionMatrixInverse=new Q,this.frustum=new ft,this.gammaFactor=2,this.outputEncoding=N.LINEAR,this.rect=new et(0,0,1,1),this.frustumCulled=!0}function In(t,e){F.call(this),this.width=t,this.height=e}function Bn(t,e,n,i){F.call(this),this.width=t,this.height=e,this.format=void 0!==n?n:M.RGBA8,this.multipleSampling=void 0!==i?i:0}function zn(t,e){In.call(this,t,e),this._attachments={},this.attach(new Pt,L.COLOR_ATTACHMENT0),this.attach(new Bn(t,e,M.DEPTH_STENCIL),L.DEPTH_STENCIL_ATTACHMENT),this.activeCubeFace=0}function Gn(t){this.camera=new Dn,this.targets=[new D(1,0,0),new D(-1,0,0),new D(0,1,0),new D(0,-1,0),new D(0,0,1),new D(0,0,-1)],this.ups=[new D(0,-1,0),new D(0,-1,0),new D(0,0,1),new D(0,0,-1),new D(0,-1,0),new D(0,-1,0)],this.camera.setPerspective(.5*Math.PI,1,1,1e3),this.position=new D,this.lookTarget=new D,this.renderTarget=t||new zn(512,512),this.renderTexture=this.renderTarget.texture,this.renderTexture.minFilter=S.LINEAR_MIPMAP_LINEAR}Dn.prototype=Object.assign(Object.create(Ut.prototype),{constructor:Dn,lookAt:function(t,e){Un.lookAtRH(this.position,t,e),this.quaternion.setFromRotationMatrix(Un)},setOrtho:function(t,e,n,i,r,a){this.projectionMatrix.set(2/(e-t),0,0,-(e+t)/(e-t),0,2/(i-n),0,-(i+n)/(i-n),0,0,-2/(a-r),-(a+r)/(a-r),0,0,0,1),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},setPerspective:function(t,e,n,i){this.projectionMatrix.set(1/(e*Math.tan(t/2)),0,0,0,0,1/Math.tan(t/2),0,0,0,0,-(i+n)/(i-n),-2*i*n/(i-n),0,0,-1,0),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},getWorldDirection:function(t){t=t||new D;var e=this.worldMatrix.elements;return t.set(-e[8],-e[9],-e[10]).normalize()},updateMatrix:function(t){Ut.prototype.updateMatrix.call(this,t),this.viewMatrix.getInverse(this.worldMatrix),Un.multiplyMatrices(this.projectionMatrix,this.viewMatrix),this.frustum.setFromMatrix(Un)},copy:function(t,e){return Ut.prototype.copy.call(this,t,e),this.viewMatrix.copy(t.viewMatrix),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.frustum.copy(t.frustum),this.gammaFactor=t.gammaFactor,this.outputEncoding=t.outputEncoding,this.rect.copy(t.rect),this.frustumCulled=t.frustumCulled,this}}),In.prototype=Object.assign(Object.create(F.prototype),{constructor:In,isRenderTarget:!0,resize:function(t,e){return(this.width!==t||this.height!==e)&&(this.dispose(),this.width=t,this.height=e,!0)},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Bn.prototype=Object.assign(Object.create(F.prototype),{constructor:Bn,isRenderBuffer:!0,resize:function(t,e){return(this.width!==t||this.height!==e)&&(this.dispose(),this.width=t,this.height=e,!0)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.format=t.format,this.multipleSampling=t.multipleSampling,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),zn.prototype=Object.create(In.prototype),zn.prototype.constructor=zn,zn.prototype=Object.assign(Object.create(In.prototype),{constructor:zn,attach:function(t,e){if(t.isTexture){for(var n=!1,i=0;i<6;i++)t.images[i]&&t.images[i].rtt?t.images[i].width===this.width&&t.images[i].height===this.height||(t.images[i].width=this.width,t.images[i].height=this.height,n=!0):(t.images[i]={rtt:!0,data:null,width:this.width,height:this.height},n=!0);n&&t.version++}else t.resize(this.width,this.height);this._attachments[e||L.COLOR_ATTACHMENT0]=t},detach:function(t){delete this._attachments[t||L.COLOR_ATTACHMENT0]},resize:function(t,e){if(In.prototype.resize.call(this,t,e))for(var n in this._attachments){var i=this._attachments[n];if(i.isTexture){for(var r=0;r<6;r++)i.images[r]={rtt:!0,data:null,width:this.width,height:this.height};i.version++}else i.resize(t,e)}}}),Object.defineProperties(zn.prototype,{texture:{set:function(t){t?t.isTexture&&this.attach(t,L.COLOR_ATTACHMENT0):this.detach(L.COLOR_ATTACHMENT0)},get:function(){var t=this._attachments[L.COLOR_ATTACHMENT0];return t.isTexture?t:null}}}),Gn.prototype.render=function(t,e){this.camera.position.copy(this.position);for(var n=0;n<6;n++)this.lookTarget.set(this.targets[n].x+this.camera.position.x,this.targets[n].y+this.camera.position.y,this.targets[n].z+this.camera.position.z),this.camera.lookAt(this.lookTarget,this.ups[n]),this.camera.updateMatrix(),this.renderTarget.activeCubeFace=n,t.renderTarget.setRenderTarget(this.renderTarget),t.clear(!0,!0,!0),t.render(e,this.camera),t.renderTarget.updateRenderTargetMipmap(this.renderTarget)};var Hn={front:v.BACK,back:v.FRONT,double:v.DOUBLE},kn=new ye;kn.packToRGBA=!0;var Vn=new Te;function jn(t,e){return kn.side=Hn[t.material.side],kn}function Wn(t,e){return Vn.side=Hn[t.material.side],Vn.uniforms.nearDistance=e.shadow.cameraNear,Vn.uniforms.farDistance=e.shadow.cameraFar,Vn}Vn.uniforms={};var Xn=new et;function Yn(){this.getDepthMaterial=jn,this.getDistanceMaterial=Wn}Yn.prototype.render=function(t,e){var n=t.gl,i=t.state,r=this.getDepthMaterial,a=this.getDistanceMaterial,s=i.states[n.STENCIL_TEST];s&&i.stencilBuffer.setTest(!1),Xn.copy(i.colorBuffer.getClear()),i.colorBuffer.setClear(1,1,1,1);for(var o=e.lights.shadows,h=0;h<o.length;h++){var u=o[h],l=u.shadow;if(!1!==l.autoUpdate||!1!==l.needsUpdate){var d=l.camera,p=l.renderTarget,f=u.lightType==c.POINT,_=f?6:1;t.capabilities.version>=2&&(f||l.depthMap||t.disableShadowSampler||l._initDepthMap());for(var v=0;v<_;v++){f?(l.update(u,v),p.activeCubeFace=v):l.update(u);var m=e.updateRenderList(d);t.renderTarget.setRenderTarget(p),t.clear(!0,!0),t.renderPass(m.opaque,d,{getMaterial:function(t){return f?a(t,u):r(t,u)},ifRender:function(t){return t.object.castShadow}})}l.needsUpdate=!1}}s&&i.stencilBuffer.setTest(!0),i.colorBuffer.setClear(Xn.x,Xn.y,Xn.z,Xn.w)};var qn=new D,Zn=new WeakMap;function Kn(t){if(Zn.has(t))return Zn.get(t);var e;switch(t.lightType){case c.DIRECT:e={direction:new Float32Array(3),color:new Float32Array([0,0,0,1]),shadow:0,shadowBias:0,shadowRadius:1,shadowMapSize:new Float32Array(2)};break;case c.POINT:e={position:new Float32Array(3),color:new Float32Array([0,0,0,1]),distance:0,decay:0,shadow:0,shadowBias:0,shadowRadius:1,shadowMapSize:new Float32Array(2),shadowCameraNear:1,shadowCameraFar:1e3};break;case c.SPOT:e={position:new Float32Array(3),direction:new Float32Array(3),color:new Float32Array([0,0,0,1]),distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:0,shadowBias:0,shadowRadius:1,shadowMapSize:new Float32Array(2)}}return Zn.set(t,e),e}function Qn(){this._factor=new Uint16Array(4)}function $n(){this.ambient=new Float32Array([0,0,0]),this.directional=[],this.directionalShadowMap=[],this.directionalShadowDepthMap=[],this.directionalShadowMatrix=[],this.point=[],this.pointShadowMap=[],this.pointShadowMatrix=[],this.spot=[],this.spotShadowMap=[],this.spotShadowDepthMap=[],this.spotShadowMatrix=[],this.shadows=[],this.ambientsNum=0,this.directsNum=0,this.pointsNum=0,this.spotsNum=0,this.directShadowNum=0,this.pointShadowNum=0,this.spotShadowNum=0,this.shadowsNum=0,this.totalNum=0,this.hash=new Qn}Object.assign(Qn.prototype,{update:function(t){this._factor[0]=t.ambientsNum,this._factor[1]=t.directsNum,this._factor[2]=t.pointsNum,this._factor[3]=t.spotsNum},compare:function(t){return!!t&&!(this._factor[0]!==t[0]||this._factor[1]!==t[1]||this._factor[2]!==t[2]||this._factor[3]!==t[3])},copyTo:function(t){return t||(t=new Uint16Array(4)),t.set(this._factor),t}}),Object.assign($n.prototype,{startCount:function(){for(var t=0;t<3;t++)this.ambient[t]=0;this.shadows.length=0,this.ambientsNum=0,this.directsNum=0,this.pointsNum=0,this.spotsNum=0,this.directShadowNum=0,this.pointShadowNum=0,this.spotShadowNum=0,this.shadowsNum=0,this.totalNum=0},add:function(t){t.lightType==c.AMBIENT?this._doAddAmbientLight(t):t.lightType==c.DIRECT?this._doAddDirectLight(t):t.lightType==c.POINT?this._doAddPointLight(t):t.lightType==c.SPOT&&this._doAddSpotLight(t),t.castShadow&&t.lightType!==c.AMBIENT&&(this.shadows.push(t),this.shadowsNum++),this.totalNum++},endCount:function(){this.hash.update(this)},_doAddAmbientLight:function(t){var e=t.intensity,n=t.color;this.ambient[0]+=n.r*e,this.ambient[1]+=n.g*e,this.ambient[2]+=n.b*e,this.ambientsNum++},_doAddDirectLight:function(t){var e=t.intensity,n=t.color,i=Kn(t);i.color[0]=n.r*e,i.color[1]=n.g*e,i.color[2]=n.b*e;var r=qn;if(t.getWorldDirection(r),i.direction[0]=r.x,i.direction[1]=r.y,i.direction[2]=r.z,t.castShadow?(i.shadow=1,i.shadowBias=t.shadow.bias,i.shadowRadius=t.shadow.radius,i.shadowMapSize[0]=t.shadow.mapSize.x,i.shadowMapSize[1]=t.shadow.mapSize.y,this.directShadowNum++):i.shadow=0,t.castShadow){var a=16*(this.directsNum+1);if(this.directionalShadowMatrix.length<a){var s=this.directionalShadowMatrix;this.directionalShadowMatrix=new Float32Array(a),this.directionalShadowMatrix.set(s)}this.directionalShadowMatrix.set(t.shadow.matrix.elements,16*this.directsNum),this.directionalShadowMap[this.directsNum]=t.shadow.map,this.directionalShadowDepthMap[this.directsNum]=t.shadow.depthMap}this.directional[this.directsNum]=i,this.directsNum++},_doAddPointLight:function(t){var e=t.intensity,n=t.color,i=t.distance,r=t.decay,a=Kn(t);a.color[0]=n.r*e,a.color[1]=n.g*e,a.color[2]=n.b*e,a.distance=i,a.decay=r;var s=qn.setFromMatrixPosition(t.worldMatrix);if(a.position[0]=s.x,a.position[1]=s.y,a.position[2]=s.z,t.castShadow?(a.shadow=1,a.shadowBias=t.shadow.bias,a.shadowRadius=t.shadow.radius,a.shadowMapSize[0]=t.shadow.mapSize.x,a.shadowMapSize[1]=t.shadow.mapSize.y,a.shadowCameraNear=t.shadow.cameraNear,a.shadowCameraFar=t.shadow.cameraFar,this.pointShadowNum++):a.shadow=0,t.castShadow){var o=16*(this.pointsNum+1);if(this.pointShadowMatrix.length<o){var h=this.pointShadowMatrix;this.pointShadowMatrix=new Float32Array(o),this.pointShadowMatrix.set(h)}this.pointShadowMatrix.set(t.shadow.matrix.elements,16*this.pointsNum),this.pointShadowMap[this.pointsNum]=t.shadow.map}this.point[this.pointsNum]=a,this.pointsNum++},_doAddSpotLight:function(t){var e=t.intensity,n=t.color,i=t.distance,r=t.decay,a=Kn(t);a.color[0]=n.r*e,a.color[1]=n.g*e,a.color[2]=n.b*e,a.distance=i,a.decay=r;var s=qn.setFromMatrixPosition(t.worldMatrix);a.position[0]=s.x,a.position[1]=s.y,a.position[2]=s.z;var o=qn;t.getWorldDirection(qn),a.direction[0]=o.x,a.direction[1]=o.y,a.direction[2]=o.z;var h=Math.cos(t.angle),c=Math.cos(t.angle*(1-t.penumbra));if(a.coneCos=h,a.penumbraCos=c,t.castShadow?(a.shadow=1,a.shadowBias=t.shadow.bias,a.shadowRadius=t.shadow.radius,a.shadowMapSize[0]=t.shadow.mapSize.x,a.shadowMapSize[1]=t.shadow.mapSize.y,this.spotShadowNum++):a.shadow=0,t.castShadow){var u=16*(this.spotsNum+1);if(this.spotShadowMatrix.length<u){var l=this.spotShadowMatrix;this.spotShadowMatrix=new Float32Array(u),this.spotShadowMatrix.set(l)}this.spotShadowMatrix.set(t.shadow.matrix.elements,16*this.spotsNum),this.spotShadowMap[this.spotsNum]=t.shadow.map,this.spotShadowDepthMap[this.spotsNum]=t.shadow.depthMap}this.spot[this.spotsNum]=a,this.spotsNum++}});var Jn=new D,ti=new ct,ei=function(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id},ni=function(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.material.id!==e.material.id?t.material.id-e.material.id:t.id-e.id};function ii(){var t=[],e=0,n=[],i=0,r=[],a=0;function s(s,o,h,c,u){var l=t[e];void 0===l?(l={object:s,geometry:o,material:h,z:c,renderOrder:s.renderOrder,group:u},t[e]=l):(l.object=s,l.geometry=o,l.material=h,l.z=c,l.renderOrder=s.renderOrder,l.group=u),h.transparent?(r[a]=l,a++):(n[i]=l,i++),e++}return{opaque:n,transparent:r,startCount:function(){e=0,i=0,a=0},add:function(t,e){if(t.frustumCulled&&e.frustumCulled&&(ti.copy(t.geometry.boundingSphere).applyMatrix4(t.worldMatrix),!e.frustum.intersectsSphere(ti)))return;if(Jn.setFromMatrixPosition(t.worldMatrix),Jn.project(e),Array.isArray(t.material))for(var n=t.geometry.groups,i=0;i<n.length;i++){var r=n[i],a=t.material[r.materialIndex];a&&s(t,t.geometry,a,Jn.z,r)}else s(t,t.geometry,t.material,Jn.z)},endCount:function(){n.length=i,r.length=a},sort:function(){n.sort(ei),r.sort(ni)}}}function ri(){Ut.call(this),this.type=h.SCENE,this.overrideMaterial=null,this.fog=null,this.clippingPlanes=[],this.disableShadowSampler=!1,this.lights=new $n,this._renderListMap=new WeakMap}ri.prototype=Object.assign(Object.create(Ut.prototype),{constructor:ri,updateRenderList:function(t){this._renderListMap.has(t)||this._renderListMap.set(t,new ii);var e=this._renderListMap.get(t);return e.startCount(),this._doUpdateRenderList(this,t,e),e.endCount(),e.sort(),e},getRenderList:function(t){return this._renderListMap.get(t)},updateLights:function(){var t=this.lights;return t.startCount(),this._doUpdateLights(this),t.endCount(),t},_doUpdateRenderList:function(t,e,n){if(t.visible){t.geometry&&t.material&&n.add(t,e);for(var i=t.children,r=0,a=i.length;r<a;r++)this._doUpdateRenderList(i[r],e,n)}},_doUpdateLights:function(t){if(t.visible){h.LIGHT===t.type&&this.lights.add(t);for(var e=t.children,n=0,i=e.length;n<i;n++)this._doUpdateLights(e[n])}}});var ai=new ct,si=new st,oi=new Q,hi=new k,ci=new D,ui=new D,li=new D,di=new D,pi=new tt,fi=new tt,_i=new tt,vi=new D,mi=new D;function gi(t,e){Ut.call(this),this.geometry=t,this.material=e,this.morphTargetInfluences=null,this.type=h.MESH}function Mi(t,e,n,i,r,a,s){return St.barycoordFromPoint(t,e,n,i,ci),r.multiplyScalar(ci.x),a.multiplyScalar(ci.y),s.multiplyScalar(ci.z),r.add(a).add(s),r.clone()}function Ei(t,e,n,i,r,a,s){var o=t.material;if(null===(o.side===v.BACK?n.intersectTriangle(a,r,i,!0,s):n.intersectTriangle(i,r,a,o.side!==v.DOUBLE,s)))return null;mi.copy(s),mi.applyMatrix4(t.worldMatrix);var h=e.ray.origin.distanceTo(mi);return h<e.near||h>e.far?null:{distance:h,point:mi.clone(),object:t}}function Si(t){var e=new ri,n=this.camera=new Dn;n.frustumCulled=!1,n.position.set(0,1,0),n.lookAt(new D(0,0,0),new D(0,0,-1)),n.setOrtho(-1,1,-1,1,.1,2),e.add(n);var i=new ce(2,2,1,1),r=this.material=new xe(t);this.uniforms=r.uniforms;var a=new gi(i,r);a.frustumCulled=!1,e.add(a),e.updateMatrix(),this.renderList=e.updateRenderList(n),this.renderConfig={}}function xi(t){In.call(this,t.width,t.height),this.view=t}function yi(t,e){var n={antialias:!0,alpha:!1,stencil:!0},i=t.getContext("webgl2",e||n)||t.getContext("webgl",e||n);this.glCore=new Fn(i),console.info("ForwardRenderer use WebGL Version: "+this.glCore.capabilities.version),this.backRenderTarget=new xi(t),this.shadowMapPass=new Yn,this.shadowAutoUpdate=!0,this.shadowNeedsUpdate=!1,this.matrixAutoUpdate=!0,this.lightsAutoUpdate=!0,this.autoClear=!0}function Ti(t,e){In.call(this,t,e),this._attachments={},this.attach(new Rt,L.COLOR_ATTACHMENT0),this.attach(new Bn(t,e,M.DEPTH_STENCIL),L.DEPTH_STENCIL_ATTACHMENT)}function wi(){Ut.call(this),this.type=h.GROUP}function bi(t,e){Ut.call(this),this.type=h.LIGHT,this.lightType="",this.color=new _t(void 0!==t?t:16777215),this.intensity=void 0!==e?e:1}function Ai(t,e){bi.call(this,t,e),this.lightType=c.AMBIENT}function Ni(){this.camera=new Dn,this.matrix=new Q,this.bias=0,this.radius=2,this.cameraNear=1,this.cameraFar=500,this.mapSize=new tt(512,512),this.autoUpdate=!0,this.needsUpdate=!1,this.renderTarget=null,this.map=null}function Ci(){Ni.call(this),this.camera.frustumCulled=!1,this.renderTarget=new Ti(this.mapSize.x,this.mapSize.y);var t=this.renderTarget.texture;t.generateMipmaps=!1,t.minFilter=S.LINEAR,this.map=t,this.depthMap=null,this.windowSize=500,this._lookTarget=new D,this._up=new D(0,1,0)}function Ri(t,e){bi.call(this,t,e),this.lightType=c.DIRECT,this.shadow=new Ci}function Pi(){Ni.call(this),this.renderTarget=new zn(this.mapSize.x,this.mapSize.y);var t=this.renderTarget.texture;t.generateMipmaps=!1,t.minFilter=S.LINEAR,this.map=t,this._targets=[new D(1,0,0),new D(-1,0,0),new D(0,1,0),new D(0,-1,0),new D(0,0,1),new D(0,0,-1)],this._ups=[new D(0,-1,0),new D(0,-1,0),new D(0,0,1),new D(0,0,-1),new D(0,-1,0),new D(0,-1,0)],this._lookTarget=new D}function Li(t,e,n,i){bi.call(this,t,e),this.lightType=c.POINT,this.decay=void 0!==i?i:1,this.distance=void 0!==n?n:200,this.shadow=new Pi}function Oi(){Ni.call(this),this.renderTarget=new Ti(this.mapSize.x,this.mapSize.y);var t=this.renderTarget.texture;t.generateMipmaps=!1,t.minFilter=S.LINEAR,this.map=t,this.depthMap=null,this._lookTarget=new D,this._up=new D(0,1,0)}function Fi(t,e,n,i,r,a){bi.call(this,t,e),this.lightType=c.SPOT,this.decay=void 0!==a?a:1,this.distance=void 0!==n?n:200,this.penumbra=void 0!==r?r:0,this.angle=void 0!==i?i:Math.PI/6,this.shadow=new Oi}function Ui(t,e){gi.call(this,t,e),this.type=h.SKINNED_MESH,this.skeleton=void 0,this.bindMode="attached",this.bindMatrix=new Q,this.bindMatrixInverse=new Q}gi.prototype=Object.assign(Object.create(Ut.prototype),{constructor:gi,raycast:function(t,e){var n=this.geometry,i=this.worldMatrix;if(ai.copy(n.boundingSphere),ai.applyMatrix4(i),t.ray.intersectsSphere(ai)&&(si.copy(n.boundingBox),si.applyMatrix4(i),t.ray.intersectsBox(si))){oi.getInverse(i),hi.copy(t.ray).applyMatrix4(oi);for(var r,a,s,o=n.index.array,h=n.getAttribute("a_Position"),c=n.getAttribute("a_Uv"),u=0;u<o.length;u+=3){r=o[u],a=o[u+1],s=o[u+2],ui.fromArray(h.array,3*r),li.fromArray(h.array,3*a),di.fromArray(h.array,3*s);var l=Ei(this,t,hi,ui,li,di,vi);l&&(pi.fromArray(c.array,2*r),fi.fromArray(c.array,2*a),_i.fromArray(c.array,2*s),l.uv=Mi(vi,ui,li,di,pi,fi,_i),l.face=[r,a,s],l.faceIndex=r,e.push(l))}}},copy:function(t){return Ut.prototype.copy.call(this,t),t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),this},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Si.prototype.render=function(t){t.renderPass(this.renderList.opaque,this.camera,this.renderConfig)},xi.prototype=Object.assign(Object.create(In.prototype),{constructor:xi,resize:function(t,e){this.view.width=t,this.view.height=e,this.width=t,this.height=e},dispose:function(){}}),yi.prototype.render=function(t,e,n,i){this.matrixAutoUpdate&&t.updateMatrix(),this.lightsAutoUpdate&&t.updateLights(),(this.shadowAutoUpdate||this.shadowNeedsUpdate)&&(this.shadowMapPass.render(this.glCore,t),this.shadowNeedsUpdate=!1),void 0===n&&(n=this.backRenderTarget),this.glCore.renderTarget.setRenderTarget(n),(this.autoClear||i)&&this.glCore.clear(!0,!0,!0),this.glCore.render(t,e),n.texture&&this.glCore.renderTarget.updateRenderTargetMipmap(n)},Ti.prototype=Object.assign(Object.create(In.prototype),{constructor:Ti,attach:function(t,e){t.isTexture?t.image&&t.image.rtt?t.image.width===this.width&&t.image.height===this.height||(t.version++,t.image.width=this.width,t.image.height=this.height):(t.version++,t.image={rtt:!0,data:null,width:this.width,height:this.height}):t.resize(this.width,this.height),this._attachments[e||L.COLOR_ATTACHMENT0]=t},detach:function(t){delete this._attachments[t||L.COLOR_ATTACHMENT0]},resize:function(t,e){var n=In.prototype.resize.call(this,t,e);if(n)for(var i in this._attachments){var r=this._attachments[i];r.isTexture?(r.image={rtt:!0,data:null,width:this.width,height:this.height},r.version++):r.resize(t,e)}return n}}),Object.defineProperties(Ti.prototype,{texture:{set:function(t){t?t.isTexture&&this.attach(t,L.COLOR_ATTACHMENT0):this.detach(L.COLOR_ATTACHMENT0)},get:function(){var t=this._attachments[L.COLOR_ATTACHMENT0];return t.isTexture?t:null}}}),wi.prototype=Object.create(Ut.prototype),wi.prototype.constructor=wi,bi.prototype=Object.assign(Object.create(Ut.prototype),{constructor:bi,copy:function(t){return Ut.prototype.copy.call(this,t),this.type=t.type,this.lightType=t.lightType,this.color.copy(t.color),this.intensity=t.intensity,this}}),Ai.prototype=Object.create(bi.prototype),Ai.prototype.constructor=Ai,Object.assign(Ni.prototype,{update:function(t,e){},copy:function(t){return this.camera.copy(t.camera),this.matrix.copy(t.matrix),this.bias=t.bias,this.radius=t.radius,this.cameraNear=t.cameraNear,this.cameraFar=t.cameraFar,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)}}),Ci.prototype=Object.assign(Object.create(Ni.prototype),{constructor:Ci,update:function(t){this._updateCamera(t),this._updateMatrix(),this.mapSize.x===this.renderTarget.width&&this.mapSize.y===this.renderTarget.height||this.renderTarget.resize(this.mapSize.x,this.mapSize.y)},_updateCamera:function(t){var e=this.camera,n=this._lookTarget;t.getWorldDirection(this._lookTarget),e.position.setFromMatrixPosition(t.worldMatrix),n.set(n.x+e.position.x,n.y+e.position.y,n.z+e.position.z),e.lookAt(n,this._up),e.updateMatrix();var i=this.windowSize/2;e.setOrtho(-i,i,-i,i,this.cameraNear,this.cameraFar)},_updateMatrix:function(){var t=this.matrix,e=this.camera;t.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),t.multiply(e.projectionMatrix),t.multiply(e.viewMatrix)},copy:function(t){return Ni.prototype.copy.call(this,t),this.windowSize=t.windowSize,this},_initDepthMap:function(){var t=new Rt;t.type=E.FLOAT_32_UNSIGNED_INT_24_8_REV,t.format=M.DEPTH_STENCIL,t.internalformat=M.DEPTH32F_STENCIL8,t.magFilter=S.LINEAR,t.minFilter=S.LINEAR,t.compare=y.LESS,t.generateMipmaps=!1,this.renderTarget.attach(t,L.DEPTH_STENCIL_ATTACHMENT),this.depthMap=t}}),Ri.prototype=Object.assign(Object.create(bi.prototype),{constructor:Ri,copy:function(t){return bi.prototype.copy.call(this,t),this.shadow.copy(t.shadow),this}}),Pi.prototype=Object.assign(Object.create(Ni.prototype),{constructor:Pi,update:function(t,e){this._updateCamera(t,e),this._updateMatrix(),this.mapSize.x===this.renderTarget.width&&this.mapSize.y===this.renderTarget.height||this.renderTarget.resize(this.mapSize.x,this.mapSize.y)},_updateCamera:function(t,e){var n=this.camera,i=this._lookTarget,r=this._targets,a=this._ups;n.position.setFromMatrixPosition(t.worldMatrix),i.set(r[e].x+n.position.x,r[e].y+n.position.y,r[e].z+n.position.z),n.lookAt(i,a[e]),n.updateMatrix(),n.setPerspective(.5*Math.PI,1,this.cameraNear,this.cameraFar)},_updateMatrix:function(){var t=this.matrix,e=this.camera;t.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),t.multiply(e.projectionMatrix),t.multiply(e.viewMatrix)}}),Li.prototype=Object.assign(Object.create(bi.prototype),{constructor:Li,copy:function(t){return bi.prototype.copy.call(this,t),this.shadow.copy(t.shadow),this}}),Oi.prototype=Object.assign(Object.create(Ni.prototype),{constructor:Oi,update:function(t){this._updateCamera(t),this._updateMatrix(),this.mapSize.x===this.renderTarget.width&&this.mapSize.y===this.renderTarget.height||this.renderTarget.resize(this.mapSize.x,this.mapSize.y)},_updateCamera:function(t){var e=this.camera,n=this._lookTarget;t.getWorldDirection(this._lookTarget),e.position.setFromMatrixPosition(t.worldMatrix),n.set(n.x+e.position.x,n.y+e.position.y,n.z+e.position.z),e.lookAt(n,this._up),e.updateMatrix(),e.setPerspective(2*t.angle,1,this.cameraNear,this.cameraFar)},_updateMatrix:function(){var t=this.matrix,e=this.camera;t.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),t.multiply(e.projectionMatrix),t.multiply(e.viewMatrix)},_initDepthMap:function(){var t=new Rt;t.type=E.FLOAT_32_UNSIGNED_INT_24_8_REV,t.format=M.DEPTH_STENCIL,t.internalformat=M.DEPTH32F_STENCIL8,t.magFilter=S.LINEAR,t.minFilter=S.LINEAR,t.compare=y.LESS,t.generateMipmaps=!1,this.renderTarget.attach(t,L.DEPTH_STENCIL_ATTACHMENT),this.depthMap=t}}),Fi.prototype=Object.assign(Object.create(bi.prototype),{constructor:Fi,copy:function(t){return bi.prototype.copy.call(this,t),this.shadow.copy(t.shadow),this}}),Ui.prototype=Object.assign(Object.create(gi.prototype),{constructor:Ui,bind:function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrix(),e=this.worldMatrix),this.bindMatrix.copy(e),this.bindMatrixInverse.getInverse(e)},updateMatrix:function(t){gi.prototype.updateMatrix.call(this,t),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.worldMatrix):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("zen3d.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Object.defineProperties($t.prototype,{dynamic:{get:function(){return console.warn("zen3d.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===O.DYNAMIC_DRAW},set:function(t){console.warn("zen3d.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage=t?O.DYNAMIC_DRAW:O.STATIC_DRAW}}}),Object.defineProperties(se.prototype,{dynamic:{get:function(){return console.warn("zen3d.InterleavedBuffer: .dynamic has been deprecated. Use .usage instead."),this.usage===O.DYNAMIC_DRAW},set:function(t){console.warn("zen3d.InterleavedBuffer: .dynamic has been deprecated. Use .usage instead."),this.usage=t?O.DYNAMIC_DRAW:O.STATIC_DRAW}}}),Object.defineProperties(ae.prototype,{maxInstancedCount:{get:function(){return console.warn("zen3d.InstancedGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(t){console.warn("zen3d.InstancedGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=t}}}),D.prototype.applyProjection=function(t){console.error("zen3d.Vector3: .applyProjection has been removed. Use .applyMatrix4 instead.")},Object.defineProperties(Dn.prototype,{gammaInput:{get:function(){return console.warn("zen3d.Camera: .gammaInput has been removed. Use texture.encoding instead."),!1},set:function(t){console.warn("zen3d.Camera: .gammaInput has been removed. Use texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("zen3d.Camera: .gammaOutput has been removed. Use .outputEncoding or renderTarget.texture.encoding instead."),this.outputEncoding==N.GAMMA},set:function(t){console.warn("zen3d.Camera: .gammaOutput has been removed. Use .outputEncoding or renderTarget.texture.encoding instead."),this.outputEncoding=t?N.GAMMA:N.LINEAR}}}),t.ATTACHMENT=L,t.AmbientLight=Ai,t.AnimationMixer=Vt,t.BLEND_EQUATION=p,t.BLEND_FACTOR=f,t.BLEND_TYPE=d,t.BUFFER_USAGE=O,t.BasicMaterial=fe,t.Bone=Dt,t.BooleanKeyframeTrack=Wt,t.Box2=rt,t.Box3=st,t.BufferAttribute=$t,t.CULL_FACE_TYPE=_,t.Camera=Dn,t.Color3=_t,t.ColorKeyframeTrack=Xt,t.CubeGeometry=ne,t.CylinderGeometry=ie,t.DRAW_BUFFER={DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868},t.DRAW_MODE=R,t.DRAW_SIDE=v,t.DefaultLoadingManager=wt,t.DepthMaterial=ye,t.DirectionalLight=Ri,t.DirectionalLightShadow=Ci,t.DistanceMaterial=Te,t.ENVMAP_COMBINE_TYPE=C,t.EnvironmentMapPass=Gn,t.Euler=J,t.EventDispatcher=F,t.FOG_TYPE=l,t.FileLoader=At,t.Fog=function(t,e,n){this.fogType=l.NORMAL,this.color=new _t(void 0!==t?t:0),this.near=void 0!==e?e:1,this.far=void 0!==n?n:1e3},t.FogExp2=function(t,e){this.fogType=l.EXP2,this.color=new _t(void 0!==t?t:0),this.density=void 0!==e?e:25e-5},t.Frustum=ft,t.Geometry=ee,t.Group=wi,t.ImageLoader=bt,t.InstancedBufferAttribute=re,t.InstancedGeometry=ae,t.InstancedInterleavedBuffer=oe,t.InterleavedBuffer=se,t.InterleavedBufferAttribute=he,t.KeyframeClip=Yt,t.KeyframeTrack=jt,t.LIGHT_TYPE=c,t.LambertMaterial=_e,t.Light=bi,t.LightCache=$n,t.LightShadow=Ni,t.LineMaterial=Se,t.LoadingManager=Tt,t.MATERIAL_TYPE=u,t.MatcapMaterial=Me,t.Material=pe,t.Matrix3=nt,t.Matrix4=Q,t.Mesh=gi,t.NumberKeyframeTrack=qt,t.OBJECT_TYPE=h,t.Object3D=Ut,t.PBR2Material=ge,t.PBRMaterial=me,t.PhongMaterial=ve,t.Plane=dt,t.PlaneGeometry=ce,t.PointLight=Li,t.PointLightShadow=Pi,t.PointsMaterial=Ee,t.PropertyBindingMixer=kt,t.Quaternion=it,t.QuaternionKeyframeTrack=Zt,t.RGBELoader=Ct,t.Ray=k,t.Raycaster=V,t.RenderBuffer=Bn,t.RenderList=ii,t.RenderTarget2D=Ti,t.RenderTargetBack=xi,t.RenderTargetBase=In,t.RenderTargetCube=zn,t.Renderer=yi,t.SHADING_TYPE=m,t.SHADOW_TYPE=A,t.Scene=ri,t.ShaderChunk=cn,t.ShaderLib=ln,t.ShaderMaterial=xe,t.ShaderPostPass=Si,t.ShadowMapPass=Yn,t.Skeleton=Bt,t.SkinnedMesh=Ui,t.Sphere=ct,t.SphereGeometry=ue,t.Spherical=xt,t.SpotLight=Fi,t.SpotLightShadow=Oi,t.StringKeyframeTrack=Kt,t.TEXEL_ENCODING_TYPE=N,t.TGALoader=Nt,t.Texture2D=Rt,t.Texture3D=Lt,t.TextureBase=yt,t.TextureCube=Pt,t.TorusKnotGeometry=le,t.Triangle=St,t.VERTEX_COLOR=P,t.Vector2=tt,t.Vector3=D,t.Vector4=et,t.VectorKeyframeTrack=Qt,t.WEBGL_ATTRIBUTE_TYPE=b,t.WEBGL_COMPARE_FUNC=y,t.WEBGL_OP=T,t.WEBGL_PIXEL_FORMAT=M,t.WEBGL_PIXEL_TYPE=E,t.WEBGL_TEXTURE_FILTER=S,t.WEBGL_TEXTURE_TYPE=g,t.WEBGL_TEXTURE_WRAP=x,t.WEBGL_UNIFORM_TYPE=w,t.WebGLAttribute=an,t.WebGLCapabilities=we,t.WebGLCore=Fn,t.WebGLGeometry=Ge,t.WebGLProgram=hn,t.WebGLPrograms=En,t.WebGLProperties=Pe,t.WebGLState=Re,t.WebGLTexture=Ie,t.WebGLUniforms=rn,t.cloneUniforms=o,t.generateUUID=i,t.isPowerOfTwo=r,t.nearestPowerOfTwo=a,t.nextPowerOfTwo=s,Object.defineProperty(t,"__esModule",{value:!0})}));
